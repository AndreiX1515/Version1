# Enable URL rewriting
<IfModule mod_rewrite.c>
    RewriteEngine On

    # Redirect www to non-www (optional)
    RewriteCond %{HTTP_HOST} ^www\.(.*)$ [NC]
    RewriteRule ^(.*)$ https://%1/$1 [R=301,L]

    # Redirect index.php to root (optional)
    RewriteCond %{THE_REQUEST} ^[A-Z]{3,}\s/index\.php [NC]
    RewriteRule ^index\.php(.*)$ /$1 [R=301,L]
    
    # Force HTTPS (Uncomment the next two lines if you want to enforce HTTPS)
    # RewriteCond %{HTTPS} off
    # RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

    # Custom 404 error page
    ErrorDocument 404 /404.html
    
    # Block access to sensitive files (e.g., .env, .ini, etc.)
    <FilesMatch "\.(env|ini|log|bak)$">
        Order Allow,Deny
        Deny from all
    </FilesMatch>

    # Prevent directory listing
    Options -Indexes

    # Remove .php extension from URL
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteCond %{REQUEST_FILENAME}.php -f
    RewriteRule ^(.*)$ $1.php [L]

    # Redirect from .php URLs to clean URLs
    RewriteCond %{THE_REQUEST} \s/([a-zA-Z0-9-_]+)\.php [NC]
    RewriteRule ^([a-zA-Z0-9-_]+)\.php$ /$1 [R=301,L]

</IfModule>

# Set default character encoding
AddDefaultCharset UTF-8

# .htaccess in the 'uploads' directory for images and PDFs
<FilesMatch "\.(jpg|jpeg|png|gif|pdf)$">
    Require all granted
</FilesMatch>

# Caching settings (optional)
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresDefault "access plus 1 month"
    ExpiresByType image/jpg "access plus 1 year"
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/gif "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
    ExpiresByType application/x-javascript "access plus 1 month"
</IfModule>

# Prevent PHP from being executed in certain directories
<Directory "/uploads">
    php_flag engine off
</Directory>

# Enable browser caching for static files
<IfModule mod_headers.c>
    <FilesMatch "\.(jpg|jpeg|png|gif|css|js|pdf)$">
        Header set Cache-Control "max-age=2592000, public"
    </FilesMatch>
</IfModule>

# Increase PHP limits (optional, adjust as needed)
php_value memory_limit 128M
php_value max_execution_time 300
php_value upload_max_filesize 64M
php_value post_max_size 64M

# Disable PHP execution in specific folders (e.g., uploads, temp)
<Directory "/path/to/your/uploads">
    php_flag engine off
</Directory>php_value error_reporting "E_ALL & ~E_WARNING & ~E_NOTICE & ~E_DEPRECATED"
php_flag display_errors Off
