<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1.0">
	<title>SMART TRAVEL ADMIN</title>

	<!--   -->
	<link rel="shortcut icon" href="../image/favicon.ico">
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100;300;400;500;700;900&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="../css/a_reset.css">
	<link rel="stylesheet" href="../css/a_variables.css">
	<link rel="stylesheet" href="../css/a_components.css">
	<link rel="stylesheet" href="../css/a_contents.css">
	
	<!-- calendar -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css">
	<script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/moment@2.30.1/moment.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>

	<!-- editor -->
	<link href="https://cdn.jsdelivr.net/npm/quill@1.3.7/dist/quill.snow.css" rel="stylesheet">
	<script src="https://cdn.jsdelivr.net/npm/quill@1.3.7/dist/quill.js"></script>
</head>

<body>

	<!-- header   -->
	<header class="layout-header"></header>

	<!--   -->
	<main class="layout-main">
		<!-- nav   -->
		<nav class="layout-nav"></nav>

		<section class="layout-content layout-content-aside" data-essentialWrap="y">
			<div class="page-toolbar">
				<a href="product-list.html" class="jw-button" aria-label=" ">
					<img src="../image/arrow4.svg" alt="">
					<span data-lan-eng="Return to list">Return to list</span>
				</a>

				<div class="page-toolbar-actions">
				</div>
			</div>

			<div class="content-main">
				<h1 class="page-title" data-lan-eng="Product Details">Product Details</h1>
				<div class="jw-cols jw-between jw-mgt32">
					<h2 class="section-title" id="section-product-info" data-lan-eng="Product Information">Product Information</h2>
					<button type="button" class="jw-button typeA" onclick="modal('product-detail_m1.html', '580px', '508px')" data-lan-eng="Load Template">Load Template</button>
				</div>
				
				<div class="card-panel jw-mgt16">
					<div class="grid-wrap">
						<div class="grid-item">
							<label class="label-name" data-lan-eng="Registration date/time">Registration date/time</label>
							<input type="text" class="form-control" value="2025-01-01 12:12" disabled>
						</div>
						<div class="grid-item">
							<label class="label-name" data-lan-eng="Product code">Product code</label>
							<input type="text" class="form-control" placeholder="" disabled>
						</div>
						<div class="grid-item"></div>

						<div class="grid-item col-span-3">
							<label class="label-name"><span data-lan-eng="Product Name">Product Name</span> <span class="req">*</span></label>
							<input type="text" class="form-control" data-essential="y" value="Seoul Cherry Blossom Highlights 6-Day, 5-Night Package – Includes Full Itinerary Guide and Meals, with Visits to Nami Island, Seokchon Lake, and Yunjung-ro">
						</div>

						<div class="grid-item">
							<label class="label-name"><span data-lan-eng="Sales Target">Sales Target</span> <span class="req">*</span></label>
							<select class="select" disabled >
								<option selected>B2B</option>
								<option>B2C</option>
							</select>
						</div>
						<div class="grid-item"></div>
						<div class="grid-item"></div>
						<div class="grid-item">
							<label class="label-name"><span data-lan-eng="Category">Category</span> <span class="req">*</span></label>
							<select class="select" data-essential="y" data-category="1" onchange="template_detail_sdaf_cate()">
								<option value="" selected>Seasonal</option>
								<option value="">Regional</option>
								<option value="">Theme</option>
								<option value="">null</option>
							</select>
						</div>
						<div class="grid-item">
							<label class="label-name"><span data-lan-eng="Category">Category</span> <span class="req">*</span></label>
							<select class="select" data-essential="y" data-category="2">
								<option selected>Spring</option>
								<option>Summer</option>
								<option>Autumn</option>
								<option>Winter</option>
							</select>
						</div>
						<div class="grid-item"></div>
						<!-- multi-editor.js -->
						<div class="grid-item col-span-3">
							<label class="label-name"><span data-lan-eng="Product Description">Product Description</span> <span class="req">*</span></label>
							<div class="editor-box-wrap">
							<div class="jw-editor">
								<div class="toolbar">
								<div class="group">
									<button type="button" class="editor-btn ql-bold"><img src="../image/editer_bold.svg" alt=""></button>
									<button type="button" class="editor-btn ql-italic"><img src="../image/editer_italic.svg" alt=""></button>
									<button type="button" class="editor-btn ql-underline"><img src="../image/editer_underline.svg" alt=""></button>
									<button type="button" class="editor-btn ql-strike"><img src="../image/editer_strikethrough.svg" alt=""></button>
									<button type="button" class="editor-btn font-color" onclick="setColor(this);">A</button>
									<button type="button" class="background-color" onclick="setColor(this, 2);"></button>
								</div>
								<div class="group">
									<select class="ql-size">
									<option value="" selected>Font</option>
									<option value="12px">12px</option>
									<option value="14px">14px</option>
									<option value="16px">16px</option>
									<option value="18px">18px</option>
									<option value="24px">24px</option>
									</select>
								</div>
								<div class="group">
									<button type="button" class="editor-btn ql-align" value=""><img src="../image/editer_left.svg" alt=""></button>
									<button type="button" class="editor-btn ql-align" value="center"><img src="../image/editer_center.svg" alt=""></button>
									<button type="button" class="editor-btn ql-align" value="right"><img src="../image/editer_right.svg" alt=""></button>
								</div>
								<div class="group">
									<button type="button" class="editor-btn ql-list" value="ordered"><img src="../image/editer_ordered.svg" alt=""></button>
									<button type="button" class="editor-btn ql-list" value="bullet"><img src="../image/editer_bullet.svg" alt=""></button>
								</div>
								</div>
						
								<div class="jweditor" data-placeholder=" "></div>
							</div>
							</div>
						</div>
						<div class="grid-item">
							<label class="label-name"><span data-lan-eng="Thumbnail image">Thumbnail image</span> <span class="req">*</span></label>
							<div class="upload-grid" data-field="thumbnailImage">
								<!-- NOTE:      (picsum)        -->
								<div class="upload-item jw-center">
									<label class="inputFile">
										<input id="thumbnailImageInput" name="" type="file" onchange="filePreview(this);" >
										<button type="button" class="btn-upload"><img src="../image/upload3.svg" alt=""> <span data-lan-eng="Image upload">Image upload</span></button>
									</label>
								</div>
							</div>
						</div>
						<div class="grid-item"></div>
						<div class="grid-item"></div>
						<div class="grid-item col-span-3">
							<label class="label-name" data-lan-eng="Product image">Product image</label>
							<div class="upload-grid" data-field="productImages">
								<!-- NOTE:      (picsum)       -->
								
								<div class="upload-item jw-center">
									<label class="inputFile">
										<input id="productImageInput0" name="" type="file" onchange="filePreview(this);" >
										<button type="button" class="btn-upload"><img src="../image/upload3.svg" alt=""> <span data-lan-eng="Image upload">Image upload</span></button>
									</label>
								</div>
								<div class="upload-item jw-center">
									<label class="inputFile">
										<input id="productImageInput1" name="" type="file" onchange="filePreview(this);" >
										<button type="button" class="btn-upload"><img src="../image/upload3.svg" alt=""> <span data-lan-eng="Image upload">Image upload</span></button>
									</label>
								</div>
								<div class="upload-item jw-center">
									<label class="inputFile">
										<input id="productImageInput2" name="" type="file" onchange="filePreview(this);" >
										<button type="button" class="btn-upload"><img src="../image/upload3.svg" alt=""> <span data-lan-eng="Image upload">Image upload</span></button>
									</label>
								</div>
								<div class="upload-item jw-center">
									<label class="inputFile">
										<input id="productImageInput3" name="" type="file" onchange="filePreview(this);" >
										<button type="button" class="btn-upload"><img src="../image/upload3.svg" alt=""> <span data-lan-eng="Image upload">Image upload</span></button>
									</label>
								</div>
								<div class="upload-item jw-center">
									<label class="inputFile">
										<input id="productImageInput4" name="" type="file" onchange="filePreview(this);" >
										<button type="button" class="btn-upload"><img src="../image/upload3.svg" alt=""> <span data-lan-eng="Image upload">Image upload</span></button>
									</label>
								</div>
							</div>
						</div>
						<div class="grid-item">
							<label class="label-name"><span data-lan-eng="Detailed introduction image">Detailed introduction image</span> <span class="req">*</span></label>
							<div class="upload-grid" data-field="detailImage">
								<!-- NOTE:      (picsum)        -->
								<div class="upload-item jw-center">
									<label class="inputFile">
										<input id="detailImageInput" name="" type="file" onchange="filePreview(this);" >
										<button type="button" class="btn-upload"><img src="../image/upload3.svg" alt=""> <span data-lan-eng="Image upload">Image upload</span></button>
									</label>
								</div>
							</div>

						</div>
						<div class="grid-item"></div>
						<div class="grid-item"></div>
					</div>
				</div>

				<h2 class="section-title jw-mgt32" data-section-name="flight-information" data-lan-eng="Flight Information">Flight Information</h2>
				<div class="card-panel jw-mgt16" data-section-name="flight-information" >
					<h3 class="grid-wrap-title" data-lan-eng="Departure flight">Departure flight</h3>

					<div class="grid-wrap jw-mgt16">
						<div class="grid-item">
							<label class="label-name"><span data-lan-eng="Flight number">Flight number</span> <span class="req">*</span></label>
							<input type="text" class="form-control" value="PR467">
						</div>

						<div class="grid-item">
							<label class="label-name"><span data-lan-eng="Airline">Airline</span></label>
							<select class="select airline-select">
								<option value="">Select Airline</option>
								<option value="Cebu Pacific">Cebu Pacific</option>
								<option value="Air Asia">Air Asia</option>
								<option value="Jeju Air">Jeju Air</option>
							</select>
						</div>

						<div class="grid-item">
							<label class="label-name"><span data-lan-eng="Departure time">Departure time</span> <span class="req">*</span></label>
							<div class="meeting-wrap">
								<select class="select">
									<option>00</option>
									<option>01</option>
									<option>02</option>
									<option>03</option>
									<option>04</option>
									<option>05</option>
									<option>06</option>
									<option>07</option>
									<option>08</option>
									<option>09</option>
									<option>10</option>
									<option>11</option>
									<option selected>12</option>
									<option>13</option>
									<option>14</option>
									<option>15</option>
									<option>16</option>
									<option>17</option>
									<option>18</option>
									<option>19</option>
									<option>20</option>
									<option>21</option>
									<option>22</option>
									<option>23</option>
								</select>
								<select class="select">
									<option>00</option>
									<option>10</option>
									<option selected>20</option>
									<option>30</option>
									<option>40</option>
									<option>50</option>
								</select>
							</div>
						</div>

						<div class="grid-item">
							<label class="label-name"><span data-lan-eng="Arrival time">Arrival time</span> <span class="req">*</span></label>
							<div class="meeting-wrap">
								<select class="select">
									<option>00</option>
									<option>01</option>
									<option>02</option>
									<option>03</option>
									<option>04</option>
									<option>05</option>
									<option>06</option>
									<option>07</option>
									<option>08</option>
									<option>09</option>
									<option>10</option>
									<option selected>14</option>
									<option>15</option>
									<option>16</option>
									<option>17</option>
									<option>18</option>
									<option>19</option>
									<option>20</option>
									<option>21</option>
									<option>22</option>
									<option>23</option>
								</select>
								<select class="select">
									<option>00</option>
									<option>10</option>
									<option selected>20</option>
									<option>30</option>
									<option>40</option>
									<option>50</option>
								</select>
							</div>
						</div>
						<div class="grid-item">
							<label class="label-name"><span data-lan-eng="Departure point">Departure point</span> <span class="req">*</span></label>
							<input type="text" class="form-control" value="Manila (MNL)">
						</div>

						<div class="grid-item">
							<label class="label-name"><span data-lan-eng="Destination">Destination</span> <span class="req">*</span></label>
							<input type="text" class="form-control" value="Incheon (ICN)">
						</div>

						<div class="grid-item"></div>
					</div>
				</div>
				<div class="card-panel jw-mgt16" data-section-name="flight-information" >
					<h3 class="grid-wrap-title" data-lan-eng="Return trip">Return trip</h3>

					<div class="grid-wrap jw-mgt16">
						<div class="grid-item">
							<label class="label-name"><span data-lan-eng="Flight number">Flight number</span> <span class="req">*</span></label>
							<input type="text" class="form-control" value="PR468">
						</div>

						<div class="grid-item">
							<label class="label-name"><span data-lan-eng="Airline">Airline</span></label>
							<select class="select airline-select">
								<option value="">Select Airline</option>
								<option value="Cebu Pacific">Cebu Pacific</option>
								<option value="Air Asia">Air Asia</option>
								<option value="Jeju Air">Jeju Air</option>
							</select>
						</div>

						<div class="grid-item">
							<label class="label-name"><span data-lan-eng="Departure time">Departure time</span> <span class="req">*</span></label>
							<div class="meeting-wrap">
								<select class="select">
									<option>00</option>
									<option>01</option>
									<option>02</option>
									<option>03</option>
									<option>04</option>
									<option>05</option>
									<option>06</option>
									<option>07</option>
									<option>08</option>
									<option>09</option>
									<option>10</option>
									<option>11</option>
									<option>12</option>
									<option>13</option>
									<option selected>17</option>
									<option>18</option>
									<option>19</option>
									<option>20</option>
									<option>21</option>
									<option>22</option>
									<option>23</option>
								</select>
								<select class="select">
									<option>00</option>
									<option selected>05</option>
									<option>10</option>
									<option>20</option>
									<option>30</option>
									<option>40</option>
									<option>50</option>
								</select>
							</div>
						</div>

						<div class="grid-item">
							<label class="label-name"><span data-lan-eng="Arrival time">Arrival time</span> <span class="req">*</span></label>
							<div class="meeting-wrap">
								<select class="select">
									<option>00</option>
									<option>01</option>
									<option>02</option>
									<option>03</option>
									<option>04</option>
									<option>05</option>
									<option>06</option>
									<option>07</option>
									<option>08</option>
									<option>09</option>
									<option>10</option>
									<option>11</option>
									<option selected>19</option>
									<option>20</option>
									<option>21</option>
									<option>22</option>
									<option>23</option>
								</select>
								<select class="select">
									<option>00</option>
									<option selected>05</option>
									<option>10</option>
									<option>20</option>
									<option>30</option>
									<option>40</option>
									<option>50</option>
								</select>
							</div>
						</div>
						<div class="grid-item">
							<label class="label-name"><span data-lan-eng="Departure point">Departure point</span> <span class="req">*</span></label>
							<input type="text" class="form-control" value="Incheon (ICN)">
						</div>

						<div class="grid-item">
							<label class="label-name"><span data-lan-eng="Destination">Destination</span> <span class="req">*</span></label>
							<input type="text" class="form-control" value="Manila (MNL)">
						</div>

						<div class="grid-item"></div>
					</div>
				</div>

				<h2 class="section-title jw-mgt32" id="section-sales-info" data-lan-eng="Sales Information">Sales Information</h2>
				<div class="card-panel jw-mgt16">
					<h3 class="grid-wrap-title" data-lan-eng="Basic Sales Information">Basic Sales Information</h3>
					<hr class="jw-mgt16">
					
					<div class="grid-wrap jw-mgt16">
						<div class="grid-item col-span-3">
							<label class="label-name"><span data-lan-eng="Sale period ">Sale period </span> <span class="req">*</span></label>
							<div class="field-row jw-w400">
								<input id="contract-period" type="text" class="jw-w form-control" placeholder="Please select a date" readonly>
								<button type="button" class="btn-icon calendar" aria-label=" " data-target="#contract-period"></button>
							</div>
							<p class="form-desc is-warning" data-lan-eng="The period can only be set up to a maximum of 100 days.">  <b>100</b>  .</p>
						</div>
				
						<!-- // -->
						<div class="grid-item">
							<label class="label-name"><span data-lan-eng="Minimum departure headcount">Minimum departure headcount</span> <span class="req">*</span></label>
							<input id="minParticipants" type="number" class="form-control" value="2" min="0" data-essential="y" placeholder="0">
						</div>

						<div class="grid-item">
							<label class="label-name"><span data-lan-eng="Maximum capacity">Maximum capacity</span> <span class="req">*</span></label>
							<input id="maxParticipants" type="number" class="form-control" value="36" min="0" data-essential="y" placeholder="0">
						</div>

						<div class="grid-item">
							<label class="label-name"><span data-lan-eng="B2C Price (₱)">B2C Price (₱)</span> <span class="req">*</span></label>
							<input id="b2cPrice" type="text" class="form-control" value="0" data-essential="y" inputmode="numeric" placeholder="0">
						</div>

						<div class="grid-item">
							<label class="label-name"><span data-lan-eng="B2C Price Text">B2C Price Text</span></label>
							<input id="priceDisplayText" type="text" class="form-control" value="" placeholder="e.g. Contact Us, TBA">
						</div>

						<div class="grid-item">
							<label class="label-name"><span data-lan-eng="B2B Price (₱)">B2B Price (₱)</span></label>
							<input id="b2bPrice" type="text" class="form-control" value="0" inputmode="numeric" placeholder="0">
						</div>

						<div class="grid-item">
							<label class="label-name"><span data-lan-eng="B2B Price Text">B2B Price Text</span></label>
							<input id="b2bPriceDisplayText" type="text" class="form-control" value="" placeholder="e.g. Contact Us, TBA">
						</div>
					</div>
				</div>

				<div class="card-panel jw-mgt16 iljastar" data-section-name="iljastar">
					<h3 class="grid-wrap-title" data-lan-eng="Daily Sales Adjustment">Daily Sales Adjustment</h3>
					<div class="calendar-row jw-mgt16">
						<div>
							<div class="cal-month">
								<div class="cal-header">Jun 2025</div>
								
								<div class="cal-head">
								  <div>S</div><div>M</div><div>T</div><div>W</div><div>T</div><div>F</div><div>S</div>
								</div>
								<div class="cal-body">
									<div class="cal-day is-sun is-in-range"><time datetime="2025-06-01">1</time></div>
									<div class="cal-day is-in-range"><time datetime="2025-06-02">2</time></div>
									<div class="cal-day is-in-range"><time datetime="2025-06-03">3</time></div>
									<div class="cal-day is-in-range"><time datetime="2025-06-04">4</time></div>
									<div class="cal-day is-in-range"><time datetime="2025-06-05">5</time></div>
									<div class="cal-day is-in-range"><time datetime="2025-06-06">6</time></div>
									<div class="cal-day is-sat is-selected"><time datetime="2025-06-07">7</time></div>

									<div class="cal-day is-sun"><time datetime="2025-06-08">8</time></div>
									<div class="cal-day"><time datetime="2025-06-09">9</time></div>
									<div class="cal-day"><time datetime="2025-06-10">10</time></div>
									<div class="cal-day"><time datetime="2025-06-11">11</time></div>
									<div class="cal-day"><time datetime="2025-06-12">12</time></div>
									<div class="cal-day"><time datetime="2025-06-13">13</time></div>
									<div class="cal-day is-sat"><time datetime="2025-06-14">14</time></div>

									<div class="cal-day is-sun"><time datetime="2025-06-15">15</time></div>
									<div class="cal-day"><time datetime="2025-06-16">16</time></div>
									<div class="cal-day"><time datetime="2025-06-17">17</time></div>
									<div class="cal-day"><time datetime="2025-06-18">18</time></div>
									<div class="cal-day"><time datetime="2025-06-19">19</time></div>
									<div class="cal-day"><time datetime="2025-06-20">20</time></div>
									<div class="cal-day is-sat"><time datetime="2025-06-21">21</time></div>

									<div class="cal-day is-sun"><time datetime="2025-06-22">22</time></div>
									<div class="cal-day"><time datetime="2025-06-23">23</time></div>
									<div class="cal-day"><time datetime="2025-06-24">24</time></div>
									<div class="cal-day"><time datetime="2025-06-25">25</time></div>
									<div class="cal-day"><time datetime="2025-06-26">26</time></div>
									<div class="cal-day"><time datetime="2025-06-27">27</time></div>
									<div class="cal-day is-sat"><time datetime="2025-06-28">28</time></div>

									<div class="cal-day is-sun"><time datetime="2025-06-29">29</time></div>
									<div class="cal-day"><time datetime="2025-06-30">30</time></div>
									<div class="cal-day"><time datetime="2025-07-01">1</time></div>
									<div class="cal-day"><time datetime="2025-07-02">2</time></div>
									<div class="cal-day"><time datetime="2025-07-03">3</time></div>
									<div class="cal-day"><time datetime="2025-07-04">4</time></div>
								</div>
							</div>
						</div>
						<div>
							<div class="cal-month">
								<div class="cal-header">Jun 2025</div>
								
								<div class="cal-head">
								  <div>S</div><div>M</div><div>T</div><div>W</div><div>T</div><div>F</div><div>S</div>
								</div>
								<div class="cal-body">
									<div class="cal-day is-sun is-in-range"><time datetime="2025-06-01">1</time></div>
									<div class="cal-day is-in-range"><time datetime="2025-06-02">2</time></div>
									<div class="cal-day is-in-range"><time datetime="2025-06-03">3</time></div>
									<div class="cal-day is-in-range"><time datetime="2025-06-04">4</time></div>
									<div class="cal-day is-in-range"><time datetime="2025-06-05">5</time></div>
									<div class="cal-day is-in-range"><time datetime="2025-06-06">6</time></div>
									<div class="cal-day is-sat is-selected"><time datetime="2025-06-07">7</time></div>

									<div class="cal-day is-sun"><time datetime="2025-06-08">8</time></div>
									<div class="cal-day"><time datetime="2025-06-09">9</time></div>
									<div class="cal-day"><time datetime="2025-06-10">10</time></div>
									<div class="cal-day"><time datetime="2025-06-11">11</time></div>
									<div class="cal-day"><time datetime="2025-06-12">12</time></div>
									<div class="cal-day"><time datetime="2025-06-13">13</time></div>
									<div class="cal-day is-sat"><time datetime="2025-06-14">14</time></div>

									<div class="cal-day is-sun"><time datetime="2025-06-15">15</time></div>
									<div class="cal-day"><time datetime="2025-06-16">16</time></div>
									<div class="cal-day"><time datetime="2025-06-17">17</time></div>
									<div class="cal-day"><time datetime="2025-06-18">18</time></div>
									<div class="cal-day"><time datetime="2025-06-19">19</time></div>
									<div class="cal-day"><time datetime="2025-06-20">20</time></div>
									<div class="cal-day is-sat"><time datetime="2025-06-21">21</time></div>

									<div class="cal-day is-sun"><time datetime="2025-06-22">22</time></div>
									<div class="cal-day"><time datetime="2025-06-23">23</time></div>
									<div class="cal-day"><time datetime="2025-06-24">24</time></div>
									<div class="cal-day"><time datetime="2025-06-25">25</time></div>
									<div class="cal-day"><time datetime="2025-06-26">26</time></div>
									<div class="cal-day"><time datetime="2025-06-27">27</time></div>
									<div class="cal-day is-sat"><time datetime="2025-06-28">28</time></div>

									<div class="cal-day is-sun"><time datetime="2025-06-29">29</time></div>
									<div class="cal-day"><time datetime="2025-06-30">30</time></div>
									<div class="cal-day"><time datetime="2025-07-01">1</time></div>
									<div class="cal-day"><time datetime="2025-07-02">2</time></div>
									<div class="cal-day"><time datetime="2025-07-03">3</time></div>
									<div class="cal-day"><time datetime="2025-07-04">4</time></div>
								</div>
							</div>
						</div>
						<div>
							<div class="cal-month">
								<div class="cal-header">Jun 2025</div>
								
								<div class="cal-head">
								  <div>S</div><div>M</div><div>T</div><div>W</div><div>T</div><div>F</div><div>S</div>
								</div>
								<div class="cal-body">
									<div class="cal-day is-sun is-in-range"><time datetime="2025-06-01">1</time></div>
									<div class="cal-day is-in-range"><time datetime="2025-06-02">2</time></div>
									<div class="cal-day is-in-range"><time datetime="2025-06-03">3</time></div>
									<div class="cal-day is-in-range"><time datetime="2025-06-04">4</time></div>
									<div class="cal-day is-in-range"><time datetime="2025-06-05">5</time></div>
									<div class="cal-day is-in-range"><time datetime="2025-06-06">6</time></div>
									<div class="cal-day is-sat is-selected"><time datetime="2025-06-07">7</time></div>

									<div class="cal-day is-sun"><time datetime="2025-06-08">8</time></div>
									<div class="cal-day"><time datetime="2025-06-09">9</time></div>
									<div class="cal-day"><time datetime="2025-06-10">10</time></div>
									<div class="cal-day"><time datetime="2025-06-11">11</time></div>
									<div class="cal-day"><time datetime="2025-06-12">12</time></div>
									<div class="cal-day"><time datetime="2025-06-13">13</time></div>
									<div class="cal-day is-sat"><time datetime="2025-06-14">14</time></div>

									<div class="cal-day is-sun"><time datetime="2025-06-15">15</time></div>
									<div class="cal-day"><time datetime="2025-06-16">16</time></div>
									<div class="cal-day"><time datetime="2025-06-17">17</time></div>
									<div class="cal-day"><time datetime="2025-06-18">18</time></div>
									<div class="cal-day"><time datetime="2025-06-19">19</time></div>
									<div class="cal-day"><time datetime="2025-06-20">20</time></div>
									<div class="cal-day is-sat"><time datetime="2025-06-21">21</time></div>

									<div class="cal-day is-sun"><time datetime="2025-06-22">22</time></div>
									<div class="cal-day"><time datetime="2025-06-23">23</time></div>
									<div class="cal-day"><time datetime="2025-06-24">24</time></div>
									<div class="cal-day"><time datetime="2025-06-25">25</time></div>
									<div class="cal-day"><time datetime="2025-06-26">26</time></div>
									<div class="cal-day"><time datetime="2025-06-27">27</time></div>
									<div class="cal-day is-sat"><time datetime="2025-06-28">28</time></div>

									<div class="cal-day is-sun"><time datetime="2025-06-29">29</time></div>
									<div class="cal-day"><time datetime="2025-06-30">30</time></div>
									<div class="cal-day"><time datetime="2025-07-01">1</time></div>
									<div class="cal-day"><time datetime="2025-07-02">2</time></div>
									<div class="cal-day"><time datetime="2025-07-03">3</time></div>
									<div class="cal-day"><time datetime="2025-07-04">4</time></div>
								</div>
							</div>
						</div>
						<div>
							<div class="cal-month">
								<div class="cal-header">Jun 2025</div>
								
								<div class="cal-head">
								  <div>S</div><div>M</div><div>T</div><div>W</div><div>T</div><div>F</div><div>S</div>
								</div>
								<div class="cal-body">
									<div class="cal-day is-sun is-in-range"><time datetime="2025-06-01">1</time></div>
									<div class="cal-day is-in-range"><time datetime="2025-06-02">2</time></div>
									<div class="cal-day is-in-range"><time datetime="2025-06-03">3</time></div>
									<div class="cal-day is-in-range"><time datetime="2025-06-04">4</time></div>
									<div class="cal-day is-in-range"><time datetime="2025-06-05">5</time></div>
									<div class="cal-day is-in-range"><time datetime="2025-06-06">6</time></div>
									<div class="cal-day is-sat is-selected"><time datetime="2025-06-07">7</time></div>

									<div class="cal-day is-sun"><time datetime="2025-06-08">8</time></div>
									<div class="cal-day"><time datetime="2025-06-09">9</time></div>
									<div class="cal-day"><time datetime="2025-06-10">10</time></div>
									<div class="cal-day"><time datetime="2025-06-11">11</time></div>
									<div class="cal-day"><time datetime="2025-06-12">12</time></div>
									<div class="cal-day"><time datetime="2025-06-13">13</time></div>
									<div class="cal-day is-sat"><time datetime="2025-06-14">14</time></div>

									<div class="cal-day is-sun"><time datetime="2025-06-15">15</time></div>
									<div class="cal-day"><time datetime="2025-06-16">16</time></div>
									<div class="cal-day"><time datetime="2025-06-17">17</time></div>
									<div class="cal-day"><time datetime="2025-06-18">18</time></div>
									<div class="cal-day"><time datetime="2025-06-19">19</time></div>
									<div class="cal-day"><time datetime="2025-06-20">20</time></div>
									<div class="cal-day is-sat"><time datetime="2025-06-21">21</time></div>

									<div class="cal-day is-sun"><time datetime="2025-06-22">22</time></div>
									<div class="cal-day"><time datetime="2025-06-23">23</time></div>
									<div class="cal-day"><time datetime="2025-06-24">24</time></div>
									<div class="cal-day"><time datetime="2025-06-25">25</time></div>
									<div class="cal-day"><time datetime="2025-06-26">26</time></div>
									<div class="cal-day"><time datetime="2025-06-27">27</time></div>
									<div class="cal-day is-sat"><time datetime="2025-06-28">28</time></div>

									<div class="cal-day is-sun"><time datetime="2025-06-29">29</time></div>
									<div class="cal-day"><time datetime="2025-06-30">30</time></div>
									<div class="cal-day"><time datetime="2025-07-01">1</time></div>
									<div class="cal-day"><time datetime="2025-07-02">2</time></div>
									<div class="cal-day"><time datetime="2025-07-03">3</time></div>
									<div class="cal-day"><time datetime="2025-07-04">4</time></div>
								</div>
							</div>
						</div>

					</div>

					<!--  -->
					<div class="tableA-scrollY jw-mgt32" style="height:400px;">
						<table class="jw-tableA booking-detail">
							<colgroup>
								<col class="col-60">
								<col>
								<col>
								<col>
								<col>
								<col>
								<col style="width:60px">
							</colgroup>
							<thead>
								<tr>
									<th class="no is-center">No</th>
									<th data-lan-eng="Flight departure date">Flight departure date</th>
									<th data-lan-eng="Reserved personnel">Reserved personnel</th>
									<th data-lan-eng="Maximum capacity">Maximum capacity</th>
									<th data-lan-eng="B2C Price (₱)">B2C Price (₱)</th>
									<th data-lan-eng="B2B Price (₱)">B2B Price (₱)</th>
									<th data-lan-eng="Delete">Delete</th>
								</tr>
							</thead>
							<tbody>
								<tr>
									<td class="no is-center">1</td>
									<td class="is-center">2025-04-05</td>
									<td class="is-center">4</td>
									<td class="is-center"><div class="cell"><input type="text" class="form-control" value="10" min="0"></div></td>
									<td class="is-center"><div class="cell"><input type="text" class="form-control" value="25,000" inputmode="numeric"></div></td>
								</tr>
								<tr>
									<td class="no is-center">2</td>
									<td class="is-center">2025-04-06</td>
									<td class="is-center">4</td>
									<td class="is-center"><div class="cell"><input type="text" class="form-control" value="10" min="0"></div></td>
									<td class="is-center"><div class="cell"><input type="text" class="form-control" value="25,000" inputmode="numeric"></div></td>
								</tr>
								<tr>
									<td class="no is-center">3</td>
									<td class="is-center">2025-04-10</td>
									<td class="is-center">4</td>
									<td class="is-center"><div class="cell"><input type="text" class="form-control" value="4" min="0"></div></td>
									<td class="is-center"><div class="cell"><input type="text" class="form-control" value="40,000" inputmode="numeric"></div></td>
								</tr>
								<tr>
									<td class="no is-center">4</td>
									<td class="is-center">2025-04-13</td>
									<td class="is-center">4</td>
									<td class="is-center"><div class="cell"><input type="text" class="form-control" value="10" min="0"></div></td>
									<td class="is-center"><div class="cell"><input type="text" class="form-control" value="25,000" inputmode="numeric"></div></td>
								</tr>
								<tr>
									<td class="no is-center">5</td>
									<td class="is-center">2025-04-17</td>
									<td class="is-center">4</td>
									<td class="is-center"><div class="cell"><input type="text" class="form-control" value="4" min="0"></div></td>
									<td class="is-center"><div class="cell"><input type="text" class="form-control" value="40,000" inputmode="numeric"></div></td>
								</tr>
								<tr>
									<td class="no is-center">6</td>
									<td class="is-center">2025-04-20</td>
									<td class="is-center">4</td>
									<td class="is-center"><div class="cell"><input type="text" class="form-control" value="10" min="0"></div></td>
									<td class="is-center"><div class="cell"><input type="text" class="form-control" value="25,000" inputmode="numeric"></div></td>
								</tr>
								<tr>
									<td class="no is-center">7</td>
									<td class="is-center">2025-04-21</td>
									<td class="is-center">4</td>
									<td class="is-center"><div class="cell"><input type="text" class="form-control" value="10" min="0"></div></td>
									<td class="is-center"><div class="cell"><input type="text" class="form-control" value="25,000" inputmode="numeric"></div></td>
								</tr>
								<tr>
									<td class="no is-center">8</td>
									<td class="is-center">2025-04-24</td>
									<td class="is-center">4</td>
									<td class="is-center"><div class="cell"><input type="text" class="form-control" value="4" min="0"></div></td>
									<td class="is-center"><div class="cell"><input type="text" class="form-control" value="40,000" inputmode="numeric"></div></td>
								</tr>
								<tr>
									<td class="no is-center">9</td>
									<td class="is-center">2025-04-27</td>
									<td class="is-center">4</td>
									<td class="is-center"><div class="cell"><input type="text" class="form-control" value="10" min="0"></div></td>
									<td class="is-center"><div class="cell"><input type="text" class="form-control" value="25,000" inputmode="numeric"></div></td>
								</tr>
								<tr>
									<td class="no is-center">10</td>
									<td class="is-center">2025-04-30</td>
									<td class="is-center">4</td>
									<td class="is-center"><div class="cell"><input type="text" class="form-control" value="10" min="0"></div></td>
									<td class="is-center"><div class="cell"><input type="text" class="form-control" value="25,000" inputmode="numeric"></div></td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>

				<h2 class="section-title jw-mgt32" id="section-schedule" data-lan-eng="Schedule">Schedule</h2>
				<div class="card-panel jw-mgt16">
					<h3 class="grid-wrap-title" id="section-meeting-info" data-lan-eng="Meeting Information">Meeting Information</h3>

					<div class="grid-wrap jw-mgt16">
						<div class="grid-item">
							<label class="label-name"><span data-lan-eng="Meeting time">Meeting time</span> <span class="req">*</span></label>
							<div class="meeting-wrap">
								<select class="select">
									<option>00</option>
									<option>01</option>
									<option>02</option>
									<option>03</option>
									<option>04</option>
									<option>05</option>
									<option>06</option>
									<option>07</option>
									<option>08</option>
									<option selected>09</option>
									<option>10</option>
									<option>11</option>
									<option>12</option>
									<option>13</option>
									<option>14</option>
									<option>15</option>
									<option>16</option>
									<option>17</option>
									<option>18</option>
									<option>19</option>
									<option>20</option>
									<option>21</option>
									<option>22</option>
									<option>23</option>
								</select>
								<select class="select">
									<option selected>00</option>
									<option>05</option>
									<option>10</option>
									<option>15</option>
									<option>20</option>
									<option>25</option>
									<option>30</option>
									<option>35</option>
									<option>40</option>
									<option>45</option>
									<option>50</option>
									<option>55</option>
								</select>
							</div>
						</div>
						<div class="grid-item"></div>
						<div class="grid-item"></div>

						<div class="grid-item col-span-3">
							<label class="label-name"><span data-lan-eng="Meeting place name">Meeting place name</span> <span class="req">*</span></label>
							<div class="jw-center jw-gap20">
								<input type="text" class="form-control jw-wf" value="Incheon International Airport Terminal 2" disabled>
								<button type="button" class="jw-button typeA " data-lan-eng="Address Search">Address Search</button>
							</div>
						</div>
						<div class="grid-item col-span-3">
							<label class="label-name"><span data-lan-eng="Meeting place address">Meeting place address</span> <span class="req">*</span></label>
							<input type="text" class="form-control" value="Incheon Metropolitan City, Jung-gu, 446 Terminal 2 Road" disabled>
						</div>
					</div>
				</div>

				<div class="card-panel jw-mgt16"  id="nday">
					<h3 class="grid-wrap-title">
						<button type="button" class="jw-w jw-cols jw-between" onclick="ndasdtoggle()">1Day <img src="../image/arrow42.svg" alt=""></button>
					</h3>
					<i class="line"></i>
					<div class="grid-wrap jw-mgt12">
						<div class="grid-item col-span-3">
							<label class="label-name" data-lan-eng="Schedule Summary">Schedule Summary</label>
							<input type="text" class="form-control" value=" " placeholder="Schedule Summary" data-lan-eng="Arrival at Incheon">
						</div>
					</div>
					<div class="sub-panel jw-mgt20">
						<h3 class="grid-wrap-title" data-lan-eng="Tourist Information">Tourist Information</h3>
						<div class="jw-cols jw-gap12 jw-mgt12">
							<button type="button" class="jw-button typeA" data-lan-eng="Load Sight" onclick="openSightSelectModal(this)">Load Sight</button>
							<button type="button" class="jw-button typeA" data-lan-eng="＋ Add Tourist Attraction" onclick="template_detail_dfghs(this)">＋ Add Tourist Attraction</button>
						</div>
						<div class="grid-wrap grid-highlight jw-mgt12 dfghs">
							<div class="grid-item col-span-3">
								<label class="label-name"><span data-lan-eng="Sight Name">Sight Name</span> <span class="req">*</span></label>
								<div class="jw-center jw-gap20">
									<input type="text" class="form-control jw-wf" data-essential="y" value="Nami Island" disabled>
									<button type="button" class="jw-button typeA " data-lan-eng="Address Search">Address Search</button>
								</div>
							</div>

							<div class="grid-item col-span-3">
								<label class="label-name"><span data-lan-eng="Sight Address">Sight Address</span><span class="req">*</span></label>
								<input type="text" class="form-control" value="Gangwon Chuncheon-si Namsan-myeon Nami Island Road 1" disabled>
							</div>

							<!-- multi-editor.js -->
							<div class="grid-item col-span-3">
								<label class="label-name"><span data-lan-eng="Sight Information">Sight Information</span><span class="req">*</span></label>
								<div class="editor-box-wrap">
								<div class="jw-editor">
									<div class="toolbar">
									<div class="group">
										<button type="button" class="editor-btn ql-bold"><img src="../image/editer_bold.svg" alt=""></button>
										<button type="button" class="editor-btn ql-italic"><img src="../image/editer_italic.svg" alt=""></button>
										<button type="button" class="editor-btn ql-underline"><img src="../image/editer_underline.svg" alt=""></button>
										<button type="button" class="editor-btn ql-strike"><img src="../image/editer_strikethrough.svg" alt=""></button>
										<button type="button" class="editor-btn font-color" onclick="setColor(this);">A</button>
										<button type="button" class="background-color" onclick="setColor(this, 2);"></button>
									</div>
									<div class="group">
										<select class="ql-size">
										<option value="" selected>Font</option>
										<option value="12px">12px</option>
										<option value="14px">14px</option>
										<option value="16px">16px</option>
										<option value="18px">18px</option>
										<option value="24px">24px</option>
										</select>
									</div>
									<div class="group">
										<button type="button" class="editor-btn ql-align" value=""><img src="../image/editer_left.svg" alt=""></button>
										<button type="button" class="editor-btn ql-align" value="center"><img src="../image/editer_center.svg" alt=""></button>
										<button type="button" class="editor-btn ql-align" value="right"><img src="../image/editer_right.svg" alt=""></button>
									</div>
									<div class="group">
										<button type="button" class="editor-btn ql-list" value="ordered"><img src="../image/editer_ordered.svg" alt=""></button>
										<button type="button" class="editor-btn ql-list" value="bullet"><img src="../image/editer_bullet.svg" alt=""></button>
									</div>
									</div>
							
									<div class="jweditor" data-placeholder=" "></div>
								</div>
								</div>
							</div>
							<div class="grid-item col-span-3">
								<label class="label-name"><span data-lan-eng="Sight Image">Sight Image</span><span class="req">*</span></label>
								<div class="upload-grid">
									<div class="upload-item jw-center">
										<label class="inputFile">
											<input name="" type="file" onchange="filePreview(this);" >
											<button type="button" class="btn-upload"><img src="../image/upload3.svg" alt=""> <span data-lan-eng="Image upload">Image upload</span></button>
										</label>
									</div>
								</div>
							</div>
							<div class="grid-item col-span-3">
								<div class="grid-item-controoler">
									<button type="button" class="jw-button typeA" onclick="template_detail_hsdfghsh(this)"><img src="../image/trash.svg" alt="" data-lan-eng="Delete tourist attraction">Delete tourist attraction</button>
								</div>
							</div>
						</div>
					</div>
					<div class="sub-panel jw-mgt20">
						<h4 class="grid-wrap-title" data-lan-eng="Meal Information">Meal Information</h4>
						<div class="grid-wrap grid-highlight jw-mgt12">
							<div class="grid-item">
								<label class="label-name" data-lan-eng="Breakfast">Breakfast</label>
								<input type="text" class="form-control" value="Hotel breakfast">
							</div>
							<div class="grid-item">
								<label class="label-name" data-lan-eng="Lunch">Lunch</label>
								<input type="text" class="form-control" value="BBQ Chicken">
							</div>
							<div class="grid-item">
								<label class="label-name" data-lan-eng="Dinner">Dinner</label>
								<input type="text" class="form-control" value="Korean food">
							</div>
						</div>
					</div>
				</div>

				<h2 class="section-title jw-mgt32" id="section-common-settings" data-lan-eng="Common Settings">Common Settings</h2>
				<div class="card-panel jw-mgt16" id="commonAccommodationPanel">
					<div class="jw-cols jw-between jw-align-center">
						<h3 class="grid-wrap-title"><span data-lan-eng="Accommodation Information">Accommodation Information</span></h3>
						<button type="button" class="jw-button typeA" onclick="addAccommodationBlock()" data-lan-eng="+ Add Accommodation">+ Add Accommodation</button>
					</div>
					<div id="accommodationBlocksContainer">
						<div class="accommodation-block" data-accom-idx="0">
							<div class="jw-cols jw-between jw-align-center jw-mgt16">
								<h4 class="accom-block-title" style="font-size:14px;font-weight:600;color:#4A90D9;">Accommodation 1</h4>
								<button type="button" class="jw-button typeB btn-sm" onclick="removeAccommodationBlock(this)" style="display:none;" data-lan-eng="Delete">Delete</button>
							</div>
							<div class="grid-wrap jw-mgt12 grid-highlight">
								<div class="grid-item col-span-3">
									<label class="label-name"><span data-lan-eng="Accommodation name">Accommodation name</span> <span class="req">*</span></label>
									<input type="text" class="form-control accom-name" value="" placeholder="Enter accommodation name" data-lan-eng-placeholder="Enter accommodation name">
								</div>
								<div class="grid-item col-span-3">
									<label class="label-name"><span data-lan-eng="Accommodation address">Accommodation address</span></label>
									<input type="text" class="form-control accom-address" value="" placeholder="Enter accommodation address" data-lan-eng-placeholder="Enter accommodation address">
								</div>
								<div class="grid-item col-span-3">
									<label class="label-name"><span data-lan-eng="Accommodation Description">Accommodation Description</span></label>
									<div class="editor-box-wrap">
										<div class="jw-editor">
											<div class="toolbar">
												<div class="group">
													<button type="button" class="editor-btn ql-bold"><img src="../image/editer_bold.svg" alt=""></button>
													<button type="button" class="editor-btn ql-italic"><img src="../image/editer_italic.svg" alt=""></button>
													<button type="button" class="editor-btn ql-underline"><img src="../image/editer_underline.svg" alt=""></button>
													<button type="button" class="editor-btn ql-strike"><img src="../image/editer_strikethrough.svg" alt=""></button>
												</div>
												<div class="group">
													<select class="ql-size">
														<option value="" selected>Font</option>
														<option value="12px">12px</option>
														<option value="14px">14px</option>
														<option value="16px">16px</option>
														<option value="18px">18px</option>
														<option value="24px">24px</option>
													</select>
												</div>
												<div class="group">
													<button type="button" class="editor-btn ql-align" value=""><img src="../image/editer_left.svg" alt=""></button>
													<button type="button" class="editor-btn ql-align" value="center"><img src="../image/editer_center.svg" alt=""></button>
													<button type="button" class="editor-btn ql-align" value="right"><img src="../image/editer_right.svg" alt=""></button>
												</div>
												<div class="group">
													<button type="button" class="editor-btn ql-list" value="ordered"><img src="../image/editer_ordered.svg" alt=""></button>
													<button type="button" class="editor-btn ql-list" value="bullet"><img src="../image/editer_bullet.svg" alt=""></button>
												</div>
											</div>
											<div class="jweditor accom-description" data-placeholder="Enter accommodation description"></div>
										</div>
									</div>
								</div>
								<div class="grid-item">
									<label class="label-name"><span data-lan-eng="Accommodation image">Accommodation image</span></label>
									<div class="upload-grid accom-image-grid">
										<div class="upload-item jw-center">
											<label class="inputFile">
												<input type="file" accept="image/*" onchange="filePreview(this);">
												<button type="button" class="btn-upload"><img src="../image/upload3.svg" alt=""> <span data-lan-eng="Image upload">Image upload</span></button>
											</label>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="card-panel jw-mgt16" id="commonTransportation">
					<h3 class="grid-wrap-title" data-lan-eng="Transportation Information">Transportation Information</h3>
					<div class="grid-wrap jw-mgt16">
						<div class="grid-item col-span-3">
							<label class="label-name" data-lan-eng="Description">Description</label>
							<div class="editor-box-wrap">
								<div class="jw-editor">
									<div class="toolbar" id="commonTransToolbar">
										<div class="group">
											<button type="button" class="editor-btn ql-bold"><img src="../image/editer_bold.svg" alt=""></button>
											<button type="button" class="editor-btn ql-italic"><img src="../image/editer_italic.svg" alt=""></button>
											<button type="button" class="editor-btn ql-underline"><img src="../image/editer_underline.svg" alt=""></button>
											<button type="button" class="editor-btn ql-strike"><img src="../image/editer_strikethrough.svg" alt=""></button>
										</div>
										<div class="group">
											<select class="ql-size">
												<option value="" selected>Font</option>
												<option value="12px">12px</option>
												<option value="14px">14px</option>
												<option value="16px">16px</option>
												<option value="18px">18px</option>
												<option value="24px">24px</option>
											</select>
										</div>
										<div class="group">
											<button type="button" class="editor-btn ql-align" value=""><img src="../image/editer_left.svg" alt=""></button>
											<button type="button" class="editor-btn ql-align" value="center"><img src="../image/editer_center.svg" alt=""></button>
											<button type="button" class="editor-btn ql-align" value="right"><img src="../image/editer_right.svg" alt=""></button>
										</div>
										<div class="group">
											<button type="button" class="editor-btn ql-list" value="ordered"><img src="../image/editer_ordered.svg" alt=""></button>
											<button type="button" class="editor-btn ql-list" value="bullet"><img src="../image/editer_bullet.svg" alt=""></button>
										</div>
									</div>
									<div class="jweditor" id="commonTransEditor" data-placeholder="Enter transportation description"></div>
								</div>
							</div>
						</div>
					</div>
				</div>

				<h2 class="section-title jw-mgt32" id="section-fee-info" data-lan-eng="Fee information">Fee information</h2>
				<div class="card-panel jw-mgt16">
					<h3 class="grid-wrap-title" data-lan-eng="Number of people fee">Number of people fee</h3>
					<i class="line"></i>
					<button type="button" class="jw-button typeA" onclick="template_detail_sfg1(this)" data-lan-eng="＋ Add">＋ Add</button>
					<div class="tableA-scroll jw-mgt12">
						<table class="jw-tableA booking-detail">
							<colgroup>
								<col class="col-80"> <!-- No -->
								<col> <!-- Option name -->
								<col class="col-200"> <!-- B2C Price -->
								<col class="col-200"> <!-- B2B Price -->
								<col class="col-100"> <!-- Delete -->
							</colgroup>
							<thead>
								<tr>
									<th class="is-center">No</th>
									<th data-lan-eng="Option name">Option name</th>
									<th data-lan-eng="B2C Price (₱)">B2C Price (₱)</th>
									<th data-lan-eng="B2B Price (₱)">B2B Price (₱)</th>
									<th data-lan-eng="Delete">Delete</th>
								</tr>
							</thead>
							<tbody>
								<tr>
									<td class="is-center">1</td>
									<td class="is-center"><div class="cell"><input type="text" class="form-control" value="Adult" placeholder=""></div></td>
									<td class="is-center"><div class="cell"><input type="text" class="form-control" value="34,000" inputmode="numeric" placeholder="0"></div></td>
									<td class="is-center"><div class="cell"><input type="text" class="form-control" value="" inputmode="numeric" placeholder="0"></div></td>
									<td class="is-center jw-center">
										<button type="button" class="jw-button" onclick="template_detail_sfg1d(this)" aria-label="row delete"><img src="../image/trash.svg" alt=""></button>
									</td>
								</tr>
								<tr>
									<td class="is-center">2</td>
									<td class="is-center"><div class="cell"><input type="text" class="form-control" value="Child"></div></td>
									<td class="is-center"><div class="cell"><input type="text" class="form-control" value="23,800" inputmode="numeric"></div></td>
									<td class="is-center"><div class="cell"><input type="text" class="form-control" value="" inputmode="numeric"></div></td>
									<td class="is-center jw-center">
										<button type="button" class="jw-button" onclick="template_detail_sfg1d(this)" aria-label="row delete"><img src="../image/trash.svg" alt=""></button>
									</td>
								</tr>
								<tr>
									<td class="is-center">3</td>
									<td class="is-center"><div class="cell"><input type="text" class="form-control" value="Infant"></div></td>
									<td class="is-center"><div class="cell"><input type="text" class="form-control" value="0" inputmode="numeric"></div></td>
									<td class="is-center"><div class="cell"><input type="text" class="form-control" value="" inputmode="numeric"></div></td>
									<td class="is-center jw-center">
										<button type="button" class="jw-button" onclick="template_detail_sfg1d(this)" aria-label="row delete"><img src="../image/trash.svg" alt=""></button>
									</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
				<div class="card-panel jw-mgt16">
					<h3 class="grid-wrap-title" data-lan-eng="Room rate for single occupancy">Room rate for single occupancy</h3>
					<div class="grid-wrap jw-mgt16">
						<div class="grid-item col-span-3">
							<label class="label-name"><span data-lan-eng="Single room usage fee (₱)">Single room usage fee (₱)</span> <span class="req">*</span></label>
							<input type="text" class="form-control jw-w348" value="10,000" inputmode="numeric" placeholder="0">
							<p class="form-desc is-warning" data-lan-eng="* When booking for 2 or more people, you will be charged for the number of single rooms selected. For 1 person booking, it is applied for free.">* When booking for 2 or more people, you will be charged for the number of single rooms selected. For 1 person booking, it is applied for free.</p>
						</div>
					</div>
				</div>


				<h2 class="section-title jw-mgt32" data-lan-eng="Included/Not Included Items" data-section-name="poham">Included/Not Included Items</h2>
				<div class="card-panel jw-mgt16" data-section-name="poham">
					<h3 class="grid-wrap-title" data-lan-eng="Included items">Included items</h3>
					<i class="line"></i>
					<button type="button" class="jw-button typeA" data-lan-eng="＋ Add" onclick="template_detail_sfg3(this)">＋ Add</button>
					<div class="tableA-scroll jw-mgt20">
						<table class="jw-tableA booking-detail">
							<colgroup>
								<col class="col-80"> <!-- No -->
								<col> <!--   -->
								<col class="col-100"> <!--  -->
							</colgroup>
							<thead>
								<tr>
									<th>No</th>
									<th data-lan-eng="Included items">Included items</th>
									<th data-lan-eng="Delete">Delete</th>
								</tr>
							</thead>
							<tbody>
								<tr>
									<td class="is-center">1</td>
									<td class="is-center">
										<div class="cell">
											<input type="text" class="form-control" value="All accommodation (based on 2 people per room)">
										</div>
									</td>
									<td class="is-center jw-center">
										<button type="button" class="jw-button" aria-label="row delete" onclick="trash_typeA(this);"><img src="../image/trash.svg" alt=""></button>
									</td>
								</tr>
								<tr>
									<td class="is-center">2</td>
									<td class="is-center">
										<div class="cell">
											<input type="text" class="form-control" value="Accompanied by a dedicated vehicle and professional guide">
										</div>
									</td>
									<td class="is-center jw-center">
										<button type="button" class="jw-button" aria-label="row delete" onclick="trash_typeA(this);"><img src="../image/trash.svg" alt=""></button>
									</td>
								</tr>
								<tr>
									<td class="is-center">3</td>
									<td class="is-center">
										<div class="cell">
											<input type="text" class="form-control" value="All meals and entrance fees specified in the schedule are included">
										</div>
									</td>
									<td class="is-center jw-center">
										<button type="button" class="jw-button" aria-label="row delete" onclick="trash_typeA(this);"><img src="../image/trash.svg" alt=""></button>
									</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
				<div class="card-panel jw-mgt16" data-section-name="poham">
					<h3 class="grid-wrap-title" data-lan-eng="Excluded items">Excluded items</h3>
					<i class="line"></i>
					<button type="button" class="jw-button typeA" data-lan-eng="＋ Add" onclick="template_detail_sfg3(this)">＋ Add</button>

					<div class="tableA-scroll jw-mgt20">
						<table class="jw-tableA booking-detail">
							<colgroup>
								<col class="col-80"> <!-- No -->
								<col> <!--   -->
								<col class="col-100"> <!--  -->
							</colgroup>
							<thead>
								<tr>
									<th data-lan-eng="">No</th>
									<th data-lan-eng="Excluded items">Excluded items</th>
									<th data-lan-eng="Delete">Delete</th>
								</tr>
							</thead>
							<tbody>
								<tr>
									<td class="is-center">1</td>
									<td class="is-center">
										<div class="cell">
											<input type="text" class="form-control" value="Personal travel insurance and personal expenses">
										</div>
									</td>
									<td class="is-center jw-center"><button type="button" class="jw-button" aria-label="row delete" onclick="trash_typeA(this);"><img src="../image/trash.svg" alt=""></button>
									</td>
								</tr>
								<tr>
									<td class="is-center">2</td>
									<td class="is-center">
										<div class="cell">
											<input type="text" class="form-control" value="Meals and transportation costs during free time">
										</div>
									</td>
									<td class="is-center jw-center"><button type="button" class="jw-button" aria-label="row delete" onclick="trash_typeA(this);"><img src="../image/trash.svg" alt=""></button>
									</td>
								</tr>
								<tr>
									<td class="is-center">3</td>
									<td class="is-center">	
										<div class="cell">
											<input type="text" class="form-control" value="Manner tips and optional tourism costs">
										</div>
									</td>
									<td class="is-center jw-center"><button type="button" class="jw-button" aria-label="row delete" onclick="trash_typeA(this);"><img src="../image/trash.svg" alt=""></button>
									</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>


				<h2 class="section-title jw-mgt32" id="section-usage-guide" data-lan-eng="Usage Guide">Usage Guide</h2>
				<div class="card-panel jw-mgt16">
					<div class="grid-wrap jw-mgt0">
						<div class="grid-item col-span-3">
							<label class="label-name"><span data-lan-eng="Notice">Notice</span> <span class="req">*</span></label>
							<div class="cell">
								<div class="field-row jw-center">
									<div class="jw-center jw-gap10"><img src="../image/file.svg" alt=""> <span data-lan-eng="File">File</span> [pdf, 328KB]</div>
									<div class="jw-center jw-gap10">
										<i></i>
										<button type="button" class="jw-button typeF" onclick="download('', 'melong')"><img src="../image/buttun-download.svg" alt=""></button>
										<button type="button" class="jw-button typeF" onclick="deletefile(this)"><img src="../image/button-close2.svg" alt=""></button>
									</div>
								</div>
							</div>
						</div>
						<!-- SMT (#165): Product documents -->
						<div class="grid-item col-span-3">
							<label class="label-name"><span data-lan-eng="Flyer file">Flyer file</span></label>
							<label class="inputFile">
								<input id="flyerFileInput" type="file" accept=".pdf,.jpg,.jpeg,.png" onchange="(function(inp){try{const b=inp.closest('label.inputFile')?.querySelector('button.btn-upload');const img=b?.querySelector('img');const n=inp.files?.[0]?.name||inp.dataset?.existingName||inp.dataset?.existing||''; if(b){b.textContent=n?('File: '+n):'File upload'; if(img){b.prepend(img); b.insertAdjacentText('afterbegin',' ');} }}catch(_){}})(this);">
								<button type="button" class="btn-upload"><img src="../image/upload3.svg" alt=""> <span data-lan-eng="File upload">File upload</span></button>
							</label>
						</div>
						<div class="grid-item col-span-3">
							<label class="label-name"><span data-lan-eng="Itinerary file">Itinerary file</span></label>
							<label class="inputFile">
								<input id="itineraryFileInput" type="file" accept=".pdf" onchange="(function(inp){try{const b=inp.closest('label.inputFile')?.querySelector('button.btn-upload');const img=b?.querySelector('img');const n=inp.files?.[0]?.name||inp.dataset?.existingName||inp.dataset?.existing||''; if(b){b.textContent=n?('File: '+n):'File upload'; if(img){b.prepend(img); b.insertAdjacentText('afterbegin',' ');} }}catch(_){}})(this);">
								<button type="button" class="btn-upload"><img src="../image/upload3.svg" alt=""> <span data-lan-eng="File upload">File upload</span></button>
							</label>
						</div>
						<div class="grid-item col-span-3">
							<label class="label-name"><span data-lan-eng="Detail file">Detail file</span></label>
							<label class="inputFile">
								<input id="detailFileInput" type="file" accept=".pdf,.jpg,.jpeg,.png" onchange="(function(inp){try{const b=inp.closest('label.inputFile')?.querySelector('button.btn-upload');const img=b?.querySelector('img');const n=inp.files?.[0]?.name||inp.dataset?.existingName||inp.dataset?.existing||''; if(b){b.textContent=n?('File: '+n):'File upload'; if(img){b.prepend(img); b.insertAdjacentText('afterbegin',' ');} }}catch(_){}})(this);">
								<button type="button" class="btn-upload"><img src="../image/upload3.svg" alt=""> <span data-lan-eng="File upload">File upload</span></button>
							</label>
						</div>
						<!-- multi-editor.js -->
						<div class="grid-item col-span-3">
							<label class="label-name"><span data-lan-eng="Description">Description</span> <span class="req">*</span></label>
							<div class="editor-box-wrap">
							<div class="jw-editor">
								<div class="toolbar">
								<div class="group">
									<button type="button" class="editor-btn ql-bold"><img src="../image/editer_bold.svg" alt=""></button>
									<button type="button" class="editor-btn ql-italic"><img src="../image/editer_italic.svg" alt=""></button>
									<button type="button" class="editor-btn ql-underline"><img src="../image/editer_underline.svg" alt=""></button>
									<button type="button" class="editor-btn ql-strike"><img src="../image/editer_strikethrough.svg" alt=""></button>
									<button type="button" class="editor-btn font-color" onclick="setColor(this);">A</button>
									<button type="button" class="background-color" onclick="setColor(this, 2);"></button>
								</div>
								<div class="group">
									<select class="ql-size">
									<option value="" selected>Font</option>
									<option value="12px">12px</option>
									<option value="14px">14px</option>
									<option value="16px">16px</option>
									<option value="18px">18px</option>
									<option value="24px">24px</option>
									</select>
								</div>
								<div class="group">
									<button type="button" class="editor-btn ql-align" value=""><img src="../image/editer_left.svg" alt=""></button>
									<button type="button" class="editor-btn ql-align" value="center"><img src="../image/editer_center.svg" alt=""></button>
									<button type="button" class="editor-btn ql-align" value="right"><img src="../image/editer_right.svg" alt=""></button>
								</div>
								<div class="group">
									<button type="button" class="editor-btn ql-list" value="ordered"><img src="../image/editer_ordered.svg" alt=""></button>
									<button type="button" class="editor-btn ql-list" value="bullet"><img src="../image/editer_bullet.svg" alt=""></button>
								</div>
								</div>
						
								<div class="jweditor" data-placeholder=" "></div>
							</div>
							</div>
						</div>
					</div>
				</div>

				<h2 class="section-title jw-mgt32" id="section-refund-policy" data-lan-eng="Cancellation/Refund Policy">Cancellation/Refund Policy</h2>
				<div class="card-panel jw-mgt16">
					<div class="grid-wrap jw-mgt0">
						<div class="grid-item col-span-3">
							<label class="label-name"><span data-lan-eng="Full refund available standard date">Full refund available standard date</span> <span class="req">*</span></label>
							<input type="text" class="form-control jw-w348" value="15" inputmode="numeric" placeholder="Enter numbers">
							<p class="form-desc is-warning" data-lan-eng="Cancel up to 1 day before for a full refund">Cancel up to 1 day before for a full refund</p>
						</div>
						<!-- multi-editor.js -->
						<div class="grid-item col-span-3">
							<label class="label-name"><span data-lan-eng="Description">Description</span> <span class="req">*</span></label>
							<div class="editor-box-wrap">
							<div class="jw-editor">
								<div class="toolbar">
								<div class="group">
									<button type="button" class="editor-btn ql-bold"><img src="../image/editer_bold.svg" alt=""></button>
									<button type="button" class="editor-btn ql-italic"><img src="../image/editer_italic.svg" alt=""></button>
									<button type="button" class="editor-btn ql-underline"><img src="../image/editer_underline.svg" alt=""></button>
									<button type="button" class="editor-btn ql-strike"><img src="../image/editer_strikethrough.svg" alt=""></button>
									<button type="button" class="editor-btn font-color" onclick="setColor(this);">A</button>
									<button type="button" class="background-color" onclick="setColor(this, 2);"></button>
								</div>
								<div class="group">
									<select class="ql-size">
									<option value="" selected>Font</option>
									<option value="12px">12px</option>
									<option value="14px">14px</option>
									<option value="16px">16px</option>
									<option value="18px">18px</option>
									<option value="24px">24px</option>
									</select>
								</div>
								<div class="group">
									<button type="button" class="editor-btn ql-align" value=""><img src="../image/editer_left.svg" alt=""></button>
									<button type="button" class="editor-btn ql-align" value="center"><img src="../image/editer_center.svg" alt=""></button>
									<button type="button" class="editor-btn ql-align" value="right"><img src="../image/editer_right.svg" alt=""></button>
								</div>
								<div class="group">
									<button type="button" class="editor-btn ql-list" value="ordered"><img src="../image/editer_ordered.svg" alt=""></button>
									<button type="button" class="editor-btn ql-list" value="bullet"><img src="../image/editer_bullet.svg" alt=""></button>
								</div>
								</div>
						
								<div class="jweditor" data-placeholder=" "></div>
							</div>
							</div>
						</div>
					</div>
				</div>


				<h2 class="section-title jw-mgt32" id="section-visa-guide" data-lan-eng="Visa Application Guide">Visa Application Guide</h2>
				<div class="card-panel jw-mgt16">
					<div class="grid-wrap jw-mgt0">
						<!-- multi-editor.js -->
						<div class="grid-item col-span-3">
							<label class="label-name"><span data-lan-eng="Description">Description</span> <span class="req">*</span></label>
							<div class="editor-box-wrap">
							<div class="jw-editor">
								<div class="toolbar">
								<div class="group">
									<button type="button" class="editor-btn ql-bold"><img src="../image/editer_bold.svg" alt=""></button>
									<button type="button" class="editor-btn ql-italic"><img src="../image/editer_italic.svg" alt=""></button>
									<button type="button" class="editor-btn ql-underline"><img src="../image/editer_underline.svg" alt=""></button>
									<button type="button" class="editor-btn ql-strike"><img src="../image/editer_strikethrough.svg" alt=""></button>
									<button type="button" class="editor-btn font-color" onclick="setColor(this);">A</button>
									<button type="button" class="background-color" onclick="setColor(this, 2);"></button>
								</div>
								<div class="group">
									<select class="ql-size">
									<option value="" selected>Font</option>
									<option value="12px">12px</option>
									<option value="14px">14px</option>
									<option value="16px">16px</option>
									<option value="18px">18px</option>
									<option value="24px">24px</option>
									</select>
								</div>
								<div class="group">
									<button type="button" class="editor-btn ql-align" value=""><img src="../image/editer_left.svg" alt=""></button>
									<button type="button" class="editor-btn ql-align" value="center"><img src="../image/editer_center.svg" alt=""></button>
									<button type="button" class="editor-btn ql-align" value="right"><img src="../image/editer_right.svg" alt=""></button>
								</div>
								<div class="group">
									<button type="button" class="editor-btn ql-list" value="ordered"><img src="../image/editer_ordered.svg" alt=""></button>
									<button type="button" class="editor-btn ql-list" value="bullet"><img src="../image/editer_bullet.svg" alt=""></button>
								</div>
								</div>
						
								<div class="jweditor" data-placeholder=" "></div>
							</div>
							</div>
						</div>
					</div>
				</div>

				<div class="controller jw-flex-s">
					<button type="button" class="jw-button typeG" data-lan-eng="Save as Template">Save as Template</button>
				</div>
			</div>

			<aside class="content-aside" aria-label=" " style="top:5px">
				<h3 class="aside-title" data-lan-eng="Components">Components</h3>
				<div class="card-panel jw-mgt16">
						<div class="grid-item">
							<div class="aside-list">
								<div class="aside-row">
									<div class="aside-row__title" data-scroll-target="section-product-info" onclick="scrollToSection('section-product-info')" style="cursor:pointer;" data-lan-eng="Product Information">Product Information</div>
									<span class="aside-row__req" data-lan-eng="Required">Required</span>
								</div>
								<hr class="aside-row__sep">
								<div class="aside-row">
									<div class="aside-row__title" data-scroll-target="flight-information" onclick="scrollToSection('flight-information')" style="cursor:pointer;" data-lan-eng="Flight Information">Flight Information</div>
									<button type="button" class="jw-button aside-add-section" data-target-section="flight-information" onclick="togglePlusMinus(this)"><img src="../image/minus.svg" alt="minus"></button>
								</div>
								<div class="aside-row">
									<div class="aside-row__title" data-scroll-target="section-sales-info" onclick="scrollToSection('section-sales-info')" style="cursor:pointer;" data-lan-eng="Sales Information">Sales Information</div>
									<span class="aside-row__req" data-lan-eng="Required">Required</span>
								</div>
								<div class="aside-sub">
									<div class="aside-row">
										<div class="aside-row__subtitle" data-scroll-target="section-sales-info" onclick="scrollToSection('section-sales-info')" style="cursor:pointer;" data-lan-eng="Basic Sales Information">Basic Sales Information</div>
										<span class="aside-row__req" data-lan-eng="Required">Required</span>
									</div>
									<div class="aside-row">
										<div class="aside-row__subtitle" data-scroll-target="iljastar" onclick="scrollToSection('iljastar')" style="cursor:pointer;" data-lan-eng="Daily Sales Adjustment">Daily Sales Adjustment</div>
										<button type="button" class="jw-button aside-add-section" data-target-section="iljastar" onclick="togglePlusMinus(this)"><img src="../image/minus.svg" alt="minus"></button>
									</div>
								</div>
								<div class="aside-row">
									<div class="aside-row__title" data-scroll-target="section-schedule" onclick="scrollToSection('section-schedule')" style="cursor:pointer;" data-lan-eng="Schedule">Schedule</div>
									<span class="aside-row__req" data-lan-eng="Required">Required</span>
								</div>
								<div class="aside-sub">
									<div class="aside-row">
										<div class="aside-row__title" data-scroll-target="section-meeting-info" onclick="scrollToSection('section-meeting-info')" style="cursor:pointer;" data-lan-eng="Meeting Information">Meeting Information</div>
										<span class="aside-row__req" data-lan-eng="Required">Required</span>
									</div>
									<div class="aside-row-list">
										<div class="aside-row">
											<div class="aside-row__subtitle" data-scroll-target="day-1" onclick="scrollToDayPanel(1)" style="cursor:pointer;" data-lan-eng="Day 1">Day 1</div>
											<span class="aside-row__req" data-lan-eng="Required">Required</span>
										</div>
									</div>
									<div class="aside-row">
										<button type="button" class="jw-button aside-button-typeA" onclick="template_detail_sdaf(this)"><img src="../image/plus.svg" alt=""> <span data-lan-eng="Add day">Add day</span></button>
									</div>
								</div>
								<hr class="aside-row__sep">
								<div class="aside-row">
									<div class="aside-row__title" data-scroll-target="section-common-settings" onclick="scrollToSection('section-common-settings')" style="cursor:pointer;" data-lan-eng="Common Settings">Common Settings</div>
									<span class="aside-row__req" data-lan-eng="Required">Required</span>
								</div>
								<hr class="aside-row__sep">
								<div class="aside-row">
									<div class="aside-row__title" data-scroll-target="section-fee-info" onclick="scrollToSection('section-fee-info')" style="cursor:pointer;" data-lan-eng="Fee information">Fee information</div>
									<span class="aside-row__req" data-lan-eng="Required">Required</span>
								</div>
								<hr>
								<div class="aside-row">
									<div class="aside-row__title" data-scroll-target="poham" onclick="scrollToSection('poham')" style="cursor:pointer;" data-lan-eng="Included/Not Included Items">Included/Not Included Items</div>
									<button type="button" class="jw-button aside-add-section" data-target-section="poham" onclick="togglePlusMinus(this)"><img src="../image/minus.svg" alt="minus"></button>
								</div>
								<hr>
								<div class="aside-row">
									<div class="aside-row__title" data-scroll-target="section-usage-guide" onclick="scrollToSection('section-usage-guide')" style="cursor:pointer;" data-lan-eng="Usage Guide">Usage Guide</div>
									<span class="aside-row__req" data-lan-eng="Required">Required</span>
								</div>
								<hr>
								<div class="aside-row">
									<div class="aside-row__title" data-scroll-target="section-refund-policy" onclick="scrollToSection('section-refund-policy')" style="cursor:pointer;" data-lan-eng="Cancellation/Refund Policy">Cancellation/Refund Policy</div>
									<span class="aside-row__req" data-lan-eng="Required">Required</span>
								</div>
								<hr>
								<div class="aside-row">
									<div class="aside-row__title" data-scroll-target="section-visa-guide" onclick="scrollToSection('section-visa-guide')" style="cursor:pointer;" data-lan-eng="Visa Application Guide">Visa Application Guide</div>
									<span class="aside-row__req" data-lan-eng="Required">Required</span>
								</div>

							</div>

						</div>
						<div class="temporary-guide" style="position:relative; margin-top:50px; ">
							<button type="button" class="jw-button" onclick="modal('product-detail_m1.html', '580px', '508px')"> </button>
							<button type="button" class="jw-button" onclick="modal('product-detail_m2.html', '580px', '358px')"> </button>
							<button type="button" class="jw-button" onclick="modal('template-detail-modal1.html', '600px', '252px')">  </button>
							
							<button type="button" class="jw-button" onclick="modal('product-detail_modal_5.html', '580px', '252px')">  </button>
							<button type="button" class="jw-button" onclick="modal('template-detail-modal3.html', '580px', '252px')"> </button>
						</div>
				</div>
			</aside>
		</section>
	
	</main>

	<!-- 하단 고정 액션 바 -->
	<div class="fixed-bottom-bar">
		<button type="button" class="jw-button typeA" onclick="modal('product-detail_modal_5.html', '600px', '252px')" data-lan-eng="Delete">Delete</button>
		<button type="button" class="jw-button typeA" onclick="product_detail_temp_save(this)" data-lan-eng="Temporary save">Temporary save</button>
		<button type="button" class="jw-button typeB" onclick="product_detail_save(this)" data-lan-eng="Save">Save</button>
	</div>

	<style>
		.layout-main {
			padding-bottom: 60px !important;
		}
		.fixed-bottom-bar {
			position: fixed;
			bottom: 0;
			left: 0;
			right: 0;
			height: 60px;
			background: #fff;
			border-top: 1px solid #e0e0e0;
			display: flex;
			align-items: center;
			justify-content: flex-end;
			padding: 0 24px;
			gap: 16px;
			z-index: 100;
		}
		/* Usage Guide 섹션 파일 업로드 - Notice와 동일한 너비 */
		.grid-item.col-span-3 .inputFile {
			display: block;
			width: 100%;
			max-width: 492px;
		}
		.grid-item.col-span-3 .inputFile .btn-upload {
			width: 100%;
			max-width: 492px;
			overflow: hidden;
			text-overflow: ellipsis;
			white-space: nowrap;
		}
		/* aside +/- 버튼 크기 통일 */
		.aside-add-section {
			width: 24px !important;
			height: 24px !important;
			min-width: 24px;
			min-height: 24px;
			padding: 0 !important;
		}
		.aside-add-section img {
			width: 12px;
			height: 12px;
		}
	</style>

	<!--   -->
	<script src="../js/default.js?v=20251226_pdetailfix1"></script>
	<script src="../js/super.js?v=20251226_pdetailfix1"></script>
	<script src="../js/datepicker.js"></script>
	<script src="../js/multi-editor.js"></script>

	<script>
		init({
			headerUrl: '../inc/header.html',
			navUrl: '../inc/nav_super.html'
		});
	</script>


<!-- === DB load/save custom logic (kept from admin version) === -->
<script>
		(() => {
		let productId = null;
			let __lastLoadedDetail = null;

			//  / CSS.escape         .
			(function ensureCssEscape() {
				try {
					if (window.CSS && typeof window.CSS.escape === 'function') return;
					if (!window.CSS) window.CSS = {};
					window.CSS.escape = function (value) {
						const s = String(value ?? '');
						//   escape (  selector )
						return s.replace(/[^a-zA-Z0-9_\u00A0-\uFFFF-]/g, (ch) => '\\' + ch);
					};
				} catch (_) { /* ignore */ }
			})();

			//   (PR467/12:20 ) " "      
			//     . (loadAllToForm   DB  )
			function __clearPublishingDefaults() {
				try {
					// Flight panels: flight number + time selects reset
					const panels = Array.from(document.querySelectorAll('[data-section-name="flight-information"].card-panel'));
					panels.forEach((p) => {
						const flightNo = p.querySelector('input.form-control');
						if (flightNo) { flightNo.value = ''; try { flightNo.setAttribute('value', ''); } catch (_) {} }
						const selects = Array.from(p.querySelectorAll('.meeting-wrap select'));
						selects.forEach((s, idx) => {
							// 0,2 = hour / 1,3 = minute
							const target = (idx % 2 === 0) ? '00' : '00';
							s.value = target;
							try { s.dispatchEvent(new Event('change', { bubbles: true })); } catch (_) {}
						});
					});

					// Sales basic inputs (min/max/b2cPrice/b2bPrice, sales period)
					const contract = document.getElementById('contract-period');
					if (contract) contract.value = '';
					const minEl = document.getElementById('minParticipants');
					if (minEl) minEl.value = '';
					const maxEl = document.getElementById('maxParticipants');
					if (maxEl) maxEl.value = '';
					const b2cEl = document.getElementById('b2cPrice');
					if (b2cEl) b2cEl.value = '';
					const b2bEl = document.getElementById('b2bPrice');
					if (b2bEl) b2bEl.value = '';
				} catch (_) { /* ignore */ }
			}

			// --- product-registration.html   product-detail   ---
			function __findLabelByLanEng(lanEngValue) {
				// label-name  span[data-lan-eng="..."]   grid-item (  )
				const marker = document.querySelector(`.label-name [data-lan-eng="${CSS.escape(lanEngValue)}"]`);
				const label = marker ? marker.closest('.label-name') : null;
				return label ? label.closest('.grid-item') : null;
			}

			function __ensureIdFromLanEng(lanEngValue, id, selector = 'input, select, textarea') {
				const item = __findLabelByLanEng(lanEngValue);
				const el = item ? item.querySelector(selector) : null;
				if (el) {
					// SMT: ensure unique ID (avoid strict-mode issues and wrong element selection)
					try {
						document.querySelectorAll(`#${CSS.escape(id)}`).forEach((n) => {
							if (n !== el) n.removeAttribute('id');
						});
					} catch (_) {}
					if (!el.id || el.id !== id) el.id = id;
				}
				return el;
			}

			// fallback: /  ( data-lan-eng  )
			function __ensureId(labelText, id, selector = 'input, select, textarea') {
				const labels = Array.from(document.querySelectorAll('.label-name'));
				const labelEl = labels.find((el) => (el.textContent || '').replace(/\s+/g, ' ').includes(labelText));
				const item = labelEl ? labelEl.closest('.grid-item') : null;
				const el = item ? item.querySelector(selector) : null;
				if (el) {
					try {
						document.querySelectorAll(`#${CSS.escape(id)}`).forEach((n) => {
							if (n !== el) n.removeAttribute('id');
						});
					} catch (_) {}
					if (!el.id || el.id !== id) el.id = id;
				}
				return el;
			}

			function __ensureProductIds() {
				// Product Name
				__ensureIdFromLanEng('Product Name', 'productName');

				const salesSel = Array.from(document.querySelectorAll('select')).find((s) =>
					Array.from(s.options).some((o) => (o.textContent || '').includes('B2B') || (o.textContent || '').includes('B2C'))
				);
				if (salesSel) { salesSel.id = salesSel.id || 'salesTarget'; salesSel.disabled = false; }
				const mainSel = document.querySelector('select[data-category="1"]');
				if (mainSel) mainSel.id = mainSel.id || 'mainCategory';
				const subSel = document.querySelector('select[data-category="2"]');
				if (subSel) subSel.id = subSel.id || 'subCategory';

				//    id
				const descEd =
					__ensureIdFromLanEng('Product Description', 'productDescriptionEditor', '.jweditor') ||
					__ensureId(' ', 'productDescriptionEditor', '.jweditor');
				if (descEd && !descEd.id) descEd.id = 'productDescriptionEditor';

				__ensureIdFromLanEng('Minimum departure headcount', 'minParticipants') || __ensureId('  ', 'minParticipants');
				__ensureIdFromLanEng('Maximum capacity', 'maxParticipants') || __ensureId('  ', 'maxParticipants');
				__ensureIdFromLanEng('B2C Price (₱)', 'b2cPrice');
				__ensureIdFromLanEng('B2C Price Text', 'priceDisplayText');
				__ensureIdFromLanEng('B2B Price (₱)', 'b2bPrice');
				__ensureIdFromLanEng('B2B Price Text', 'b2bPriceDisplayText');

				// 폼 필드 활성화 (일부 disabled로 설정된 경우 해제)
				try {
					const minEl = document.getElementById('minParticipants');
					const maxEl = document.getElementById('maxParticipants');
					const b2cEl = document.getElementById('b2cPrice');
					const b2bEl = document.getElementById('b2bPrice');
					const priceTextEl = document.getElementById('priceDisplayText');
					const b2bPriceTextEl = document.getElementById('b2bPriceDisplayText');
					[minEl, maxEl, b2cEl, b2bEl, priceTextEl, b2bPriceTextEl].forEach((el) => {
						if (!el) return;
						el.disabled = false;
						el.readOnly = false;
					});
				} catch (_) {}
			}

			//  onchange="template_detail_sdaf_cate()" ( select enable/ )
			function template_detail_sdaf_cate() {
				try {
					const mainSel = document.getElementById('mainCategory') || document.querySelector('select[data-category="1"]');
					const subSel = document.getElementById('subCategory') || document.querySelector('select[data-category="2"]');
					if (!mainSel || !subSel) return;

					subSel.disabled = false;
					//   (Spring/Summer/Autumn/Winter)  ,
					// main category    
					const mv = String(mainSel.value || '').trim();
					if (!mv) {
						subSel.selectedIndex = 0;
					} else if (subSel.selectedIndex < 0) {
						subSel.selectedIndex = 0;
					}
					try { __resetSelectWidgets(document); } catch (_) { }
				} catch (e) {
					console.warn('template_detail_sdaf_cate failed:', e);
				}
			}

			// day/ clone (  )
			function ndasdtoggle(btn) {
				const el = btn?.closest?.('.card-panel[id^="nday"], .nday-panel, .card-panel') || document.getElementById('nday');
				if (!el) return false;
				el.classList.toggle('off');
				const isOff = el.classList.contains('off');

				// CSS .card-panel.off      JS   
				try {
					Array.from(el.children || []).forEach((ch) => {
						if (!ch || !(ch instanceof Element)) return;
						// / 
						if (ch.matches('h3.grid-wrap-title') || ch.matches('i.line')) {
							ch.style.display = '';
							return;
						}
						ch.style.display = isOff ? 'none' : '';
					});
				} catch (_) {}

				return isOff;
			}

			function __resetSelectWidgets(root) {
				if (!root) return;
				root.querySelectorAll('.jw-select').forEach(wrap => {
					const sel = wrap.querySelector('select');
					if (!sel) { wrap.remove(); return; }
					sel.classList.remove('jw-sr-only');
					sel.classList.add('select');
					wrap.parentNode?.insertBefore(sel, wrap);
					wrap.remove();
				});
				root.querySelectorAll('select.jw-sr-only').forEach(sel => {
					if (sel.closest('.jw-select')) return;
					sel.classList.remove('jw-sr-only');
					sel.classList.add('select');
				});
				//  :    14~16   ( )
				try { __patchFlightHourSelects24(root); } catch (_) {}
				//   5  (  UX )
				try { __patchMinuteSelects5(root); } catch (_) {}
				if (typeof jw_select === 'function') jw_select();
			}

			//   "" select 00~23  ( 14~16   )
			function __patchFlightHourSelects24(scope) {
				const root = scope || document;
				const panels = Array.from(root.querySelectorAll('[data-section-name="flight-information"].card-panel'));
				panels.forEach((p) => {
					const sels = Array.from(p.querySelectorAll('.meeting-wrap select'));
					// 0,2 = hour / 1,3 = minute
					const hour1 = sels[0] || null;
					const hour2 = sels[2] || null;
					[hour1, hour2].forEach((sel) => {
						if (!sel) return;
						const cur = String(sel.value || '').trim();
						const keepNum = parseInt(cur.replace(/[^0-9]/g, '') || '0', 10);
						const keep = String(Math.max(0, Math.min(23, keepNum))).padStart(2, '0');
						sel.innerHTML = '';
						for (let h = 0; h <= 23; h++) {
							const v = String(h).padStart(2, '0');
							const o = document.createElement('option');
							o.value = v;
							o.textContent = v;
							sel.appendChild(o);
						}
						sel.value = keep;
						try { sel.dispatchEvent(new Event('change', { bubbles: true })); } catch (_) {}
					});
				});
			}

			//  select  "" select 10 (00,10,20,30,40,50)  5  
			function __patchMinuteSelects5(scope) {
				const root = scope || document;
				const minuteSelects = Array.from(root.querySelectorAll('.meeting-wrap select'));
				minuteSelects.forEach((sel) => {
					const opts = Array.from(sel.options || []).map(o => String(o.value || o.textContent || '').trim());
					const normalized = opts.map(v => v.padStart(2, '0'));
					// 10  minute select  ( 5   )
					const isTen = (normalized.length === 6 || normalized.length === 7) &&
						normalized.includes('00') && normalized.includes('10') && normalized.includes('20') &&
						normalized.includes('30') && normalized.includes('40') && normalized.includes('50') &&
						!normalized.includes('05');
					if (!isTen) return;

					// hour select     , hour  24   
					const cur = String(sel.value || '').trim();
					const curNum = parseInt(cur.replace(/[^0-9]/g, '') || '0', 10);
					const keep = String(Math.max(0, Math.min(55, Math.floor(curNum / 5) * 5))).padStart(2, '0');

					sel.innerHTML = '';
					for (let m = 0; m <= 55; m += 5) {
						const v = String(m).padStart(2, '0');
						const o = document.createElement('option');
						o.value = v;
						o.textContent = v;
						sel.appendChild(o);
					}
					sel.value = keep;
					try { sel.dispatchEvent(new Event('change', { bubbles: true })); } catch (_) {}
				});
			}

			function __resetEditors(root) {
				if (!root) return;
				root.querySelectorAll('.jweditor').forEach(ed => {
					ed.className = 'jweditor';
					ed.innerHTML = '';
				});
				if (typeof board === 'function') board();
			}

			function __resetInputs(root) {
				if (!root) return;
				root.querySelectorAll('input').forEach(inp => {
					const type = (inp.type || '').toLowerCase();
					if (type === 'file') { inp.value = ''; return; }
					if (type === 'checkbox' || type === 'radio') { inp.checked = false; return; }
					if (type === 'hidden') return;
					inp.value = '';
				});
				root.querySelectorAll('textarea').forEach(t => { t.value = ''; });
				root.querySelectorAll('select').forEach(sel => {
					if (sel.disabled) return;
					sel.selectedIndex = 0;
				});
			}

			//       
			function template_detail_sdaf(btn) {
				const list = (btn.closest('.aside') || document).querySelector('.aside-row-list');
				if (!list) return;
				// IMPORTANT: aside-row-list  HTML Day 2    ( 1  2)
				// list  day  1Day  3Day   .
				// =>    day (.nday-panel)  day + 1  .
				const base = document.getElementById('nday');
				if (base) {
					base.dataset.day = base.dataset.day || '1';
					base.classList.add('nday-panel');
				}
				let maxDay = 0;
				Array.from(document.querySelectorAll('.nday-panel')).forEach((p) => {
					const n = parseInt(String(p.dataset.day || '').replace(/[^0-9]/g, ''), 10);
					if (!Number.isNaN(n)) maxDay = Math.max(maxDay, n);
				});
				const day = Math.max(1, maxDay) + 1;
				const lang = (typeof getCookie === 'function' ? (getCookie('lang') || 'eng') : 'eng');
				const isKo = /^(ko|kor)$/i.test(String(lang));
				const dayText = isKo ? `${day}` : `Day ${day}`;

				// aside 
				const already = Array.from(list.querySelectorAll('.aside-row__subtitle')).some((el) => {
					const lan = String(el.getAttribute('data-lan-eng') || '').trim();
					if (lan === `Day ${day}`) return true;
					const m = String(el.textContent || '').match(/(\d+)/);
					return m ? (parseInt(m[1], 10) === day) : false;
				});
				if (!already) {
					const row = document.createElement('div');
					row.className = 'aside-row';
					row.innerHTML = `
						<div class="aside-row__subtitle" data-scroll-target="day-${day}" onclick="scrollToDayPanel(${day})" style="cursor:pointer;" data-lan-eng="Day ${day}">${dayText}</div>
						<button type="button" class="jw-button aside-add-section" onclick="template_detail_sdaf_delete(this)"><img src="../image/minus.svg" alt=""></button>
					`;
					list.appendChild(row);
				}

				//  day  
				if (base) {
					base.dataset.day = base.dataset.day || '1';
					base.classList.add('nday-panel');
					const copy = base.cloneNode(true);
					copy.removeAttribute('id');
					copy.dataset.day = String(day);
					copy.classList.add('nday-panel');

					const dayBtn = copy.querySelector('h3 button');
					if (dayBtn) {
						dayBtn.setAttribute('onclick', 'ndasdtoggle(this)');
						dayBtn.childNodes.forEach(n => { if (n.nodeType === Node.TEXT_NODE) n.textContent = `${day}Day `; });
						if (!dayBtn.textContent.includes('Day')) dayBtn.innerHTML = `${day}Day <img src="../image/arrow42.svg" alt="">`;
					}

					const panels = Array.from(base.parentNode.querySelectorAll('.nday-panel'));
					const last = panels[panels.length - 1] || base;
					last.parentNode.insertBefore(copy, last.nextSibling);

					// IMPORTANT:
					// - Quill(board)  DOM    .
					// - cloneNode   __resetEditors(copy)    Transportation/Accommodation 
					//     " "  .
					__resetInputs(copy);
					__resetEditors(copy);

					// DOM   jw_select ( select display:none)  select 
					__resetSelectWidgets(copy);
				}

				//  (  )
				try { if (typeof language_apply === 'function') language_apply(lang); } catch (_) {}
			}

			function template_detail_sdaf_delete(btn) {
				const row = btn.closest('.aside-row');
				if (!row) return;
				const list = row.closest('.aside-row-list');
				let dayNum = null;
				if (list) {
					const rows = Array.from(list.querySelectorAll('.aside-row'));
					const idx = rows.indexOf(row);
					if (idx >= 0) dayNum = idx + 1;
				}
				if (dayNum && dayNum > 1) {
					document.querySelector(`.nday-panel[data-day="${dayNum}"]`)?.remove();
				}
				row.remove();

				// (aside +   data-day)
				try {
					const lang = (typeof getCookie === 'function' ? (getCookie('lang') || 'eng') : 'eng');
					const isKo = /^(ko|kor)$/i.test(String(lang));
					if (list) {
						Array.from(list.querySelectorAll('.aside-row')).forEach((el, i) => {
							const n = i + 1;
							const sub = el.querySelector('.aside-row__subtitle');
							if (!sub) return;
							sub.setAttribute('data-lan-eng', `Day ${n}`);
							sub.setAttribute('data-scroll-target', `day-${n}`);
							sub.setAttribute('onclick', `scrollToDayPanel(${n})`);
							sub.style.cursor = 'pointer';
							sub.textContent = isKo ? `${n}` : `Day ${n}`;
						});
					}
					Array.from(document.querySelectorAll('.nday-panel')).forEach((p, i) => {
						p.dataset.day = String(i + 1);
					});
					try { if (typeof language_apply === 'function') language_apply(lang); } catch (_) {}
				} catch (_) {}
			}

			//  / (   )
			function template_detail_dfghs(btn) {
				const panel = btn.closest('.sub-panel');
				if (!panel) return;
				const tpl = panel.querySelector('.dfghs');
				if (!tpl) return;
				const copy = tpl.cloneNode(true);
				copy.removeAttribute('id');
				panel.appendChild(copy);
				__resetInputs(copy);
				__resetEditors(copy);
				// DOM   jw_select   select 
				__resetSelectWidgets(copy);
				try { copy.scrollIntoView({ block: 'start', behavior: 'smooth' }); } catch (_) {}
				return copy;
			}

			function template_detail_hsdfghsh(btn) {
				const box = btn.closest('.dfghs');
				if (!box) return false;
				box.remove();
				return true;
			}

			//  ( onclick )
			window.ndasdtoggle = ndasdtoggle;
			window.template_detail_sdaf_cate = template_detail_sdaf_cate;
			window.template_detail_sdaf = template_detail_sdaf;
			window.template_detail_sdaf_delete = template_detail_sdaf_delete;
			window.template_detail_dfghs = template_detail_dfghs;
			window.template_detail_hsdfghsh = template_detail_hsdfghsh;

			// (   FormData )
			async function saveFromPreviewToDb(opts = {}) {
				const saveMode = String(opts?.saveMode || 'active').toLowerCase();
				const isTemporary = (saveMode === 'temporary' || saveMode === 'temp' || saveMode === 'draft');
				//   id ( / id    )
				try { __ensureProductIds(); } catch (_) {}
				const isSectionHidden = (name) => {
					const nodes = Array.from(document.querySelectorAll(`[data-section-name="${name}"]`));
					if (!nodes.length) return false;
					return nodes.every(n => n.classList.contains('hidden'));
				};
				const flightHidden = isSectionHidden('flight-information');
				const iljastarHidden = isSectionHidden('iljastar');
				const pohamHidden = isSectionHidden('poham');

				const normalizeMainCode = (v) => {
					const s = String(v || '').trim();
					const map = {
						'': 'season', 'Seasonal': 'season', 'season': 'season',
						'': 'region', 'Regional': 'region', 'region': 'region',
						'': 'theme', 'Theme': 'theme', 'theme': 'theme',
						'': 'private', 'Private': 'private', 'private': 'private',
						'': 'daytrip', 'Day Trip': 'daytrip', 'daytrip': 'daytrip', 'oneday': 'daytrip'
					};
					return map[s] || String(s).toLowerCase();
				};
				const packageName =
					String(document.getElementById('productName')?.value || '').trim() ||
					String(__ensureIdFromLanEng('Product Name', 'productName')?.value || __ensureId('', 'productName')?.value || '').trim();
				if (!packageName) throw new Error(' .');

				const salesTarget = String(document.getElementById('salesTarget')?.value || '').trim() || 'B2B';
				const mainRaw = String(document.getElementById('mainCategory')?.value || '').trim();
				const mainCategory = normalizeMainCode(mainRaw);
				const subRaw = String(document.getElementById('subCategory')?.value || '').trim();
				const subCategory = subRaw ? String(subRaw).trim() : '';

				const descNode =
					document.getElementById('productDescriptionEditor') ||
					__ensureIdFromLanEng('Product Description', 'productDescriptionEditor', '.jweditor') ||
					__ensureId(' ', 'productDescriptionEditor', '.jweditor');
				const getEditorHtml = (ed) => {
					if (!ed) return '';
					try {
						const ql = ed.querySelector?.('.ql-editor');
						if (ql) return String(ql.innerHTML || '').trim();
					} catch (_) {}
					return String(ed.innerHTML || '').trim();
				};
				const descHtml = getEditorHtml(descNode);
				if (!isTemporary) {
				if (!descHtml || descHtml === '<p><br></p>') throw new Error('  : productDescription');
				}

				const fd = new FormData();
				//   ( off       )
				// - true:  ()
				// - false:  ()
				try {
					fd.append('adminComponents', JSON.stringify({
						flight: !flightHidden,
						iljastar: !iljastarHidden,
						poham: !pohamHidden
					}));
				} catch (_) {}
				fd.append('saveMode', saveMode);
				fd.append('packageId', String(productId));
				fd.append('productName', packageName);
				fd.append('salesTarget', salesTarget);
				fd.append('mainCategory', mainCategory);
				fd.append('subCategory', subCategory);
				if (!isTemporary || (descHtml && descHtml !== '<p><br></p>')) {
				fd.append('productDescription', descHtml);
				}

				const salesPeriod = String(document.getElementById('contract-period')?.value || '').trim();
				if (salesPeriod) fd.append('salesPeriod', salesPeriod);

				// IMPORTANT: backend에서 빈 값(0)을 처리하는 방식에 따라 ""로 전송.
				// - 기존 값이 있으면 유지하고, 새 값이 있으면 덮어쓰기.
				const pkgLoaded = (__lastLoadedDetail && __lastLoadedDetail.package) ? __lastLoadedDetail.package : {};
				const minRaw = String(document.getElementById('minParticipants')?.value || '').trim();
				const maxRaw = String(document.getElementById('maxParticipants')?.value || '').trim();
				const b2cRaw = String(document.getElementById('b2cPrice')?.value || '').trim();
				const b2bRaw = String(document.getElementById('b2bPrice')?.value || '').trim();
				const priceDisplayTextRaw = String(document.getElementById('priceDisplayText')?.value || '').trim();
				const b2bPriceDisplayTextRaw = String(document.getElementById('b2bPriceDisplayText')?.value || '').trim();
				if (!isTemporary) {
					// 최소인원 / 최대인원 필수 (빈 값이거나 0이면 오류)
					if (minRaw === '' || maxRaw === '') throw new Error('Please enter Minimum departure headcount and Maximum capacity.');
				}
				const minP = (minRaw !== '') ? minRaw : String(pkgLoaded?.minParticipants ?? '').trim();
				const maxP = (maxRaw !== '') ? maxRaw : String(pkgLoaded?.maxParticipants ?? '').trim();
				const b2cPrice = (b2cRaw !== '') ? b2cRaw : String(pkgLoaded?.packagePrice ?? pkgLoaded?.base_price ?? '').trim();
				const b2bPriceVal = (b2bRaw !== '') ? b2bRaw : String(pkgLoaded?.b2b_price ?? '').trim();
				if (minP !== '') fd.append('minParticipants', String(parseInt(String(minP).replace(/[^0-9]/g, ''), 10) || 0));
				if (maxP !== '') fd.append('maxParticipants', String(parseInt(String(maxP).replace(/[^0-9]/g, ''), 10) || 0));
				// B2C 가격 (packagePrice로 저장)
				if (b2cPrice !== '') fd.append('packagePrice', String(parseInt(String(b2cPrice).replace(/[^0-9]/g, '') || '0', 10)));
				// B2B 가격
				if (b2bPriceVal !== '') fd.append('b2bPrice', String(parseInt(String(b2bPriceVal).replace(/[^0-9]/g, '') || '0', 10)));
				// 가격 텍스트 (문자열로 표시할 가격)
				fd.append('priceDisplayText', priceDisplayTextRaw);
				fd.append('b2bPriceDisplayText', b2bPriceDisplayTextRaw);
				// packages.packagePrice(첫 번째 옵션을 기준) "성인 요금" 매핑
				(function () {
					const feePanel =
						document.querySelector('.card-panel .grid-wrap-title[data-lan-eng="Number of people fee"]')?.closest('.card-panel') ||
						null;
					if (!feePanel) {
						if (b2cPrice) fd.append('adultPrice', b2cPrice);
						return;
					}
					const rows = Array.from(feePanel.querySelectorAll('tbody tr'));
					let adult = null, child = null, infant = null;
					let b2bAdult = null, b2bChild = null, b2bInfant = null;
					rows.forEach((tr) => {
						const inputs = Array.from(tr.querySelectorAll('input.form-control'));
						const name = String(inputs[0]?.value || '').toLowerCase().trim();
						const price = String(inputs[1]?.value || '').trim().replace(/[^0-9.]/g, '');
						const b2bPrice = String(inputs[2]?.value || '').trim().replace(/[^0-9.]/g, '');
						if (!name) return;
						const p = price !== '' ? parseFloat(price) : null;
						const bp = b2bPrice !== '' ? parseFloat(b2bPrice) : null;
						if (name.includes('adult') || name.includes('성인')) {
							if (Number.isFinite(p)) adult = p;
							if (Number.isFinite(bp)) b2bAdult = bp;
						} else if (name.includes('child') || name.includes('아동')) {
							if (Number.isFinite(p)) child = p;
							if (Number.isFinite(bp)) b2bChild = bp;
						} else if (name.includes('infant') || name.includes('유아')) {
							if (Number.isFinite(p)) infant = p;
							if (Number.isFinite(bp)) b2bInfant = bp;
						}
					});
					// B2C 가격
					if (adult !== null) fd.append('adultPrice', String(Math.round(adult)));
					else if (b2cPrice) fd.append('adultPrice', b2cPrice);
					if (child !== null) fd.append('childPrice', String(Math.round(child)));
					if (infant !== null) fd.append('infantPrice', String(Math.round(infant)));
					// B2B 가격
					if (b2bAdult !== null) fd.append('b2bAdultPrice', String(Math.round(b2bAdult)));
					if (b2bChild !== null) fd.append('b2bChildPrice', String(Math.round(b2bChild)));
					if (b2bInfant !== null) fd.append('b2bInfantPrice', String(Math.round(b2bInfant)));
				})();

				//  
				(function () {
					const schedulePanel =
						document.querySelector('.card-panel h3.grid-wrap-title[data-lan-eng="Meeting Information"]')?.closest('.card-panel') ||
						null;
					if (!schedulePanel) return;
					const selects = Array.from(schedulePanel.querySelectorAll('select'));
					const hour = selects[0]?.value ?? '00';
					const minute = selects[1]?.value ?? '00';
					fd.append('meetingHour', hour);
					fd.append('meetingMinute', minute);
					const inputs = Array.from(schedulePanel.querySelectorAll('input.form-control'));
					// SMT: save meeting info if value exists (even if disabled), but skip placeholder values
					const v0 = String(inputs[0]?.value || '').trim();
					const v1 = String(inputs[1]?.value || '').trim();
					if (inputs[0] && v0 && !/^please search/i.test(v0)) fd.append('meetingLocation', v0);
					if (inputs[1] && v1 && !/^please search/i.test(v1)) fd.append('meetingAddress', v1);
				})();

				// /
				const buildLinesFromTable = (panelTitleLanEng, panelTitleKo) => {
					const panels = Array.from(document.querySelectorAll('.card-panel'));
					const panel =
						document.querySelector(`.card-panel .grid-wrap-title[data-lan-eng="${CSS.escape(panelTitleLanEng)}"]`)?.closest('.card-panel') ||
						null;
					if (!panel) return '';
					const inputs = Array.from(panel.querySelectorAll('tbody input.form-control, tbody textarea.form-control, tbody input[type="text"]'));
					const lines = inputs.map(i => (i.value || '').trim()).filter(Boolean);
					return lines.join('\n');
				};
				if (!pohamHidden) {
					const includedItems = buildLinesFromTable('Included items', ' ');
					const excludedItems = buildLinesFromTable('Excluded items', ' ');
					if (includedItems) fd.append('included_items', includedItems);
					if (excludedItems) fd.append('excluded_items', excludedItems);
				}

				// 
				const readFlightPanel = (titleText) => {
					const panels = Array.from(document.querySelectorAll('[data-section-name="flight-information"].card-panel'));
					const wantDeparture = /departure/i.test(String(titleText || ''));
					const panel = panels.find(p => {
						const h3 = p.querySelector('h3.grid-wrap-title, h3');
						const eng = String(h3?.getAttribute?.('data-lan-eng') || '').trim();
						const txt = String(h3?.textContent || '').trim();
						if (wantDeparture) return eng === 'Departure flight' || /departure/i.test(txt);
						return eng === 'Return trip' || /return/i.test(txt);
					});
					if (!panel) return null;
					const flightNumber = String(panel.querySelector('input.form-control')?.value || '').trim();
					// Airline은 별도 select (.airline-select)
					const airlineName = String(panel.querySelector('.airline-select')?.value || '').trim();
					// NOTE: flight panel  / select     select
					const selects = Array.from(panel.querySelectorAll('.meeting-wrap select'));
					const depH = String(selects[0]?.value || '00').padStart(2, '0');
					const depM = String(selects[1]?.value || '00').padStart(2, '0');
					const arrH = String(selects[2]?.value || '00').padStart(2, '0');
					const arrM = String(selects[3]?.value || '00').padStart(2, '0');
					const textInputs = Array.from(panel.querySelectorAll('input.form-control'));
					const depPoint = String(textInputs[1]?.value || '').trim();
					const dest = String(textInputs[2]?.value || '').trim();
					return { flightNumber, airlineName, depH, depM, arrH, arrM, depPoint, dest };
				};
				if (!flightHidden) {
					const dep = readFlightPanel('departure');
					const ret = readFlightPanel('return');
					console.log('[Flight Save Debug] departure:', dep);
					console.log('[Flight Save Debug] return:', ret);
					if (dep && dep.flightNumber) {
						fd.append('departureFlightNumber', dep.flightNumber);
						fd.append('departureFlightAirline', dep.airlineName);
						fd.append('departureFlightDepartureHour', dep.depH);
						fd.append('departureFlightDepartureMinute', dep.depM);
						fd.append('departureFlightArrivalHour', dep.arrH);
						fd.append('departureFlightArrivalMinute', dep.arrM);
						fd.append('departureFlightDeparturePoint', dep.depPoint);
						fd.append('departureFlightDestination', dep.dest);
					}
					if (ret && ret.flightNumber) {
						fd.append('returnFlightNumber', ret.flightNumber);
						fd.append('returnFlightAirline', ret.airlineName);
						fd.append('returnFlightDepartureHour', ret.depH);
						fd.append('returnFlightDepartureMinute', ret.depM);
						fd.append('returnFlightArrivalHour', ret.arrH);
						fd.append('returnFlightArrivalMinute', ret.arrM);
						fd.append('returnFlightDeparturePoint', ret.depPoint);
						fd.append('returnFlightDestination', ret.dest);
					}
				}

				// (/ )
				const dayPanels = Array.from(document.querySelectorAll('.nday-panel')) || [];
				const panelsToUse = dayPanels.length ? dayPanels : [document.getElementById('nday')].filter(Boolean);

				const getExistingFilename = (root) => {
					const img = root?.querySelector?.('.upload-item.is-filled img.preview, .upload-item.is-filled img');
					const src = String(img?.getAttribute?.('src') || '').trim();
					if (!src) return '';
					try {
						const u = new URL(src, window.location.href);
						return (u.pathname.split('/').pop() || '');
					} catch (_) {
						return (src.split('?')[0].split('#')[0].split('/').pop() || '');
					}
				};

				let attractionIdx = 0;
				const attractions = [];
				panelsToUse.forEach((p, idx) => {
					const dayNum = idx + 1;
					const summaryInput =
						p.querySelector('.label-name [data-lan-eng="Schedule Summary"]')?.closest('.grid-item')?.querySelector('input.form-control') ||
						p.querySelector('.label-name[data-lan-eng="Schedule Summary"]')?.closest('.grid-item')?.querySelector('input.form-control') ||
						p.querySelector('input.form-control[placeholder="Schedule Summary"]') ||
						null;
					const summary = String(summaryInput?.value || '').trim();
					fd.append(`day${dayNum}_description`, summary);

					const attractionBlocks = Array.from(p.querySelectorAll('.dfghs'));
					attractionBlocks.forEach((block, bIdx) => {
						//   select ( toolbar  select    )
						const selects = Array.from(block.querySelectorAll('.meeting-wrap select'));
						const textInputs = Array.from(block.querySelectorAll('input.form-control'));
						const name = String(textInputs[0]?.value || '').trim();
						const address = String(textInputs[1]?.value || '').trim();
						const descEd = block.querySelector('.jweditor');
						const descriptionHtml = getEditorHtml(descEd);

						const imageKey = `attractionImage_${attractionIdx}`;
						// NOTE: block   file input  upload-grid  file input 
						const fileInput = block.querySelector('.upload-grid input[type="file"]');
						if (fileInput?.files?.[0]) fd.append(imageKey, fileInput.files[0]);
						const existingImage = String(block.dataset?.existingImage || fileInput?.dataset?.existing || '').trim();

						attractions.push({
							day: dayNum,
							order: bIdx + 1,
							name,
							address,
							descriptionHtml,
							startHour: selects[0]?.value ?? '',
							startMinute: selects[1]?.value ?? '',
							endHour: selects[2]?.value ?? '',
							endMinute: selects[3]?.value ?? '',
							imageKey,
							existingImage
						});
						attractionIdx += 1;
					});

					const firstBlock = attractionBlocks[0];
					if (firstBlock) {
						const selects = Array.from(firstBlock.querySelectorAll('.meeting-wrap select'));
						fd.append(`day${dayNum}_startHour`, selects[0]?.value ?? '00');
						fd.append(`day${dayNum}_startMinute`, selects[1]?.value ?? '00');
						fd.append(`day${dayNum}_endHour`, selects[2]?.value ?? '00');
						fd.append(`day${dayNum}_endMinute`, selects[3]?.value ?? '00');
						const textInputs = Array.from(firstBlock.querySelectorAll('input.form-control'));
						fd.append(`day${dayNum}_airport`, String(textInputs[0]?.value || '').trim());
						fd.append(`day${dayNum}_airportAddress`, String(textInputs[1]?.value || '').trim());
						const ed = firstBlock.querySelector('.jweditor');
						fd.append(`day${dayNum}_airport_description`, getEditorHtml(ed));
						const firstFile = firstBlock.querySelector('.upload-grid input[type="file"]');
						if (firstFile?.files?.[0]) fd.append(`day${dayNum}_airportImage`, firstFile.files[0]);
						const firstExisting = String(firstBlock.dataset?.existingImage || firstFile?.dataset?.existing || '').trim();
						if (firstExisting) fd.append(`day${dayNum}_airportImage_existing`, firstExisting);
					}

					const accomPanel = Array.from(p.querySelectorAll('.sub-panel')).find(sp => sp.querySelector('[data-lan-eng="Accommodation Information"]'));
					if (accomPanel) {
						const accomInputs = Array.from(accomPanel.querySelectorAll('input.form-control'));
						fd.append(`day${dayNum}_accommodationName`, String(accomInputs[0]?.value || '').trim());
						fd.append(`day${dayNum}_accommodationAddress`, String(accomInputs[1]?.value || '').trim());
						const accomEd = accomPanel.querySelector('.jweditor');
						fd.append(`day${dayNum}_accommodation_description`, getEditorHtml(accomEd));
						const accomFile = accomPanel.querySelector('.upload-grid input[type="file"]');
						if (accomFile?.files?.[0]) fd.append(`day${dayNum}_accommodationImage`, accomFile.files[0]);
						const accomExisting = String(accomPanel.dataset?.existingImage || accomFile?.dataset?.existing || '').trim();
						if (accomExisting) fd.append(`day${dayNum}_accommodationImage_existing`, accomExisting);
					}

					const transPanel = Array.from(p.querySelectorAll('.sub-panel')).find(sp => sp.querySelector('[data-lan-eng="Transportation Information"]'));
					if (transPanel) {
						const transEd = transPanel.querySelector('.jweditor');
						fd.append(`day${dayNum}_transportation_description`, getEditorHtml(transEd));
					}

					const mealPanel = Array.from(p.querySelectorAll('.sub-panel')).find(sp => sp.querySelector('[data-lan-eng="Meal Information"]'));
					if (mealPanel) {
						const mealInputs = Array.from(mealPanel.querySelectorAll('input.form-control'));
						fd.append(`day${dayNum}_breakfast`, String(mealInputs[0]?.value || '').trim());
						fd.append(`day${dayNum}_lunch`, String(mealInputs[1]?.value || '').trim());
						fd.append(`day${dayNum}_dinner`, String(mealInputs[2]?.value || '').trim());
					}
				});
				fd.append('attractionsJson', JSON.stringify(attractions));

				// 공통 숙박 정보 (Common Accommodation) - 다중 숙소 지원
				(function() {
					const container = document.getElementById('accommodationBlocksContainer');
					if (!container) return;

					const blocks = Array.from(container.querySelectorAll('.accommodation-block'));
					const accommodations = [];

					blocks.forEach((block, idx) => {
						const nameInput = block.querySelector('.accom-name');
						const addrInput = block.querySelector('.accom-address');
						const descEditor = block.querySelector('.accom-description');
						const imageGrid = block.querySelector('.accom-image-grid');

						const name = String(nameInput?.value || '').trim();
						const address = String(addrInput?.value || '').trim();
						const description = getEditorHtml(descEditor);

						// 이미지 처리
						const imageFile = imageGrid?.querySelector('input[type="file"]');
						const imagePicked = imageFile?.files?.[0] || null;
						const existingImage = String(block.dataset?.existingImage || imageFile?.dataset?.existing || '').trim();

						// 이미지 파일이 있으면 FormData에 추가
						if (imagePicked) {
							fd.append(`accommodationImage_${idx}`, imagePicked);
						}

						accommodations.push({
							sortOrder: idx,
							name: name,
							address: address,
							description: description,
							existingImage: existingImage,
							hasNewImage: !!imagePicked
						});
					});

					fd.append('accommodationsJson', JSON.stringify(accommodations));
				})();

				// 공통 교통 정보 (Common Transportation)
				(function() {
					const transPanel = document.getElementById('commonTransportation');
					if (transPanel) {
						const descEditor = document.getElementById('commonTransEditor');
						fd.append('common_transportation_description', getEditorHtml(descEditor));
					}
				})();

				// 인원별 요금 (B2C/B2B 가격)
				(function () {
					const feePanel =
						document.querySelector('.card-panel .grid-wrap-title[data-lan-eng="Number of people fee"]')?.closest('.card-panel') ||
						null;
					if (!feePanel) return;
					const rows = Array.from(feePanel.querySelectorAll('tbody tr'));
					rows.forEach((tr) => {
						const inputs = Array.from(tr.querySelectorAll('input.form-control'));
						const optionName = String(inputs[0]?.value || '').trim();
						const optionPriceRaw = String(inputs[1]?.value || '').trim();
						const optionB2bPriceRaw = String(inputs[2]?.value || '').trim();
						if (!optionName) return;
						const optionPrice = optionPriceRaw.replace(/[^0-9.]/g, '');
						const optionB2bPrice = optionB2bPriceRaw.replace(/[^0-9.]/g, '');
						fd.append('optionName[]', optionName);
						// B2C 가격 (정수만)
						fd.append('optionPrice[]', String(parseInt(String(optionPrice || '0').split('.')[0] || '0', 10) || 0));
						// B2B 가격 (정수만)
						fd.append('optionB2bPrice[]', String(parseInt(String(optionB2bPrice || '0').split('.')[0] || '0', 10) || 0));
					});
				})();

				// 일자별 판매조정 (Daily Sales Adjustment)
				(function () {
					if (iljastarHidden) return;
					const panel = document.querySelector('.iljastar');
					if (!panel) return;

					// 기본 가격 가져오기 (가격이 0이거나 비어있으면 사용)
					const b2cDefault = String(document.getElementById('b2cPrice')?.value || '0').replace(/[^0-9]/g, '') || '0';
					const b2bDefault = String(document.getElementById('b2bPrice')?.value || '0').replace(/[^0-9]/g, '') || '0';

					const rows = Array.from(panel.querySelectorAll('tbody tr'));
					rows.forEach((tr) => {
						// 활성 행만 처리
						if (String(tr.dataset.active || '') !== '1') return;
						const tds = Array.from(tr.querySelectorAll('td'));
						const date = String(tds[1]?.textContent || '').trim();
						const inputs = Array.from(tr.querySelectorAll('input.form-control'));
						const seats = String(inputs[0]?.value || '').trim().replace(/[^0-9]/g, '');
						let price = String(inputs[1]?.value || '').trim().replace(/[^0-9.]/g, '');
						let b2bPrice = String(inputs[2]?.value || '').trim().replace(/[^0-9.]/g, '');
						if (!date) return;

						// 가격이 0이거나 비어있으면 기본 가격 사용
						const priceInt = parseInt(String(price || '0').split('.')[0] || '0', 10) || 0;
						const b2bPriceInt = parseInt(String(b2bPrice || '0').split('.')[0] || '0', 10) || 0;

						fd.append('availabilityDate[]', date);
						fd.append('availabilitySeats[]', seats || '0');
						// B2C 가격 (정수만) - 0이면 기본값
						fd.append('availabilityPrice[]', String(priceInt || parseInt(b2cDefault, 10) || 0));
						// B2B 가격 (정수만) - 0이면 기본값
						fd.append('availabilityB2bPrice[]', String(b2bPriceInt || parseInt(b2bDefault, 10) || 0));
					});

					// 삭제된 날짜 전송
					if (panel.__deletedDates && panel.__deletedDates.size > 0) {
						Array.from(panel.__deletedDates).forEach(d => {
							fd.append('deletedDates[]', d);
						});
					}
				})();

				// / ///(//)
				(function () {
					const feePanel =
						document.querySelector('.card-panel .grid-wrap-title[data-lan-eng="Room rate for single occupancy"]')?.closest('.card-panel') ||
						null;
					const input = feePanel?.querySelector('input.form-control');
					const val = String(input?.value || '').trim();
					// SMT: keep decimals (avoid scaling "1000000.00" -> "100000000" which causes DB out-of-range)
					const raw = String(val || '').replace(/[^0-9.]/g, '');
					if (raw) fd.append('singleRoomFee', raw);

					const h2 = document.querySelector('h2.section-title[data-lan-eng="Cancellation/Refund Policy"]');
					const panel = h2?.nextElementSibling;
					const refund = String(panel?.querySelector('input.form-control')?.value || '').trim().replace(/[^0-9]/g, '');
					if (refund) fd.append('refundDays', refund);

					const sectionEditorHtml = (lanEngTitle, koTitle) => {
						const h2 = document.querySelector(`h2.section-title[data-lan-eng="${CSS.escape(lanEngTitle)}"]`);
						const panel = h2?.nextElementSibling;
						if (!panel) return '';
						const eds = Array.from(panel.querySelectorAll('.jweditor'));
						return String(eds[eds.length - 1]?.innerHTML || '').trim();
					};
					const usageHtml = sectionEditorHtml('Usage Guide', '');
					const cancelHtml = sectionEditorHtml('Cancellation/Refund Policy', '/');
					const visaHtml = sectionEditorHtml('Visa Application Guide', ' ');
					if (usageHtml) fd.append('usage_guide', usageHtml);
					if (cancelHtml) fd.append('cancellation_policy', cancelHtml);
					if (visaHtml) fd.append('visa_guide', visaHtml);

					const usagePanel =
						document.querySelector('h2.section-title[data-lan-eng="Usage Guide"]')?.nextElementSibling ||
						null;
					const usageFile = usagePanel?.querySelector('input[type="file"]');
					if (usageFile?.files?.[0]) fd.append('usageGuideFile', usageFile.files[0]);
					else {
						//   
						const ex = String(usageFile?.dataset?.existing || '').trim();
						if (ex) {
							fd.append('usageGuideFile_existing', ex);
							const exName = String(usageFile?.dataset?.existingName || ex).trim();
							if (exName) fd.append('usageGuideFileName_existing', exName);
						}
					}

					// SMT (#165): product documents (flyer/itinerary/detail)
					const flyer = document.getElementById('flyerFileInput');
					if (flyer?.files?.[0]) fd.append('flyerFile', flyer.files[0]);
					else {
						const ex = String(flyer?.dataset?.existing || '').trim();
						if (ex) {
							fd.append('flyerFile_existing', ex);
							const exName = String(flyer?.dataset?.existingName || ex).trim();
							if (exName) fd.append('flyerFileName_existing', exName);
							const exSize = String(flyer?.dataset?.existingSize || '').trim();
							if (exSize) fd.append('flyerFileSize_existing', exSize);
						}
					}

					const itin = document.getElementById('itineraryFileInput');
					if (itin?.files?.[0]) fd.append('itineraryFile', itin.files[0]);
					else {
						const ex = String(itin?.dataset?.existing || '').trim();
						if (ex) {
							fd.append('itineraryFile_existing', ex);
							const exName = String(itin?.dataset?.existingName || ex).trim();
							if (exName) fd.append('itineraryFileName_existing', exName);
							const exSize = String(itin?.dataset?.existingSize || '').trim();
							if (exSize) fd.append('itineraryFileSize_existing', exSize);
						}
					}

					const detailDoc = document.getElementById('detailFileInput');
					if (detailDoc?.files?.[0]) fd.append('detailFile', detailDoc.files[0]);
					else {
						const ex = String(detailDoc?.dataset?.existing || '').trim();
						if (ex) {
							fd.append('detailFile_existing', ex);
							const exName = String(detailDoc?.dataset?.existingName || ex).trim();
							if (exName) fd.append('detailFileName_existing', exName);
							const exSize = String(detailDoc?.dataset?.existingSize || '').trim();
							if (exSize) fd.append('detailFileSize_existing', exSize);
						}
					}

					// (//) -  id (/  )
					const thumb = document.getElementById('thumbnailImageInput');
					const thumbItem = thumb?.closest?.('.grid-item') || null;
					if (thumb?.files?.[0]) fd.append('thumbnailImage', thumb.files[0]);
					if (!thumb?.files?.[0]) {
						const existing = String(thumb?.dataset?.existing || getExistingFilename(thumbItem) || '').trim();
						if (existing) fd.append('thumbnailImage_existing', existing);
					}

					const detail = document.getElementById('detailImageInput');
					const detailItem = detail?.closest?.('.grid-item') || null;
					if (detail?.files?.[0]) fd.append('detailImage', detail.files[0]);
					if (!detail?.files?.[0]) {
						const existing = String(detail?.dataset?.existing || getExistingFilename(detailItem) || '').trim();
						if (existing) fd.append('detailImage_existing', existing);
					}

					const productImagePanel =
						document.querySelector('.upload-grid[data-field="productImages"]')?.closest('.grid-item') ||
						document.getElementById('productImageInput0')?.closest?.('.grid-item') ||
						null;
					if (productImagePanel) {
						const inputs = [
							document.getElementById('productImageInput0'),
							document.getElementById('productImageInput1'),
							document.getElementById('productImageInput2'),
							document.getElementById('productImageInput3'),
							document.getElementById('productImageInput4'),
						].filter(Boolean);
						inputs.forEach((inp, i) => {
							if (inp.files && inp.files[0]) fd.append(`productImage_${i}`, inp.files[0]);
						});
						//    /: input.dataset.existing (blob URL/ src  )
						try {
							const existingFns = inputs
								.map(inp => String(inp?.dataset?.existing || '').trim())
								.filter(Boolean);
							if (existingFns.length) fd.append('productImages_existing', JSON.stringify(existingFns.slice(0, 5)));
						} catch (_) {}
					}
				})();

				const res = await fetch('../../backend/api/product-register.php', {
					method: 'POST',
					credentials: 'same-origin',
					body: fd
				});
				const json = await res.json().catch(() => ({}));
				if (!res.ok || !json.success) throw new Error(json.message || `  (HTTP ${res.status})`);
				return json;
			}

			async function loadAllToForm() {
				const mapMainToUi = { season: '', region: '', theme: '', private: '', daytrip: '', oneday: '' }; // 
				const res = await fetch(`../../backend/api/package-detail.php?id=${encodeURIComponent(String(productId))}`, { credentials: 'same-origin' });
				const json = await res.json().catch(() => ({}));
				if (!res.ok || !json.success) throw new Error(json?.message || `   (HTTP ${res.status})`);
				const data = json.data || {};
				__lastLoadedDetail = data;
				const pkg = data.package || data.product || {};
				const schedules = Array.isArray(data.schedules) ? data.schedules : [];
				const flights = Array.isArray(data.flights) ? data.flights : [];
				// 인원별 요금 옵션 (package_pricing_options에서 로드)
				const pricingOptions = Array.isArray(pkg.pricingOptions) ? pkg.pricingOptions : (Array.isArray(data.pricingOptions) ? data.pricingOptions : []);
				const availability = Array.isArray(data.availability) ? data.availability : [];
				const guides = Array.isArray(data.guides) ? data.guides : [];

				//   (DB: packages.admin_components) 
				(function applyAdminComponents() {
					const setVisible = (sectionName, visible) => {
						const nodes = Array.from(document.querySelectorAll(`[data-section-name="${sectionName}"]`));
						nodes.forEach(n => n.classList.toggle('hidden', !visible));
						const btn = document.querySelector(`button.aside-add-section[data-target-section="${sectionName}"]`);
						if (btn) {
							btn.classList.toggle('on', !visible);
							const img = btn.querySelector('img');
							if (img) {
								img.src = visible ? '../image/minus.svg' : '../image/plus.svg';
								img.alt = visible ? 'minus' : 'plus';
							}
						}
					};

					let comp = null;
					try {
						const raw = String(pkg.admin_components || pkg.adminComponents || '').trim();
						if (raw) comp = JSON.parse(raw);
					} catch (_) { comp = null; }

					// fallback: DB    "  "  / 
					const flightOn = (comp && typeof comp === 'object' && 'flight' in comp) ? !!comp.flight : (flights.length > 0);
					const iljastarOn = (comp && typeof comp === 'object' && 'iljastar' in comp) ? !!comp.iljastar : (availability.length > 0);
					const pohamOn = (comp && typeof comp === 'object' && 'poham' in comp) ? !!comp.poham : (String(pkg.included_items || '').trim() !== '' || String(pkg.excluded_items || '').trim() !== '');

					setVisible('flight-information', flightOn);
					setVisible('iljastar', iljastarOn);
					setVisible('poham', pohamOn);
				})();

				//    
				const findGridItemByLan = (eng) => {
					const sel = `.grid-item .label-name[data-lan-eng="${CSS.escape(eng)}"], .grid-item .label-name [data-lan-eng="${CSS.escape(eng)}"]`;
					const el = document.querySelector(sel);
					return el ? el.closest('.grid-item') : null;
				};
				const findCardByH3Lan = (eng) => {
					const h3 = document.querySelector(`.card-panel h3.grid-wrap-title[data-lan-eng="${CSS.escape(eng)}"]`);
					return h3 ? h3.closest('.card-panel') : null;
				};
				const findH2ByLan = (eng) => document.querySelector(`h2.section-title[data-lan-eng="${CSS.escape(eng)}"]`);
				const getEditorEl = (root) => root?.querySelector?.('.jweditor') || null;
				// Quill    Day1( )       ,
				//     "  " .
				const setEditorHtml = (ed, html) => {
					if (!ed) return;
					const value = String(html || '');
					const applyOnce = () => {
						try {
							// Quill    Quill API  
							if (window.Quill && typeof Quill.find === 'function') {
								const q = Quill.find(ed);
								if (q) {
									q.clipboard.dangerouslyPasteHTML(value);
									return true;
								}
							}
						} catch (_) { }
						// DOM  fallback
						try {
							const ql = ed.querySelector('.ql-editor');
							if (ql) {
								ql.innerHTML = value;
								ql.classList.toggle('ql-blank', value.trim() === '');
								return true;
							}
						} catch (_) { }
						try { ed.innerHTML = value; } catch (_) { }
						return false;
					};
					applyOnce();
					// Quill    
					setTimeout(applyOnce, 80);
					setTimeout(applyOnce, 250);
					setTimeout(applyOnce, 700);
				};
				const ensureSelectValue = (sel, value) => {
					if (!sel) return;
					const v = String(value ?? '').trim();
					if (!v) return;
					const opt = Array.from(sel.options || []).find(o => String(o.value || o.textContent || '').trim() === v);
					if (opt) sel.value = opt.value;
					else {
						//   (  )
						const o = document.createElement('option');
						o.value = v;
						o.textContent = v;
						sel.appendChild(o);
						sel.value = v;
					}
					try { sel.dispatchEvent(new Event('change', { bubbles: true })); } catch (_) {}
				};
				const isValidImageFilename = (fn) => /\.(jpe?g|png|gif|webp)$/i.test(String(fn || '').trim());

				const setSlotUiFilled = (slotEl, filled) => {
					if (!slotEl) return;
					const uploadBtn = slotEl.querySelector('.btn-upload');
					if (uploadBtn) uploadBtn.style.display = filled ? 'none' : '';
					slotEl.classList.toggle('is-filled', !!filled);
				};

				const ensureSlotDeleteButton = (slotEl, inputEl) => {
					if (!slotEl) return null;
					let btn = slotEl.querySelector('button.jw-button.btn-close[data-slot-delete="1"]');
					if (!btn) {
						btn = document.createElement('button');
						btn.type = 'button';
						btn.className = 'jw-button btn-close';
						btn.setAttribute('aria-label', 'remove');
						btn.dataset.slotDelete = '1';
						btn.innerHTML = `<div class="ic-close" style="width:15px; height:15px; --line:1px; --color:#969696"></div>`;
						btn.addEventListener('click', (e) => {
							e.preventDefault();
							e.stopPropagation();
							// slot ( / )
							try { if (inputEl) { inputEl.value = ''; delete inputEl.dataset.existing; } } catch (_) {}
							// Clear block.dataset.existingImage for dfghs blocks
							try {
								const block = slotEl.closest('.dfghs');
								if (block) delete block.dataset.existingImage;
							} catch (_) {}
							slotEl.querySelectorAll('img.preview').forEach(n => n.remove());
							setSlotUiFilled(slotEl, false);
						});
						slotEl.appendChild(btn);
					}
					return btn;
				};

				//  id/   (   X)
				const setPreviewInSlot = (inputEl, filename) => {
					if (!inputEl || !filename || !isValidImageFilename(filename)) return;
					const wrap = inputEl.closest('.upload-item') || inputEl.closest('.upload-grid') || null;
					if (!wrap) return;
					//
					wrap.querySelectorAll('img.preview').forEach(n => n.remove());
					setSlotUiFilled(wrap, true);
					const img = document.createElement('img');
					img.className = 'preview';
					img.alt = '';
					// sight_ 로 시작하는 파일은 uploads/sights/ 경로 사용
					const folder = String(filename).startsWith('sight_') ? 'sights' : 'products';
					img.src = `../../uploads/${folder}/${encodeURIComponent(String(filename))}`;
					wrap.prepend(img);
					inputEl.dataset.existing = String(filename);
					ensureSlotDeleteButton(wrap, inputEl);
				};

				//   
				__ensureProductIds();
				// /      "data-lan-eng "     
				const applyCore = () => {
					const nameEl =
						document.getElementById('productName') ||
						__ensureIdFromLanEng('Product Name', 'productName') ||
						__ensureId('', 'productName');
					if (nameEl) {
						nameEl.value = pkg.packageName || '';
						try { nameEl.setAttribute('value', nameEl.value); } catch (_) {}
					}
					const descEl =
						document.getElementById('productDescriptionEditor') ||
						__ensureIdFromLanEng('Product Description', 'productDescriptionEditor', '.jweditor') ||
						__ensureId(' ', 'productDescriptionEditor', '.jweditor');
					if (descEl) setEditorHtml(descEl, pkg.packageDescription || '');
				};
				applyCore();
				// multi-editor(Quill) /          
				setTimeout(applyCore, 300);
				setTimeout(applyCore, 1200);

				// /(   )
				{
					const codeItem = findGridItemByLan('Product code');
					const input = codeItem?.querySelector('input.form-control');
					if (input) {
						const fallback = `KOR${String(pkg.packageId ?? productId ?? '').padStart(5, '0')}`;
						const code =
							pkg.productCode ||
							pkg.packageCode ||
							pkg.product_code ||
							pkg.package_code ||
							pkg.code ||
							pkg.sku ||
							fallback;
						input.value = String(code || '');
						input.placeholder = '';
					}
				}
				{
					const regItem = findGridItemByLan('Registration date/time');
					const input = regItem?.querySelector('input.form-control');
					if (input) {
						const raw =
							pkg.createdAt ||
							pkg.created_at ||
							pkg.created ||
							pkg.registeredAt ||
							pkg.registered_at ||
							'';
						let v = String(raw || '').trim();
						try {
							if (v && window.moment && typeof window.moment === 'function') {
								const m = window.moment(v);
								if (m.isValid()) v = m.format('YYYY-MM-DD HH:mm');
							}
						} catch (_) {}
						if (v) input.value = v;
					}
				}
				//  /(  id    lan-eng )
				{
					const targetItem = findGridItemByLan('Sales Target');
					const sel = targetItem?.querySelector('select') || document.getElementById('salesTarget');
					if (sel) ensureSelectValue(sel, String(pkg.sales_target || 'B2B'));
				}
				{
					const mainSel = document.querySelector('select[data-category="1"]');
					//  code(season/region/...)  code  
					const mainCode = String(pkg.packageCategory || pkg.main_category || '').trim();
					const fallbackLabel = mapMainToUi[mainCode] || mainCode;
					// main select option.value code   code ,  label fallback
					ensureSelectValue(mainSel, mainCode || fallbackLabel);
					try { template_detail_sdaf_cate(); } catch (_) {}
				}
				{
					const subSel = document.querySelector('select[data-category="2"]');
					if (subSel) subSel.disabled = false;
					ensureSelectValue(subSel, String(pkg.subCategory || '').trim());
				}
				{
					const desc = document.getElementById('productDescriptionEditor') || __ensureIdFromLanEng('Product Description', 'productDescriptionEditor', '.jweditor');
					if (desc) setEditorHtml(desc, pkg.packageDescription || '');
				}

				//  //
					// - datepicker/other scripts may overwrite values; apply twice (like product name/desc)
					const applySalesBasic = () => {
				const contract = document.getElementById('contract-period');
				if (contract) {
					const s = String(pkg.sales_start_date || '').trim();
					const e = String(pkg.sales_end_date || '').trim();
					if (s && e) contract.value = `${s} ~ ${e}`;
					else if (pkg.sales_period) contract.value = String(pkg.sales_period);
				}
					const salesPanel = findCardByH3Lan('Basic Sales Information');
					const setByLabel = (labelEng, v) => {
						const span = salesPanel?.querySelector(`.label-name [data-lan-eng="${CSS.escape(labelEng)}"]`);
						const grid = span ? span.closest('.grid-item') : null;
						const input = grid?.querySelector('input.form-control');
						if (!input) return;
						const raw = String(v ?? '').trim();
						// SMT: remove trailing .00 for display consistency
						if (/^-?\d+(\.\d+)?$/.test(raw.replace(/,/g, ''))) {
							const n = raw.replace(/,/g, '');
							input.value = String(n).includes('.') ? String(n).split('.')[0] : n;
						} else {
							input.value = raw;
						}
					};
						// schema fallback
						const minV = (pkg.minParticipants ?? pkg.min_participants ?? pkg.min_participant ?? '');
						const maxV = (pkg.maxParticipants ?? pkg.max_participants ?? pkg.max_participant ?? '');
						// B2C 가격 (packagePrice 또는 base_price)
						const b2cV = (pkg.packagePrice ?? pkg.package_price ?? pkg.base_price ?? pkg.basePrice ?? '');
						// B2B 가격
						const b2bV = (pkg.b2b_price ?? pkg.b2bPrice ?? '');
						// 가격 텍스트 (문자열로 표시할 가격)
						const priceTextV = (pkg.price_display_text ?? pkg.priceDisplayText ?? '');
						const b2bPriceTextV = (pkg.b2b_price_display_text ?? pkg.b2bPriceDisplayText ?? '');
						setByLabel('Minimum departure headcount', minV);
						setByLabel('Maximum capacity', maxV);
						setByLabel('B2C Price (₱)', b2cV);
						setByLabel('B2C Price Text', priceTextV);
						setByLabel('B2B Price (₱)', b2bV);
						setByLabel('B2B Price Text', b2bPriceTextV);
					};
					applySalesBasic();
					setTimeout(applySalesBasic, 350);
					setTimeout(applySalesBasic, 1200);

				//  
				{
					const feePanel =
						document.querySelector('.card-panel .grid-wrap-title[data-lan-eng="Room rate for single occupancy"]')?.closest('.card-panel') ||
						null;
					const input = feePanel?.querySelector('input.form-control');
					if (input && pkg.single_room_fee != null) input.value = String(pkg.single_room_fee).split('.')[0];
				}

				//  (//) -  id 
				setPreviewInSlot(document.getElementById('thumbnailImageInput'), pkg.thumbnail_image);
				setPreviewInSlot(document.getElementById('detailImageInput'), pkg.detail_image);
				try {
					// product_images  JSON ,       
					let imgs = [];
					if (typeof pkg.product_images === 'string') {
						const s = String(pkg.product_images || '').trim();
						if (s.startsWith('[')) imgs = JSON.parse(s || '[]');
						else if (s) imgs = [s];
					} else if (Array.isArray(pkg.product_images)) {
						imgs = pkg.product_images;
					}
					if (Array.isArray(imgs)) {
						// slot  ,   /  
						const inputs = [
							document.getElementById('productImageInput0'),
							document.getElementById('productImageInput1'),
							document.getElementById('productImageInput2'),
							document.getElementById('productImageInput3'),
							document.getElementById('productImageInput4'),
						].filter(Boolean);
						//  ( preview/dataset.existing )
						inputs.forEach((inp) => {
							const slot = inp.closest('.upload-item') || null;
							try { delete inp.dataset.existing; } catch (_) {}
							slot?.querySelectorAll('img.preview')?.forEach(n => n.remove());
							if (slot) setSlotUiFilled(slot, false);
						});
						imgs.slice(0, inputs.length).forEach((fn, i) => setPreviewInSlot(inputs[i], fn));
					}
				} catch (_) { }

				// (/)
				const byType = {};
				flights.forEach(f => { byType[f.flight_type] = f; });
					const fillFlight = (kind, obj) => {
					const panels = Array.from(document.querySelectorAll('[data-section-name="flight-information"].card-panel'));
						const panel = panels.find(p => {
							const h3 = p.querySelector('h3.grid-wrap-title') || p.querySelector('h3');
							const eng = String(h3?.getAttribute?.('data-lan-eng') || '').trim();
							const txt = String(h3?.textContent || '').trim();
							if (kind === 'departure') return eng === 'Departure flight' || /departure/i.test(txt);
							return eng === 'Return trip' || /return/i.test(txt);
						});
					if (!panel || !obj) return;
					const textInputs = Array.from(panel.querySelectorAll('input.form-control'));
					//  select( toolbar select  )
					const selects = Array.from(panel.querySelectorAll('.meeting-wrap select'));
					// Airline은 별도 select (.airline-select)
					const airlineSelect = panel.querySelector('.airline-select');
					if (textInputs[0]) textInputs[0].value = obj.flight_number || '';
					if (airlineSelect) airlineSelect.value = obj.airline_name || '';
					if (selects[0] && obj.departure_time) selects[0].value = String(obj.departure_time).slice(0, 2);
					if (selects[1] && obj.departure_time) selects[1].value = String(obj.departure_time).slice(3, 5);
					if (selects[2] && obj.arrival_time) selects[2].value = String(obj.arrival_time).slice(0, 2);
					if (selects[3] && obj.arrival_time) selects[3].value = String(obj.arrival_time).slice(3, 5);
					if (textInputs[1]) textInputs[1].value = obj.departure_point || '';
					if (textInputs[2]) textInputs[2].value = obj.destination || '';
					// jw_select 커스텀 UI 업데이트 함수
					const updateJwSelect = (nativeSel) => {
						if (!nativeSel) return;
						const wrap = nativeSel.closest('.jw-select');
						if (!wrap) return;
						const box = wrap.querySelector('.jw-selected');
						const list = wrap.querySelector('.jw-select-list');
						if (box) {
							const opt = nativeSel.selectedOptions[0] || nativeSel.options[0];
							box.textContent = opt ? opt.textContent : '';
						}
						if (list) {
							list.querySelectorAll('.jw-select-item').forEach(li => {
								li.removeAttribute('aria-selected');
								if (li.dataset.value === nativeSel.value) li.setAttribute('aria-selected', 'true');
							});
						}
					};
					// jw_select( ) UI  change /refresh
					try { selects.forEach(s => { s.dispatchEvent(new Event('change', { bubbles: true })); updateJwSelect(s); }); } catch (_) {}
					try { if (airlineSelect) { airlineSelect.dispatchEvent(new Event('change', { bubbles: true })); updateJwSelect(airlineSelect); } } catch (_) {}
					try { if (typeof jw_select === 'function') jw_select(); } catch (_) {}
				};
					fillFlight('departure', byType.departure);
					fillFlight('return', byType.return);

				//  (packages.meeting_time/location/address)
				(function fillMeeting() {
					const panel = findCardByH3Lan('Meeting Information');
					if (!panel) return;
					const selects = Array.from(panel.querySelectorAll('.meeting-wrap select, select'));
					const inputs = Array.from(panel.querySelectorAll('input.form-control'));
					const t = String(pkg.meeting_time || '').trim(); // HH:MM:SS
					if (t && t.includes(':')) {
						const hh = t.slice(0, 2);
						const mm = t.slice(3, 5);
						if (selects[0]) selects[0].value = hh;
						if (selects[1]) selects[1].value = mm;
						try { selects.forEach(s => s.dispatchEvent(new Event('change', { bubbles: true }))); } catch (_) {}
					}
					if (inputs[0]) inputs[0].value = String(pkg.meeting_location || '');
					if (inputs[1]) inputs[1].value = String(pkg.meeting_address || '');
				})();

				//   : (contract-period) package_availability 
				// - ( //) 
				// -  (4)     +      
				(function renderDailySalesAdjustment() {
					const panel = document.querySelector('.iljastar');
					if (!panel) return;

					const contractEl = document.getElementById('contract-period');
					const rawPeriod = String(contractEl?.value || pkg.sales_period || '').trim();

					// YYYY-MM-DD ~ YYYY-MM-DD
					const parseRange = (s) => {
						const m = String(s || '').match(/(\d{4}-\d{2}-\d{2})/g) || [];
						if (m.length >= 2) return { start: m[0], end: m[1] };
						if (m.length === 1) return { start: m[0], end: m[0] };
						return { start: '', end: '' };
					};

					const toDate = (ymd) => {
						try {
							if (window.moment) {
								const mm = window.moment(ymd, 'YYYY-MM-DD', true);
								if (mm.isValid()) return mm.toDate();
							}
						} catch (_) {}
						const d = new Date(String(ymd || '') + 'T00:00:00');
						return isNaN(d.getTime()) ? null : d;
					};

					const fmt = (d) => {
						const y = d.getFullYear();
						const m = String(d.getMonth() + 1).padStart(2, '0');
						const dd = String(d.getDate()).padStart(2, '0');
						return `${y}-${m}-${dd}`;
					};

					// 1) 입력 필드(daterangepicker)에서 범위 파싱 시도
					// 2) 없으면 sales_start_date/sales_end_date 컬럼 사용
					// 3) 그래도 없으면 sales_period 파싱
					const parsed = parseRange(rawPeriod);
					let start = '';
					let end = '';
					// rawPeriod에 두 날짜가 있으면 (입력 필드에서 범위 설정됨) 그것을 사용
					if (parsed.start && parsed.end && parsed.start !== parsed.end) {
						start = parsed.start;
						end = parsed.end;
					} else {
						// DB의 sales_start_date/sales_end_date 사용
						start = pkg.sales_start_date || parsed.start || '';
						end = pkg.sales_end_date || parsed.end || '';
					}
					const startD = toDate(start);
					const endD = toDate(end);

					//   availability  
					const availabilityArr = Array.isArray(availability) ? availability : [];
					const availDates = availabilityArr
						.map(a => String(a?.availableDate || '').slice(0, 10))
						.filter(Boolean)
						.sort();

					let rangeStart = startD;
					let rangeEnd = endD;
					if (!rangeStart || !rangeEnd) {
						if (availDates.length) {
							rangeStart = toDate(availDates[0]);
							rangeEnd = toDate(availDates[availDates.length - 1]);
						}
					}
					if (!rangeStart || !rangeEnd) return;

					// ()  = availability   
					const activeDates = new Set(availDates);
					panel.__activeDates = activeDates;

					// availability map
					const map = {};
					availabilityArr.forEach(a => {
						const k = String(a?.availableDate || '').slice(0, 10);
						if (!k) return;
						map[k] = a;
					});

					// 삭제된 날짜 추적 (저장 시 백엔드에 전송)
					panel.__deletedDates = panel.__deletedDates || new Set();

					// 1) 테이블 렌더: "활성 날짜" 목록
					const table = panel.querySelector('table.jw-tableA.booking-detail');
					const tbody = table?.querySelector('tbody');

					// 기본 B2C/B2B 가격 가져오기
					const getDefaultPrices = () => {
						const b2cEl = document.getElementById('b2cPrice');
						const b2bEl = document.getElementById('b2bPrice');
						return {
							b2c: String(b2cEl?.value || '0').replace(/[^0-9]/g, '') || '0',
							b2b: String(b2bEl?.value || '0').replace(/[^0-9]/g, '') || '0'
						};
					};

					const renderTable = () => {
						if (!tbody) return;
						// 현재 테이블에서 map으로 값 읽어오기 (수정된 내용 보존)
						try {
							Array.from(tbody.querySelectorAll('tr[data-date]')).forEach((tr) => {
								const date = String(tr.dataset.date || '').trim();
								if (!date) return;
								const inputs = Array.from(tr.querySelectorAll('input.form-control'));
								const seats = String(inputs[0]?.value || '').trim();
								const price = String(inputs[1]?.value || '').trim();
								const b2bPrice = String(inputs[2]?.value || '').trim();
								map[date] = map[date] || {};
								map[date].availableDate = date;
								map[date].availableSeats = seats;
								map[date].price = price;
								map[date].b2bPrice = b2bPrice;
							});
						} catch (_) {}

						const list = Array.from(activeDates).sort();
						tbody.innerHTML = '';
						const defaults = getDefaultPrices();
						list.forEach((date, idx) => {
							const a = map[date] || {};
							const booked = (a.bookedSeats != null) ? String(a.bookedSeats) : '';
							const seats = (a.availableSeats != null) ? String(a.availableSeats) : '';
							// B2C 가격 (소수점 제거) - 0이거나 없으면 기본값 사용
							let price = (a.price != null) ? String(a.price) : '';
							let priceInt = String(price).split('.')[0].replace(/[^0-9]/g, '');
							if (!priceInt || priceInt === '0') priceInt = defaults.b2c;
							// B2B 가격 (소수점 제거) - 0이거나 없으면 기본값 사용
							let b2bPrice = (a.b2bPrice != null || a.b2b_price != null) ? String(a.b2bPrice ?? a.b2b_price ?? '') : '';
							let b2bPriceInt = String(b2bPrice).split('.')[0].replace(/[^0-9]/g, '');
							if (!b2bPriceInt || b2bPriceInt === '0') b2bPriceInt = defaults.b2b;
							const tr = document.createElement('tr');
							tr.dataset.date = date;
							tr.dataset.active = '1';
							tr.innerHTML = `
								<td class="no is-center">${idx + 1}</td>
								<td class="is-center">${date}</td>
								<td class="is-center">${booked}</td>
								<td class="is-center"><div class="cell"><input type="text" class="form-control" value="${seats.replace(/"/g, '&quot;')}" min="0" inputmode="numeric"></div></td>
								<td class="is-center"><div class="cell"><input type="text" class="form-control" value="${String(priceInt || '').replace(/"/g, '&quot;')}" inputmode="numeric"></div></td>
								<td class="is-center"><div class="cell"><input type="text" class="form-control" value="${String(b2bPriceInt || '').replace(/"/g, '&quot;')}" inputmode="numeric"></div></td>
								<td class="is-center"><button type="button" class="jw-button typeB btn-delete-date" data-date="${date}" style="padding:4px 8px;font-size:12px;color:#e74c3c;">X</button></td>
							`;
							tbody.appendChild(tr);
						});

						// 삭제 버튼 이벤트 바인딩
						tbody.querySelectorAll('.btn-delete-date').forEach(btn => {
							btn.onclick = function() {
								const dateToDelete = this.dataset.date;
								if (!dateToDelete) return;
								if (!confirm(`Delete date ${dateToDelete}?`)) return;
								activeDates.delete(dateToDelete);
								panel.__deletedDates.add(dateToDelete);
								// 캘린더에서도 선택 해제
								const calRow = panel.querySelector('.calendar-row');
								if (calRow) {
									const dayEl = calRow.querySelector(`.cal-day time[datetime="${dateToDelete}"]`)?.parentElement;
									if (dayEl) dayEl.classList.remove('is-selected');
								}
								renderTable();
							};
						});
					};
					renderTable();

					// 2) 캘린더 (4개월 표시 + 네비게이션)
					const calRow = panel.querySelector('.calendar-row');
					if (!calRow) return;

					const monthLabel = (d) => {
						try {
							if (window.moment) return window.moment(d).format('MMM YYYY');
						} catch (_) {}
						return d.toLocaleDateString('en-US', { year: 'numeric', month: 'short' });
					};

					// 판매 시작월부터 시작
					const baseMonth = new Date(rangeStart.getFullYear(), rangeStart.getMonth(), 1);
					// 판매 종료월까지의 총 월수 계산
					const endMonth = new Date(rangeEnd.getFullYear(), rangeEnd.getMonth(), 1);
					const totalMonths = (endMonth.getFullYear() - baseMonth.getFullYear()) * 12 + (endMonth.getMonth() - baseMonth.getMonth()) + 1;

					// 현재 오프셋 (0부터 시작)
					let monthOffset = panel.__monthOffset || 0;
					const monthsPerPage = 4;

					const isInRange = (ymd) => (ymd >= fmt(rangeStart) && ymd <= fmt(rangeEnd));

					const renderMonth = (m0) => {
						const y = m0.getFullYear();
						const m = m0.getMonth();
						const first = new Date(y, m, 1);
						const last = new Date(y, m + 1, 0);
						const daysInMonth = last.getDate();
						const startDow = first.getDay(); // 0=Sun

						const cells = [];
						// leading blanks
						for (let i = 0; i < startDow; i++) {
							cells.push('<div class="cal-day is-muted"><time datetime=""></time></div>');
						}
						for (let d = 1; d <= daysInMonth; d++) {
							const dt = new Date(y, m, d);
							const ymd = fmt(dt);
							const cls = ['cal-day'];
							if (dt.getDay() === 0) cls.push('is-sun');
							if (dt.getDay() === 6) cls.push('is-sat');
							if (isInRange(ymd)) cls.push('is-in-range');
							else cls.push('is-muted');
							if (activeDates.has(ymd)) cls.push('is-active');
							const today = new Date();
							const todayYmd = fmt(new Date(today.getFullYear(), today.getMonth(), today.getDate()));
							if (ymd === todayYmd) cls.push('is-today');
							if (activeDates.has(ymd)) cls.push('is-selected');
							cells.push(`<div class="${cls.join(' ')}" data-date="${ymd}"><time datetime="${ymd}">${d}</time></div>`);
						}
						return `
							<div>
								<div class="cal-month">
									<div class="cal-header">${monthLabel(m0)}</div>
									<div class="cal-head"><div>S</div><div>M</div><div>T</div><div>W</div><div>T</div><div>F</div><div>S</div></div>
									<div class="cal-body">${cells.join('')}</div>
								</div>
							</div>
						`;
					};

					const renderCalendar = () => {
						const months = [];
						for (let i = 0; i < monthsPerPage; i++) {
							const idx = monthOffset + i;
							if (idx >= totalMonths) break;
							months.push(new Date(baseMonth.getFullYear(), baseMonth.getMonth() + idx, 1));
						}

						const canGoPrev = monthOffset > 0;
						const canGoNext = monthOffset + monthsPerPage < totalMonths;

						calRow.innerHTML = `
							<div class="cal-nav" style="display:flex; align-items:center; gap:8px; margin-bottom:12px;">
								<button type="button" class="cal-nav-btn cal-prev" style="padding:4px 12px; border:1px solid #ddd; border-radius:4px; background:#fff; cursor:pointer; ${canGoPrev ? '' : 'opacity:0.3; pointer-events:none;'}">&lt; Prev</button>
								<span style="font-size:13px; color:#666;">Page ${Math.floor(monthOffset / monthsPerPage) + 1} / ${Math.ceil(totalMonths / monthsPerPage)}</span>
								<button type="button" class="cal-nav-btn cal-next" style="padding:4px 12px; border:1px solid #ddd; border-radius:4px; background:#fff; cursor:pointer; ${canGoNext ? '' : 'opacity:0.3; pointer-events:none;'}">Next &gt;</button>
							</div>
							<div class="cal-months" style="display:flex; gap:12px; flex-wrap:wrap;">
								${months.map(renderMonth).join('')}
							</div>
						`;

						// 네비게이션 버튼 이벤트
						calRow.querySelector('.cal-prev')?.addEventListener('click', () => {
							if (monthOffset > 0) {
								monthOffset -= monthsPerPage;
								if (monthOffset < 0) monthOffset = 0;
								panel.__monthOffset = monthOffset;
								renderCalendar();
								applyActiveClasses();
							}
						});
						calRow.querySelector('.cal-next')?.addEventListener('click', () => {
							if (monthOffset + monthsPerPage < totalMonths) {
								monthOffset += monthsPerPage;
								panel.__monthOffset = monthOffset;
								renderCalendar();
								applyActiveClasses();
							}
						});
					};

					renderCalendar();

					const scrollToRow = (ymd) => {
						const row = panel.querySelector(`tbody tr[data-date="${CSS.escape(ymd)}"]`);
						const wrap = panel.querySelector('.tableA-scrollY');
						if (row && wrap) {
							const top = row.offsetTop - 8;
							wrap.scrollTo({ top, behavior: 'smooth' });
							row.classList.add('is-selected-row');
							setTimeout(() => row.classList.remove('is-selected-row'), 600);
							//  input 
							row.querySelector('input.form-control')?.focus?.();
						}
					};

					const applyActiveClasses = () => {
						try {
							calRow.querySelectorAll('.cal-day[data-date]').forEach((el) => {
								const d = String(el.getAttribute('data-date') || '').trim();
								if (!d) return;
								el.classList.toggle('is-active', activeDates.has(d));
								el.classList.toggle('is-selected', activeDates.has(d));
							});
						} catch (_) {}
					};

					calRow.addEventListener('click', (e) => {
						const cell = e.target?.closest?.('.cal-day[data-date]');
						const ymd = cell?.getAttribute?.('data-date') || '';
						if (!ymd || !isInRange(ymd)) return;
						//  :  (  ) +   
						if (activeDates.has(ymd)) activeDates.delete(ymd);
						else activeDates.add(ymd);
						// table  + active class 
						renderTable();
						applyActiveClasses();
						scrollToRow(ymd);
					});

					//   
					setTimeout(() => applyActiveClasses(), 0);

					//    ( daterangepicker apply  change        )
					try {
						if (window.jQuery) {
							window.jQuery(contractEl).off('.dailySales').on('apply.daterangepicker.dailySales cancel.daterangepicker.dailySales', () => {
								setTimeout(renderDailySalesAdjustment, 0);
							});
						}
					} catch (_) {}
					contractEl?.addEventListener?.('change', () => setTimeout(renderDailySalesAdjustment, 0), { once: true });
				})();

				//
				(function () {
					const feePanel =
						document.querySelector('.card-panel .grid-wrap-title[data-lan-eng="Number of people fee"]')?.closest('.card-panel') ||
						null;
					if (!feePanel) return;
					const tbody = feePanel.querySelector('tbody');
					if (!tbody) return;
					tbody.innerHTML = '';
					pricingOptions.forEach((opt, i) => {
						const tr = document.createElement('tr');
						tr.innerHTML = `
							<td class="is-center">${i + 1}</td>
							<td class="is-center"><div class="cell"><input type="text" class="form-control" value="${String(opt.option_name || '').replace(/"/g, '&quot;')}" placeholder=""></div></td>
							<td class="is-center"><div class="cell"><input type="text" class="form-control" value="${String(opt.price ?? '').split('.')[0]}" inputmode="numeric" placeholder="0"></div></td>
							<td class="is-center"><div class="cell"><input type="text" class="form-control" value="${String(opt.b2b_price ?? '').split('.')[0]}" inputmode="numeric" placeholder="0"></div></td>
							<td class="is-center jw-center">
								<button type="button" class="jw-button" onclick="template_detail_sfg1d(this)" aria-label="row delete"><img src="../image/trash.svg" alt=""></button>
							</td>
						`;
						tbody.appendChild(tr);
					});
					if (pricingOptions.length === 0) {
						const tr = document.createElement('tr');
						tr.innerHTML = `
							<td class="is-center">1</td>
							<td class="is-center"><div class="cell"><input type="text" class="form-control" value="" placeholder=""></div></td>
							<td class="is-center"><div class="cell"><input type="text" class="form-control" value="" inputmode="numeric" placeholder="0"></div></td>
							<td class="is-center"><div class="cell"><input type="text" class="form-control" value="" inputmode="numeric" placeholder="0"></div></td>
							<td class="is-center jw-center">
								<button type="button" class="jw-button" onclick="template_detail_sfg1d(this)" aria-label="row delete"><img src="../image/trash.svg" alt=""></button>
							</td>
						`;
						tbody.appendChild(tr);
					}
				})();

				// /
				const fillLinesToTable = (panelLanEng, panelTitleKo, text) => {
					const panel =
						document.querySelector(`.card-panel .grid-wrap-title[data-lan-eng="${CSS.escape(panelLanEng)}"]`)?.closest('.card-panel') ||
						null;
					if (!panel) return;
					const tbody = panel.querySelector('tbody');
					if (!tbody) return;
					const lines = String(text || '').split('\n').map(s => s.trim()).filter(Boolean);
					tbody.innerHTML = '';
					const mk = (val, i) => {
						const tr = document.createElement('tr');
						tr.innerHTML = `
							<td class="is-center">${i + 1}</td>
							<td class="is-center"><div class="cell"><input type="text" class="form-control" value="${val.replace(/"/g, '&quot;')}" placeholder="Please enter your content"></div></td>
							<td class="is-center jw-center">
								<button type="button" class="jw-button" aria-label="row delete" onclick="trash_typeA(this);"><img src="../image/trash.svg" alt=""></button>
							</td>
						`;
						tbody.appendChild(tr);
					};
					if (lines.length === 0) mk('', 0);
					else lines.forEach((v, i) => mk(v, i));
				};
				fillLinesToTable('Included items', ' ', pkg.included_items);
				fillLinesToTable('Excluded items', ' ', pkg.excluded_items);

				// /() - day  /
				const wantDays = schedules.length || 1;
				const base = document.getElementById('nday');
				if (base) { base.dataset.day = base.dataset.day || '1'; base.classList.add('nday-panel'); }
				const addDayBtn = document.querySelector('.aside-button-typeA');
				const getDayPanels = () => Array.from(document.querySelectorAll('.nday-panel'));
				// IMPORTANT:    HTML/  Day   
				// schedules   ""   " Day (aside + )" .
				(function pruneExtraDays() {
					//    
					const panels = getDayPanels();
					panels.forEach((p, idx) => {
						if (idx + 1 > wantDays) p.remove();
					});
					// aside   
					const list = document.querySelector('.aside-row-list');
					if (list) {
						const rows = Array.from(list.querySelectorAll('.aside-row'));
						rows.forEach((r, idx) => {
							if (idx + 1 > wantDays) r.remove();
						});
					}
					// (aside subtitle +  data-day)
					try {
						const lang = (typeof getCookie === 'function' ? (getCookie('lang') || 'eng') : 'eng');
						const isKo = /^(ko|kor)$/i.test(String(lang));
						const list2 = document.querySelector('.aside-row-list');
						if (list2) {
							Array.from(list2.querySelectorAll('.aside-row')).forEach((el, i) => {
								const n = i + 1;
								const sub = el.querySelector('.aside-row__subtitle');
								if (!sub) return;
								sub.setAttribute('data-lan-eng', `Day ${n}`);
								sub.setAttribute('data-scroll-target', `day-${n}`);
								sub.setAttribute('onclick', `scrollToDayPanel(${n})`);
								sub.style.cursor = 'pointer';
								sub.textContent = isKo ? `${n}` : `Day ${n}`;
								// Day1
								if (n === 1) el.querySelector('button.aside-add-section')?.remove();
							});
						}
						getDayPanels().forEach((p, i) => { p.dataset.day = String(i + 1); });
						try { if (typeof language_apply === 'function') language_apply(lang); } catch (_) {}
					} catch (_) {}
				})();
				while (getDayPanels().length < wantDays && addDayBtn) {
					try { template_detail_sdaf(addDayBtn); } catch (_) { break; }
				}
				const dayPanelsNow = getDayPanels();
				schedules.forEach((sc, idx) => {
					const dayPanel = dayPanelsNow[idx];
					if (!dayPanel) return;
					//  : placeholder   label(data-lan-eng="Schedule Summary")   ( placeholder  )
					{
						const sumItem =
							dayPanel.querySelector('.label-name[data-lan-eng="Schedule Summary"]')?.closest('.grid-item') ||
							dayPanel.querySelector('.label-name [data-lan-eng="Schedule Summary"]')?.closest('.grid-item') ||
							Array.from(dayPanel.querySelectorAll('.grid-item')).find(el => (el.querySelector('.label-name')?.textContent || '').includes(' '));
						const sumInput = sumItem?.querySelector('input.form-control');
					if (sumInput) sumInput.value = sc.description || '';
					}

					const attList = Array.isArray(sc.attractions) ? sc.attractions : [];
					const blocks = Array.from(dayPanel.querySelectorAll('.dfghs'));
					const addBtn = dayPanel.querySelector('button[onclick*="template_detail_dfghs"]');
					while (blocks.length < attList.length && addBtn) {
						try { template_detail_dfghs(addBtn); } catch (_) { break; }
						blocks.push(...Array.from(dayPanel.querySelectorAll('.dfghs')).slice(blocks.length));
					}
					const finalBlocks = Array.from(dayPanel.querySelectorAll('.dfghs'));
					attList.forEach((a, i) => {
						const block = finalBlocks[i];
						if (!block) return;
						block.dataset.existingImage = a.attraction_image || '';
						//  select( toolbar select  )
						const selects = Array.from(block.querySelectorAll('.meeting-wrap select'));
						if (a.start_time) { if (selects[0]) selects[0].value = String(a.start_time).slice(0, 2); if (selects[1]) selects[1].value = String(a.start_time).slice(3, 5); }
						if (a.end_time) { if (selects[2]) selects[2].value = String(a.end_time).slice(0, 2); if (selects[3]) selects[3].value = String(a.end_time).slice(3, 5); }
						try { selects.forEach(s => s.dispatchEvent(new Event('change', { bubbles: true }))); } catch (_) {}
						const inputs = Array.from(block.querySelectorAll('input.form-control'));
						if (inputs[0]) inputs[0].value = a.attraction_name || '';
						if (inputs[1]) inputs[1].value = a.attraction_address || '';
						const ed = block.querySelector('.jweditor');
						if (ed) setEditorHtml(ed, a.attraction_description || '');
						//  : upload (input)  existing  +  
						{
							const fileInput = block.querySelector('.upload-grid input[type="file"]');
							if (fileInput) {
								// reset
								const slot = fileInput.closest('.upload-item') || null;
								try { fileInput.value = ''; delete fileInput.dataset.existing; } catch (_) {}
								slot?.querySelectorAll('img.preview')?.forEach(n => n.remove());
								if (slot) setSlotUiFilled(slot, false);
								if (a.attraction_image) setPreviewInSlot(fileInput, a.attraction_image);
							}
						}
					});

					const accomPanel = Array.from(dayPanel.querySelectorAll('.sub-panel')).find(sp => sp.querySelector('[data-lan-eng="Accommodation Information"]'));
					if (accomPanel) {
						const inputs = Array.from(accomPanel.querySelectorAll('input.form-control'));
						if (inputs[0]) inputs[0].value = sc.accommodation_name || '';
						if (inputs[1]) inputs[1].value = sc.accommodation_address || '';
						const ed = accomPanel.querySelector('.jweditor');
						if (ed) setEditorHtml(ed, sc.accommodation_description || '');
						//  : upload (input)  existing  +  
						{
							const fileInput = accomPanel.querySelector('.upload-grid input[type="file"]');
							if (fileInput) {
								const slot = fileInput.closest('.upload-item') || null;
								try { fileInput.value = ''; delete fileInput.dataset.existing; } catch (_) {}
								slot?.querySelectorAll('img.preview')?.forEach(n => n.remove());
								if (slot) setSlotUiFilled(slot, false);
								if (sc.accommodation_image) setPreviewInSlot(fileInput, sc.accommodation_image);
								accomPanel.dataset.existingImage = sc.accommodation_image || '';
							}
						}
					}
					const transPanel = Array.from(dayPanel.querySelectorAll('.sub-panel')).find(sp => sp.querySelector('[data-lan-eng="Transportation Information"]'));
					if (transPanel) {
						const ed = transPanel.querySelector('.jweditor');
						if (ed) setEditorHtml(ed, sc.transportation_description || '');
					}
					const mealPanel = Array.from(dayPanel.querySelectorAll('.sub-panel')).find(sp => sp.querySelector('[data-lan-eng="Meal Information"]'));
					if (mealPanel) {
						const inputs = Array.from(mealPanel.querySelectorAll('input.form-control'));
						if (inputs[0]) inputs[0].value = sc.breakfast || '';
						if (inputs[1]) inputs[1].value = sc.lunch || '';
						if (inputs[2]) inputs[2].value = sc.dinner || '';
					}
				});
				//     
				try { if (typeof jw_select === 'function') jw_select(); } catch (_) {}

				// //() + refundDays
				const guideMap = {};
				guides.forEach(g => { if (g.guide_type) guideMap[g.guide_type] = g; });
				const setSectionEditor = (lanEng, koTitle, html) => {
					const h2 = findH2ByLan(lanEng);
					const panel = h2?.nextElementSibling;
					if (!panel) return;
					const eds = Array.from(panel.querySelectorAll('.jweditor'));
					const ed = eds[eds.length - 1];
					if (ed) setEditorHtml(ed, html || '');
				};
				setSectionEditor('Usage Guide', '', guideMap.usage?.guide_description || '');
				setSectionEditor('Cancellation/Refund Policy', '/', guideMap.cancellation?.guide_description || '');
				setSectionEditor('Visa Application Guide', ' ', guideMap.visa?.guide_description || '');
				if (pkg.refund_days != null) {
					const h2 = findH2ByLan('Cancellation/Refund Policy');
					const panel = h2?.nextElementSibling;
					const input = panel?.querySelector('input.form-control');
					if (input) input.value = String(pkg.refund_days);
				}

				// (Usage Guide)  /  UI (noticeUploadChange) 
				try {
					const usagePanel = findH2ByLan('Usage Guide')?.nextElementSibling;
					const file = usagePanel?.querySelector('input[type="file"]');
					const g = guideMap.usage;
					// NOTE:
					// -  packages.usage_guide_file .
					// - package_usage_guide description  guide_file   (g.guide_file=null)  pkg .
					const pkgFile = String(pkg.usage_guide_file || '').trim();
					const pkgName = String(pkg.usage_guide_name || '').trim();
					const pkgSize = (pkg.usage_guide_size != null) ? String(pkg.usage_guide_size) : '';
					const ex = String(g?.guide_file || pkgFile || '').trim();
					if (file && ex) {
						file.dataset.existing = ex;
						file.dataset.existingName = String(pkgName || file.dataset.existingName || ex);
						if (pkgSize) file.dataset.existingSize = pkgSize;
						try { noticeUploadChange(file); } catch (_) {}
					}
				} catch (_) {}

				// SMT (#165): product documents (flyer/itinerary/detail)
				try {
					const setDoc = (id, fileVal, nameVal, sizeVal) => {
						const inp = document.getElementById(id);
						if (!inp) return;
						const ex = String(fileVal || '').trim();
						if (!ex) return;
						inp.dataset.existing = ex;
						inp.dataset.existingName = String(nameVal || ex);
						if (sizeVal != null && String(sizeVal).trim() !== '') inp.dataset.existingSize = String(sizeVal);
						// update button label
						try { inp.dispatchEvent(new Event('change', { bubbles: true })); } catch (_) {}
					};
					setDoc('flyerFileInput', pkg.flyer_file, pkg.flyer_name, pkg.flyer_size);
					setDoc('itineraryFileInput', pkg.itinerary_file, pkg.itinerary_name, pkg.itinerary_size);
					setDoc('detailFileInput', pkg.detail_file, pkg.detail_name, pkg.detail_size);
				} catch (_) {}

				//   5 / select UI  (  )
				try { __resetSelectWidgets(document); } catch (_) {}
				try { if (typeof jw_select === 'function') jw_select(); } catch (_) {}

				// 공통 교통 정보 (Common Transportation) 로드
				try {
					const transDesc = String(pkg.common_transportation_description || '').trim();
					if (transDesc) {
						const transEditor = document.getElementById('commonTransEditor');
						if (transEditor) setEditorHtml(transEditor, transDesc);
					}
				} catch (_) {}

				// 공통 숙박 정보 (Common Accommodations) 로드
				const accommodations = Array.isArray(data.accommodations) ? data.accommodations : [];
				try {
					const container = document.getElementById('accommodationBlocksContainer');
					if (container && accommodations.length > 0) {
						// 기존 숙소 블록들 (첫 번째 제외) 삭제
						const existingBlocks = Array.from(container.querySelectorAll('.accommodation-block'));
						existingBlocks.slice(1).forEach(b => b.remove());

						// 첫 번째 블록에 첫 번째 숙소 데이터 설정
						const firstBlock = container.querySelector('.accommodation-block');
						if (firstBlock && accommodations[0]) {
							const ac = accommodations[0];
							const nameInput = firstBlock.querySelector('.accom-name');
							const addrInput = firstBlock.querySelector('.accom-address');
							const descEditor = firstBlock.querySelector('.accom-description');
							const imageGrid = firstBlock.querySelector('.accom-image-grid');

							if (nameInput) nameInput.value = ac.accommodation_name || '';
							if (addrInput) addrInput.value = ac.accommodation_address || '';
							if (descEditor) setEditorHtml(descEditor, ac.accommodation_description || '');

							// 이미지 설정
							if (imageGrid && ac.accommodation_image) {
								const fileInput = imageGrid.querySelector('input[type="file"]');
								if (fileInput) {
									fileInput.dataset.existing = ac.accommodation_image;
									setPreviewInSlot(fileInput, ac.accommodation_image);
								}
							}
						}

						// 추가 숙소가 있으면 블록 생성
						for (let i = 1; i < accommodations.length; i++) {
							const ac = accommodations[i];
							// addAccommodationBlock 함수 호출
							if (typeof addAccommodationBlock === 'function') {
								addAccommodationBlock();
								const blocks = container.querySelectorAll('.accommodation-block');
								const newBlock = blocks[blocks.length - 1];
								if (newBlock) {
									const nameInput = newBlock.querySelector('.accom-name');
									const addrInput = newBlock.querySelector('.accom-address');
									const descEditor = newBlock.querySelector('.accom-description');
									const imageGrid = newBlock.querySelector('.accom-image-grid');

									if (nameInput) nameInput.value = ac.accommodation_name || '';
									if (addrInput) addrInput.value = ac.accommodation_address || '';
									if (descEditor) setEditorHtml(descEditor, ac.accommodation_description || '');

									// 이미지 설정
									if (imageGrid && ac.accommodation_image) {
										const fileInput = imageGrid.querySelector('input[type="file"]');
										if (fileInput) {
											fileInput.dataset.existing = ac.accommodation_image;
											setPreviewInSlot(fileInput, ac.accommodation_image);
										}
									}
								}
							}
						}

						// 삭제 버튼 상태 업데이트
						if (typeof updateAccommodationDeleteButtons === 'function') {
							updateAccommodationDeleteButtons();
						}
					}
				} catch (e) { console.error('Common Accommodation load error:', e); }
			}

			async function handleDelete() {
				try {
					if (!productId) { alert('  .'); return; }
				const response = await fetch('../backend/api/super-api.php', {
					method: 'POST',
						headers: { 'Content-Type': 'application/json' },
						body: JSON.stringify({ action: 'deleteProduct', productId: String(productId) }),
					credentials: 'same-origin'
				});
					const result = await response.json().catch(() => ({}));
					if (!response.ok || !result?.success) throw new Error(result?.message || `  (HTTP ${response.status})`);
					alert(' .');
					window.location.href = 'product-list.html';
				} catch (e) {
					console.error(e);
					alert(e?.message || '   .');
				}
			}

			// :  (    )
			function __validateEssentialOrPopup(triggerEl) {
				try {
					if (typeof essentialCheck2 === 'function') {
						const missing = essentialCheck2(triggerEl || document.body);
						if (missing) {
							window.__lastEssentialMissingLabel = missing;
							try { modal('template-detail-modal1.html', '600px', '252px'); } catch (_) {}
							return false;
						}
					}
				} catch (_) {}
				return true;
			}

			//  onclick 
			window.product_detail_save = async (btn) => {
				try {
					// SMT: essentialCheck2() is known to produce false-positives (e.g., hidden/disabled sections).
					// Let the server-side validation decide and return an explicit error instead of blocking Save.
					await saveFromPreviewToDb({ saveMode: 'active' });
					alert('.');
					window.location.reload();
				} catch (e) {
					console.error(e);
					alert(e?.message || '   .');
				}
			};

			// :     ( )
			window.product_detail_temp_save = async (btn) => {
				try {
					await saveFromPreviewToDb({ saveMode: 'temporary' });
					alert('.');
					window.location.reload();
				} catch (e) {
					console.error(e);
					alert(e?.message || '   .');
				}
			};
			window.handleDelete = handleDelete;

			//   (product-detail_m1.html): // (   UX)
			document.addEventListener('modal:loaded', (evt) => {
				const action = evt?.detail?.action || '';
				const d = evt?.detail?.dialog;
				if (!d) return;
				if (!action.includes('product-detail_m1.html')) return;

				const input = d.querySelector('#templateSearchInput');
				const btn = d.querySelector('#templateSearchBtn');
				const listHost = d.querySelector('#templateList');
				const loadBtn = d.querySelector('#templateLoadBtn');

				let selectedId = null;

				const escapeHtml = (s) => {
					const div = document.createElement('div');
					div.textContent = String(s ?? '');
					return div.innerHTML;
				};

				const renderList = (templates) => {
					if (!listHost) return;
					const items = Array.isArray(templates) ? templates : [];
					if (!items.length) {
						listHost.innerHTML = `<div class="wrap jw-mgt8"><input type="text" class="form-control" value="No templates" disabled></div>`;
						selectedId = null;
						if (loadBtn) loadBtn.disabled = true;
						return;
					}
					listHost.innerHTML = items.map((t) => {
						const id = t.templateId ?? '';
						const name = t.templateName ?? '';
						return `
							<div class="wrap jw-mgt8 template-item" data-template-id="${escapeHtml(id)}" style="cursor:pointer;">
								<input type="text" class="form-control" value="${escapeHtml(name)}" readonly>
							</div>
						`;
					}).join('');
					listHost.querySelectorAll('.template-item').forEach((el) => {
						el.addEventListener('click', () => {
							listHost.querySelectorAll('.template-item').forEach(x => x.classList.remove('is-selected'));
							el.classList.add('is-selected');
							selectedId = el.getAttribute('data-template-id');
							if (loadBtn) loadBtn.disabled = !selectedId;
						});
					});
				};

				const fetchTemplates = async (q) => {
					try {
						if (listHost) listHost.innerHTML = `<div class="wrap jw-mgt8"><input type="text" class="form-control" value="Loading..." disabled></div>`;
						const params = new URLSearchParams({ action: 'getTemplates', page: '1', limit: '50' });
						const qq = String(q || '').trim();
						if (qq) params.append('search', qq);
						const res = await fetch(`../backend/api/super-api.php?${params.toString()}`, { credentials: 'include' });
						const json = await res.json().catch(() => ({}));
						if (!res.ok || !json.success) throw new Error(json.message || `HTTP ${res.status}`);
						renderList(json.data?.templates || []);
					} catch (e) {
						console.error('Template search failed:', e);
						if (listHost) listHost.innerHTML = `<div class="wrap jw-mgt8"><input type="text" class="form-control" value="Failed to load templates" disabled></div>`;
						selectedId = null;
						if (loadBtn) loadBtn.disabled = true;
					}
				};

				const setEditorHtml = (ed, html) => {
					if (!ed) return;
					const value = String(html || '');
					try {
						const ql = ed.querySelector('.ql-editor');
						if (ql) {
							ql.innerHTML = value;
							ql.classList.toggle('ql-blank', value.trim() === '');
							return;
						}
					} catch (_) {}
					try { ed.innerHTML = value; } catch (_) {}
				};

				const setPreviewExistingInSlot = (fileInput, srcOrName) => {
					if (!fileInput || !srcOrName) return;
					const slot = fileInput.closest('.upload-item') || null;
					if (!slot) return;
					// reset
					try { fileInput.value = ''; } catch (_) {}
					slot.querySelectorAll('img.preview').forEach(n => n.remove());
					slot.classList.remove('has-image');
					slot.classList.add('is-filled');
					const btn = slot.querySelector('.btn-upload');
					if (btn) btn.style.display = 'none';
					// src /uploads/...
					const folder = String(srcOrName).startsWith('sight_') ? 'sights' : 'products';
					const src = (/^https?:\/\//i.test(String(srcOrName)) || String(srcOrName).startsWith('/'))
						? String(srcOrName)
						: `../../uploads/${folder}/${encodeURIComponent(String(srcOrName))}`;
					const img = document.createElement('img');
					img.className = 'preview';
					img.alt = '';
					img.src = src;
					slot.prepend(img);
					fileInput.dataset.existing = String(srcOrName);
				};

				const applyTemplateToProductForm = async (templateId) => {
					const id = String(templateId || '').trim();
					if (!id) return;
					const params = new URLSearchParams({ action: 'getTemplateDetail', id });
					const res = await fetch(`../backend/api/super-api.php?${params.toString()}`, { credentials: 'include' });
					const json = await res.json().catch(() => ({}));
					if (!res.ok || !json.success) throw new Error(json.message || `HTTP ${res.status}`);

					const t = json.data?.template || {};
					const data = t.data || {};
					const product = data.product || {};

					//  
					__ensureProductIds();
					const nameEl = document.getElementById('productName');
					if (nameEl) nameEl.value = String(product.productName || t.templateName || '').trim();

					const salesSel = document.getElementById('salesTarget');
					if (salesSel) {
						salesSel.disabled = false;
						const v = String(product.targetMarket || t.targetMarket || '').trim();
						if (v) salesSel.value = v;
						try { salesSel.dispatchEvent(new Event('change', { bubbles: true })); } catch (_) {}
					}

					const mainSel = document.getElementById('mainCategory');
					const subSel = document.getElementById('subCategory');
					if (mainSel && subSel) {
						const mainCode = String(product.mainCategory || t.mainCategory || '').trim();
						if (mainCode) mainSel.value = mainCode;
						try { mainSel.dispatchEvent(new Event('change', { bubbles: true })); } catch (_) {}
						// sub main change    
						const subCode = String(product.subCategory || t.subCategory || '').trim();
						if (subCode) {
							//   
							const opt = Array.from(subSel.options).find(o => String(o.value || '').trim() === subCode);
							if (!opt) {
								const o = document.createElement('option');
								o.value = subCode;
								o.textContent = subCode;
								subSel.appendChild(o);
							}
							subSel.value = subCode;
							try { subSel.dispatchEvent(new Event('change', { bubbles: true })); } catch (_) {}
						}
					}

					const descEd = document.getElementById('productDescriptionEditor');
					if (descEd) setEditorHtml(descEd, product.descriptionHtml || '');

					// (   /uploads/...  existing   )
					try {
						if (product.images?.thumbnail) setPreviewExistingInSlot(document.getElementById('thumbnailImageInput'), product.images.thumbnail);
						if (product.images?.detailImage) setPreviewExistingInSlot(document.getElementById('detailImageInput'), product.images.detailImage);
						const list = Array.isArray(product.images?.productImages) ? product.images.productImages : [];
						const inputs = [
							document.getElementById('productImageInput0'),
							document.getElementById('productImageInput1'),
							document.getElementById('productImageInput2'),
							document.getElementById('productImageInput3'),
							document.getElementById('productImageInput4'),
						].filter(Boolean);
						// reset all
						inputs.forEach((inp) => {
							try { inp.value = ''; delete inp.dataset.existing; } catch (_) {}
							const slot = inp.closest('.upload-item');
							if (slot) {
								slot.querySelectorAll('img.preview').forEach(n => n.remove());
								slot.classList.remove('is-filled');
								const b = slot.querySelector('.btn-upload');
								if (b) b.style.display = '';
							}
						});
						list.slice(0, inputs.length).forEach((src, i) => setPreviewExistingInSlot(inputs[i], src));
					} catch (_) {}

					// 
					const sched = data.schedule || {};
					// 
					try {
						const meetingPanel = document.querySelector('.card-panel h3.grid-wrap-title[data-lan-eng="Meeting Information"]')?.closest('.card-panel');
						if (meetingPanel) {
							const sels = Array.from(meetingPanel.querySelectorAll('select'));
							const meet = sched.meeting || {};
							if (sels[0]) sels[0].value = String(meet.hour || '00').padStart(2, '0');
							if (sels[1]) sels[1].value = String(meet.minute || '00').padStart(2, '0');
							try { sels.forEach(s => s.dispatchEvent(new Event('change', { bubbles: true }))); } catch (_) {}
							const inputs = Array.from(meetingPanel.querySelectorAll('input.form-control'));
							if (inputs[0]) inputs[0].value = String(meet.placeName || '');
							if (inputs[1]) inputs[1].value = String(meet.placeAddress || '');
						}
					} catch (_) {}

					const days = Array.isArray(sched.days) ? sched.days : [];
					const baseDay = document.getElementById('nday');
					if (baseDay) baseDay.classList.add('nday-panel');
					const addDayBtn = document.querySelector('.aside-button-typeA');
					const getDayPanels = () => Array.from(document.querySelectorAll('.nday-panel'));
					while (getDayPanels().length < Math.max(1, days.length) && addDayBtn) {
						try { template_detail_sdaf(addDayBtn); } catch (_) { break; }
					}
					const panels = getDayPanels();
					days.forEach((d, idx) => {
						const p = panels[idx];
						if (!p) return;
						// summary
						try {
							const sumItem =
								p.querySelector('.label-name [data-lan-eng="Schedule Summary"]')?.closest('.grid-item') ||
								p.querySelector('.label-name[data-lan-eng="Schedule Summary"]')?.closest('.grid-item');
							const sumInput = sumItem?.querySelector('input.form-control');
							const v =
								String(d.summary || '').trim() ||
								String(d.scheduleSummary || '').trim() ||
								String(d.daySummary || '').trim() ||
								String(d.description || '').trim() ||
								String(d.dayDescription || '').trim();
							if (sumInput) sumInput.value = v;
						} catch (_) {}

						// 
						const attList = Array.isArray(d.attractions) ? d.attractions : [];
						const addBtn = p.querySelector('button[onclick*="template_detail_dfghs"]');
						const blocks = () => Array.from(p.querySelectorAll('.dfghs'));
						while (blocks().length < Math.max(1, attList.length) && addBtn) {
							try { template_detail_dfghs(addBtn); } catch (_) { break; }
						}
						const finalBlocks = blocks();
						attList.forEach((a, i) => {
							const b = finalBlocks[i];
							if (!b) return;
							const sels = Array.from(b.querySelectorAll('.meeting-wrap select'));
							if (sels[0]) sels[0].value = String(a.startHour || '').padStart(2, '0');
							if (sels[1]) sels[1].value = String(a.startMinute || '').padStart(2, '0');
							if (sels[2]) sels[2].value = String(a.endHour || '').padStart(2, '0');
							if (sels[3]) sels[3].value = String(a.endMinute || '').padStart(2, '0');
							try { sels.forEach(s => s.dispatchEvent(new Event('change', { bubbles: true }))); } catch (_) {}
							const inputs = Array.from(b.querySelectorAll('input.form-control'));
							if (inputs[0]) inputs[0].value = String(a.name || '');
							if (inputs[1]) inputs[1].value = String(a.address || '');
							const ed = b.querySelector('.jweditor');
							if (ed) setEditorHtml(ed, a.infoHtml || '');
							// 
							const fi = b.querySelector('.upload-grid input[type="file"]');
							if (fi) {
								const ex = String(a.image || '').trim();
								if (ex) {
									b.dataset.existingImage = ex;
									fi.dataset.existing = ex;
									setPreviewExistingInSlot(fi, ex);
								}
							}
						});

						// //
						try {
							const accomPanel = Array.from(p.querySelectorAll('.sub-panel')).find(sp => sp.querySelector('[data-lan-eng="Accommodation Information"]'));
							if (accomPanel) {
								const inputs = Array.from(accomPanel.querySelectorAll('input.form-control'));
								if (inputs[0]) inputs[0].value = String(d.accommodation?.name || '');
								if (inputs[1]) inputs[1].value = String(d.accommodation?.address || '');
								const ed = accomPanel.querySelector('.jweditor');
								if (ed) setEditorHtml(ed, d.accommodation?.descriptionHtml || '');
								const fi = accomPanel.querySelector('.upload-grid input[type="file"]');
								const ex = String(d.accommodation?.image || '').trim();
								if (fi && ex) {
									accomPanel.dataset.existingImage = ex;
									fi.dataset.existing = ex;
									setPreviewExistingInSlot(fi, ex);
								}
							}
							const transPanel = Array.from(p.querySelectorAll('.sub-panel')).find(sp => sp.querySelector('[data-lan-eng="Transportation Information"]'));
							if (transPanel) {
								const ed = transPanel.querySelector('.jweditor');
								if (ed) setEditorHtml(ed, d.transportation?.descriptionHtml || '');
							}
							const mealPanel = Array.from(p.querySelectorAll('.sub-panel')).find(sp => sp.querySelector('[data-lan-eng="Meal Information"]'));
							if (mealPanel) {
								const inputs = Array.from(mealPanel.querySelectorAll('input.form-control'));
								if (inputs[0]) inputs[0].value = String(d.meals?.breakfast || '');
								if (inputs[1]) inputs[1].value = String(d.meals?.lunch || '');
								if (inputs[2]) inputs[2].value = String(d.meals?.dinner || '');
							}
						} catch (_) {}
					});

					// //
					try {
						const per = data.pricing?.perPerson || [];
						const feePanel = document.querySelector('.card-panel .grid-wrap-title[data-lan-eng="Number of people fee"]')?.closest('.card-panel');
						if (feePanel) {
							const tbody = feePanel.querySelector('tbody');
							const addBtn = feePanel.querySelector('button[onclick*="template_detail_sfg1"]');
							while (tbody && tbody.querySelectorAll('tr').length < Math.max(1, per.length) && addBtn) {
								try { template_detail_sfg1(addBtn); } catch (_) { break; }
							}
							Array.from(tbody?.querySelectorAll('tr') || []).forEach((tr, idx) => {
								const r = per[idx];
								const inputs = Array.from(tr.querySelectorAll('input.form-control'));
								if (inputs[0]) inputs[0].value = r ? String(r.optionName || '') : '';
								if (inputs[1]) inputs[1].value = r ? String(r.price || '').split('.')[0] : '';
							});
						}
						const single = data.pricing?.singleRoomFee;
						const singlePanel = document.querySelector('.card-panel .grid-wrap-title[data-lan-eng="Room rate for single occupancy"]')?.closest('.card-panel');
						const singleInput = singlePanel?.querySelector('input.form-control');
						if (singleInput && single != null) singleInput.value = String(single).split('.')[0];

						const fillList = (lanEng, arr) => {
							const panel = document.querySelector(`.card-panel .grid-wrap-title[data-lan-eng="${CSS.escape(lanEng)}"]`)?.closest('.card-panel');
							if (!panel) return;
							const tbody = panel.querySelector('tbody');
							const addBtn = panel.querySelector('button[onclick*="template_detail_sfg3"]');
							const list = Array.isArray(arr) ? arr : [];
							while (tbody && tbody.querySelectorAll('tr').length < Math.max(1, list.length) && addBtn) {
								try { template_detail_sfg3(addBtn); } catch (_) { break; }
							}
							Array.from(tbody?.querySelectorAll('tr') || []).forEach((tr, idx) => {
								const v = list[idx];
								const inp = tr.querySelector('input.form-control');
								if (inp) inp.value = v ? String(v) : '';
							});
						};
						fillList('Included items', data.included || []);
						fillList('Excluded items', data.excluded || []);
					} catch (_) {}

					// //
					try {
						const setSectionEditor = (lanEng, html) => {
							const h2 = document.querySelector(`h2.section-title[data-lan-eng="${CSS.escape(lanEng)}"]`);
							const panel = h2?.nextElementSibling;
							const eds = Array.from(panel?.querySelectorAll('.jweditor') || []);
							const ed = eds[eds.length - 1];
							if (ed) setEditorHtml(ed, html || '');
							return panel;
						};
						const usagePanel = setSectionEditor('Usage Guide', data.usageGuide?.descriptionHtml || '');
						const cancelPanel = setSectionEditor('Cancellation/Refund Policy', data.cancellationPolicy?.descriptionHtml || '');
						setSectionEditor('Visa Application Guide', data.visaGuide?.descriptionHtml || '');
						// refundDays
						const refundInput = cancelPanel?.querySelector('input.form-control');
						if (refundInput && data.cancellationPolicy?.refundDays != null) refundInput.value = String(data.cancellationPolicy.refundDays);
						// usage file
						const usageFile = usagePanel?.querySelector('input[type="file"]');
						const f = data.usageGuide?.file || {};
						if (usageFile && (f.filePath || f.fileName)) {
							usageFile.dataset.existing = String(f.filePath || f.fileName || '');
							usageFile.dataset.existingName = String(f.originalName || f.fileName || f.filePath || '');
							usageFile.dataset.existingSize = String(f.fileSize || '');
							try { noticeUploadChange(usageFile); } catch (_) {}
						}
					} catch (_) {}

					//  select (  UI )
					try { __resetSelectWidgets(document); } catch (_) {}
					try { if (typeof jw_select === 'function') jw_select(); } catch (_) {}
				};

				const onSearch = () => fetchTemplates(input?.value || '');
				btn?.addEventListener('click', (e) => { e.preventDefault(); onSearch(); });
				input?.addEventListener('keydown', (e) => { if (e.key === 'Enter') { e.preventDefault(); onSearch(); } });
				loadBtn?.addEventListener('click', async (e) => {
					e.preventDefault();
					if (!selectedId) return;
					try {
						await applyTemplateToProductForm(selectedId);
						try { modal_close(); } catch (_) {}
					} catch (err) {
						console.error(err);
						alert(err?.message || '  .');
					}
				});

				//  
				fetchTemplates('');
			});

			const __boot = async () => {
				try {
					const sessionRes = await fetch('../backend/api/check-session.php', { credentials: 'same-origin' });
					const sessionData = await sessionRes.json().catch(() => ({}));
					if (!sessionData?.authenticated) { window.location.href = '../index.html'; return; }

					//      "  " 
					__clearPublishingDefaults();

					//    (/)
					try {
						// " "   : super-api.php?action=getCategories
						const r = await fetch('../backend/api/super-api.php?action=getCategories', { credentials: 'same-origin' });
						const j = await r.json().catch(() => ({}));
						if (j?.success && Array.isArray(j?.data?.categories)) {
							window.__productCategoryMeta = j.data.categories;
							const mainSel = document.getElementById('mainCategory') || document.querySelector('select[data-category="1"]');
							const subSel = document.getElementById('subCategory') || document.querySelector('select[data-category="2"]');
							if (mainSel && subSel) {
								const lang = (typeof getCookie === 'function' ? (getCookie('lang') || 'eng') : 'eng');

								// main options ( code)
								mainSel.innerHTML = '';
								{
									const opt = document.createElement('option');
									opt.value = '';
									opt.textContent = 'Select main category';
									opt.setAttribute('data-lan-eng', 'Select main category');
									opt.setAttribute('data-lan-ko', ' ');
									opt.setAttribute('data-lan-tl', 'Select main category');
									mainSel.appendChild(opt);
								}
								(window.__productCategoryMeta || []).forEach((m) => {
									const code = String(m?.code || '').trim();
									if (!code) return;
									const name = String(m?.name || code).trim();
									const opt = document.createElement('option');
									opt.value = code;
									//   " "  name  
									opt.textContent = name;
									opt.setAttribute('data-lan-eng', name);
									opt.setAttribute('data-lan-ko', name);
									opt.setAttribute('data-lan-tl', name);
									mainSel.appendChild(opt);
								});
								// IMPORTANT: jw_select는 한 번 래핑되면 이후 option 변경이 UI에 반영되지 않음.
								// 대/중분류 select는 옵션이 동적으로 바뀌므로, 여기서 wrapper를 한번 리셋해 UI를 최신 상태로 맞춘다.
								try { __resetSelectWidgets(mainSel.closest('.grid-item') || document); } catch (_) {}

								// sub builder
								const buildSub = () => {
									const mainCode = String(mainSel.value || '').trim();
									const meta = (window.__productCategoryMeta || []).find(x => String(x?.code || '').trim() === mainCode) || null;
									const subs = Array.isArray(meta?.subCategories) ? meta.subCategories : (Array.isArray(meta?.subcategories) ? meta.subcategories : []);
									subSel.disabled = !mainCode;
									subSel.innerHTML = '';
									if (!mainCode) {
										const opt = document.createElement('option');
										opt.value = '';
										opt.textContent = 'Please select a main category first';
										opt.setAttribute('data-lan-eng', 'Please select a main category first');
										opt.setAttribute('data-lan-ko', '   ');
										opt.setAttribute('data-lan-tl', 'Please select a main category first');
										subSel.appendChild(opt);
									} else {
										(subs || []).forEach((s) => {
											const code = String(s?.code || s?.value || '').trim();
											const name = String(s?.name || s?.label || code).trim();
											if (!code) return;
											const opt = document.createElement('option');
											opt.value = code;
											opt.textContent = name;
											subSel.appendChild(opt);
										});
										// sub가 비어있으면 placeholder라도 넣어 UI가 멈춘 것처럼 보이지 않게 한다
										if (!subSel.options.length) {
											const opt = document.createElement('option');
											opt.value = '';
											opt.textContent = 'No subcategories';
											opt.setAttribute('data-lan-eng', 'No subcategories');
											opt.setAttribute('data-lan-ko', ' ');
											opt.setAttribute('data-lan-tl', 'No subcategories');
											subSel.appendChild(opt);
										}
									}
									// jw_select UI를 반드시 갱신(기존 wrapper가 남아있으면 옵션 변경이 화면에 반영되지 않음)
									try { __resetSelectWidgets(subSel.closest('.grid-item') || document); } catch (_) {
										try { if (typeof jw_select === 'function') jw_select(); } catch (_) {}
									}
								};

								//  onchange 
								window.template_detail_sdaf_cate = buildSub;
								mainSel.addEventListener('change', buildSub);
								buildSub();

								try { if (typeof language_apply === 'function') language_apply(lang); } catch (_) {}
								try { if (typeof jw_select === 'function') jw_select(); } catch (_) {}
							}
						}
					} catch (_) {}
					const urlParams = new URLSearchParams(window.location.search);
					productId = urlParams.get('id') || urlParams.get('productId');
					if (!productId) return;
					__ensureProductIds();
					//     " "     
					try {
						const el = __ensureId('', 'productName');
						if (el) { el.value = ''; el.setAttribute('value', ''); }
					} catch (_) {}
					await loadAllToForm();
				} catch (e) {
					console.error('load failed:', e);
					alert(e?.message || '   .');
				}
			};

			// SMT: This script may be evaluated after DOMContentLoaded depending on injection/caching.
			// Run immediately if DOM is already ready.
			if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', __boot);
			else __boot();
		})();

		// ============ Sight Management Integration ============
		// Similar to product-registration.html
		let _currentSightBtn = null;

		function openSightSelectModal(btn) {
			_currentSightBtn = btn;
			modal('sight-select-modal.html', '650px', '600px');
		}

		// Called from modal when multiple sights are selected
		function handleSightsSelected(sights) {
			if (!Array.isArray(sights) || sights.length === 0 || !_currentSightBtn) return;

			// Find the sub-panel containing the button
			const subPanel = _currentSightBtn.closest('.sub-panel');
			if (!subPanel) {
				_currentSightBtn = null;
				return;
			}

			// Get existing dfghs blocks and add button
			const addBtn = subPanel.querySelector('button[onclick*="template_detail_dfghs"]');

			// Process each sight
			sights.forEach((sight, index) => {
				let blocks = Array.from(subPanel.querySelectorAll('.dfghs'));
				let block;

				if (index === 0 && blocks.length > 0) {
					// Use first existing block
					block = blocks[0];
				} else {
					// Create new block for subsequent sights
					if (addBtn) {
						template_detail_dfghs(addBtn);
						blocks = Array.from(subPanel.querySelectorAll('.dfghs'));
						block = blocks[blocks.length - 1];
					}
				}

				if (block) {
					fillSightBlock(block, sight);
				}
			});

			_currentSightBtn = null;
		}

		// Fill a dfghs block with sight data
		function fillSightBlock(block, sight) {
			if (!block || !sight) return;

			// Sight Name (first input - might be inside jw-center div)
			const nameInput = block.querySelector('.grid-item input.form-control');
			if (nameInput) {
				nameInput.value = sight.sightName || '';
			}

			// Sight Address (look for input after Sight Address label)
			const addressLabel = block.querySelector('[data-lan-eng="Sight Address"]');
			const addressItem = addressLabel ? addressLabel.closest('.grid-item') : null;
			const addressInput = addressItem ? addressItem.querySelector('input.form-control') : null;
			if (addressInput) {
				addressInput.value = sight.sightAddress || '';
			}

			// Sight Description (Quill editor)
			const editorDiv = block.querySelector('.jweditor');
			if (editorDiv) {
				if (sight.sightDescription) {
					editorDiv.innerHTML = sight.sightDescription;
				}
				// If Quill is initialized, update it too
				if (editorDiv.__quill) {
					try {
						editorDiv.__quill.root.innerHTML = sight.sightDescription || '';
					} catch (_) {}
				}
			}

			// Sight Image - show preview if exists
			if (sight.sightImage) {
				const uploadItem = block.querySelector('.upload-item');
				if (uploadItem) {
					const imgUrl = '/uploads/sights/' + sight.sightImage;
					uploadItem.innerHTML = `
						<div class="thumbnail" data-sight-image="${sight.sightImage}">
							<img class="preview" src="${imgUrl}" alt="">
							<button type="button" class="btn-remove" onclick="removeSightPreview(this)">
								<img src="../image/xbutton.svg" alt="Remove">
							</button>
						</div>
						<label class="inputFile">
							<input type="file" onchange="filePreview(this);" data-existing="${sight.sightImage}">
							<button type="button" class="btn-upload"><img src="../image/upload3.svg" alt=""> <span>Image upload</span></button>
						</label>
					`;
				}
			}
		}

		// Legacy single sight handler (for backward compatibility)
		function handleSightSelected(sight) {
			if (!sight) return;
			handleSightsSelected([sight]);
		}

		function removeSightPreview(btn) {
			const thumbnail = btn.closest('.thumbnail');
			if (thumbnail) {
				const uploadItem = thumbnail.closest('.upload-item');
				const block = thumbnail.closest('.dfghs');

				// Clear data-existing on file input
				const fileInput = uploadItem?.querySelector('input[type="file"]');
				if (fileInput) {
					fileInput.value = '';
					delete fileInput.dataset.existing;
				}

				// Clear block.dataset.existingImage
				if (block) {
					delete block.dataset.existingImage;
				}

				thumbnail.remove();

				// Reset upload UI state
				if (uploadItem) {
					uploadItem.classList.remove('is-filled');
					const uploadBtn = uploadItem.querySelector('.btn-upload');
					if (uploadBtn) uploadBtn.style.display = '';
				}
			}
		}

		// ============ Accommodation Block Management ============
		function addAccommodationBlock() {
			const container = document.getElementById('accommodationBlocksContainer');
			if (!container) return;

			const blocks = container.querySelectorAll('.accommodation-block');
			const newIdx = blocks.length;

			// Clone the first block
			const firstBlock = blocks[0];
			if (!firstBlock) return;

			const newBlock = firstBlock.cloneNode(true);
			newBlock.setAttribute('data-accom-idx', newIdx);

			// Update title
			const title = newBlock.querySelector('.accom-block-title');
			if (title) title.textContent = 'Accommodation ' + (newIdx + 1);

			// Show delete button
			const deleteBtn = newBlock.querySelector('button[onclick*="removeAccommodationBlock"]');
			if (deleteBtn) deleteBtn.style.display = '';

			// Clear values
			newBlock.querySelectorAll('input.form-control').forEach(input => input.value = '');

			// Clear editor content
			const editorDiv = newBlock.querySelector('.jweditor');
			if (editorDiv) {
				editorDiv.innerHTML = '';
				// Remove existing Quill instance reference
				delete editorDiv.__quill;
			}

			// Clear images
			const imageGrid = newBlock.querySelector('.accom-image-grid');
			if (imageGrid) {
				imageGrid.querySelectorAll('.thumbnail').forEach(t => t.remove());
				const fileInput = imageGrid.querySelector('input[type="file"]');
				if (fileInput) fileInput.value = '';
			}

			container.appendChild(newBlock);

			// Initialize Quill for the new editor
			initializeEditorInBlock(newBlock);

			// Show delete buttons on all blocks if more than one
			updateAccommodationDeleteButtons();
		}

		function removeAccommodationBlock(btn) {
			const block = btn.closest('.accommodation-block');
			if (!block) return;

			const container = document.getElementById('accommodationBlocksContainer');
			const blocks = container.querySelectorAll('.accommodation-block');

			// Don't remove if only one block remains
			if (blocks.length <= 1) return;

			block.remove();

			// Reindex remaining blocks
			container.querySelectorAll('.accommodation-block').forEach((b, idx) => {
				b.setAttribute('data-accom-idx', idx);
				const title = b.querySelector('.accom-block-title');
				if (title) title.textContent = 'Accommodation ' + (idx + 1);
			});

			updateAccommodationDeleteButtons();
		}

		function updateAccommodationDeleteButtons() {
			const container = document.getElementById('accommodationBlocksContainer');
			if (!container) return;

			const blocks = container.querySelectorAll('.accommodation-block');
			blocks.forEach((block, idx) => {
				const deleteBtn = block.querySelector('button[onclick*="removeAccommodationBlock"]');
				if (deleteBtn) {
					// Show delete button only if more than one block exists
					deleteBtn.style.display = blocks.length > 1 ? '' : 'none';
				}
			});
		}

		function initializeEditorInBlock(block) {
			const editorDiv = block.querySelector('.jweditor:not(.ql-container)');
			if (!editorDiv || editorDiv.__quill) return;

			const toolbar = block.querySelector('.toolbar');
			if (!toolbar) return;

			try {
				const quill = new Quill(editorDiv, {
					theme: 'snow',
					modules: {
						toolbar: toolbar
					}
				});
				editorDiv.__quill = quill;
			} catch (e) {
				console.warn('Could not initialize Quill editor:', e);
			}
		}
	</script>

</body>

</html>
