<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1.0">
	<title>SMART TRAVEL ADMIN</title>

	<!-- editor (publishing parity) -->
	<script src="https://cdn.jsdelivr.net/npm/quill@1.3.7/dist/quill.js"></script>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/quill@1.3.7/dist/quill.snow.css">

	<!--   -->
	<link rel="shortcut icon" href="../image/favicon.ico">
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100;300;400;500;700;900&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="../css/a_reset.css">
	<link rel="stylesheet" href="../css/a_variables.css">
	<link rel="stylesheet" href="../css/a_components.css">
	<link rel="stylesheet" href="../css/a_contents.css">
	
	<!-- calendar -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css">
	<script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/moment@2.30.1/moment.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
</head>

<body>

	<!-- header   -->
	<header class="layout-header"></header>

	<!--   -->
	<main class="layout-main">
		<!-- nav   -->
		<nav class="layout-nav"></nav>

		<section class="layout-content layout-content-aside" data-essentialWrap="y">
		
			<div class="jw-cols jw-between col-span-2">
				<h1 class="page-title" data-lan-eng="Product Registration">Product Registration</h1>
				<div class="jw-cols jw-gap16">
				</div>
			</div>

			<div class="content-main">
				<div class="jw-cols jw-between jw-mgt32">
					<h2 class="section-title" id="section-product-info" data-lan-eng="Product Information">Product Information</h2>
					<button type="button" class="jw-button typeA" onclick="modal('product-detail_m1.html', '580px', '508px')" data-lan-eng="Load Template">Load Template</button>
				</div>

				<div class="card-panel jw-mgt16">
					<div class="grid-wrap">
						<div class="grid-item col-span-3">
							<label class="label-name"><span data-lan-eng="Product Name">Product Name</span> <span class="req">*</span></label>
							<input type="text" class="form-control" id="productName" placeholder="" data-lan-eng="Product Name">
							
						</div>

						<div class="grid-item">
							<label class="label-name" data-lan-eng=""><span data-lan-eng="Sales Target">Sales Target</span> <span class="req">*</span></label>
							<select class="select" id="salesTarget" data-essential="y">
								<option selected>B2B</option>
								<option>B2C</option>
							</select>
						</div>
						<div class="grid-item"></div>
						<div class="grid-item"></div>
						<div class="grid-item">
							<label class="label-name" data-lan-eng=""><span data-lan-eng="Main Category">Main Category</span> <span class="req">*</span></label>
							<select class="select" id="mainCategory" data-essential="y" data-category="1" onchange="template_detail_sdaf_cate()">
								<option value="">Select main category</option>
								<option value="season" selected>Seasonal</option>
								<option value="region">Regional</option>
								<option value="theme">Theme</option>
							</select>
						</div>
						<div class="grid-item">
							<label class="label-name" data-lan-eng=""><span data-lan-eng="Sub Category">Sub Category</span> <span class="req">*</span></label>
							<select class="select" id="subCategory" data-essential="y" data-category="2">
								<option value="" data-lan-eng="Select sub category">Select sub category</option>
								<option value="spring">Spring</option>
								<option value="summer" selected>Summer</option>
								<option value="autumn">Autumn</option>
								<option value="winter">Winter</option>
							</select>
						</div>
						<div class="grid-item"></div>
						<!-- multi-editor.js -->
						<div class="grid-item col-span-3">
							<label class="label-name"><span data-lan-eng="Product Description">Product Description</span> <span class="req">*</span></label>
							<div class="editor-box-wrap">
							<div class="jw-editor">
								<div class="toolbar">
									<div class="group">
										<button type="button" class="editor-btn ql-bold"><img src="../image/editer_bold.svg" alt=""></button>
										<button type="button" class="editor-btn ql-italic"><img src="../image/editer_italic.svg" alt=""></button>
										<button type="button" class="editor-btn ql-underline"><img src="../image/editer_underline.svg" alt=""></button>
										<button type="button" class="editor-btn ql-strike"><img src="../image/editer_strikethrough.svg" alt=""></button>
										<button type="button" class="editor-btn font-color" onclick="setColor(this);">A</button>
										<button type="button" class="background-color" onclick="setColor(this, 2);"></button>
									</div>
						
									<div class="group">
										<select class="ql-size">
										  <option value="" selected>Font</option>
										  <option value="12px">12px</option>
										  <option value="14px">14px</option>
										  <option value="16px">16px</option>
										  <option value="18px">18px</option>
										  <option value="24px">24px</option>
										</select>
									</div>

									<div class="group">
										<button type="button" class="editor-btn ql-align" value="">
										<img src="../image/editer_left.svg">
										</button>
										<button type="button" class="editor-btn ql-align" value="center">
										<img src="../image/editer_center.svg">
										</button>
										<button type="button" class="editor-btn ql-align" value="right">
										<img src="../image/editer_right.svg">
										</button>
									</div>
							
									<div class="group">
										<button type="button" class="editor-btn ql-list" value="ordered">
										<img src="../image/editer_ordered.svg">
										</button>
										<button type="button" class="editor-btn ql-list" value="bullet">
										<img src="../image/editer_unordered.svg">
										</button>
									</div>
								</div>
							
								<div class="jweditor" id="productDescriptionEditor" data-placeholder=" "></div>
								</div>
							</div>
						</div>
						<div class="grid-item">
							<label class="label-name"><span data-lan-eng="Thumbnail image">Thumbnail image</span> <span class="req">*</span></label>
							<div class="upload-grid" data-field="thumbnailImage">
								<div class="upload-item jw-center">
									<label class="inputFile">
										<input id="thumbnailImageInput" name="" type="file" onchange="filePreview(this);" >
										<button type="button" class="btn-upload"><img src="../image/upload3.svg" alt=""> <span data-lan-eng="Image upload">Image upload</span></button>
									</label>
								</div>
							</div>
						</div>
						<div class="grid-item"></div>
						<div class="grid-item"></div>
						<div class="grid-item col-span-3">
							<label class="label-name" data-lan-eng="Product image">Product image</label>
							<div class="upload-grid" data-field="productImages">
								<div class="upload-item jw-center">
									<label class="inputFile">
										<input id="productImageInput0" name="" type="file" onchange="filePreview(this);" >
										<button type="button" class="btn-upload"><img src="../image/upload3.svg" alt=""> <span data-lan-eng="Image upload">Image upload</span></button>
									</label>
								</div>
								<div class="upload-item jw-center">
									<label class="inputFile">
										<input id="productImageInput1" name="" type="file" onchange="filePreview(this);" >
										<button type="button" class="btn-upload"><img src="../image/upload3.svg" alt=""> <span data-lan-eng="Image upload">Image upload</span></button>
									</label>
							</div>
								<div class="upload-item jw-center">
									<label class="inputFile">
										<input id="productImageInput2" name="" type="file" onchange="filePreview(this);" >
										<button type="button" class="btn-upload"><img src="../image/upload3.svg" alt=""> <span data-lan-eng="Image upload">Image upload</span></button>
									</label>
						</div>
								<div class="upload-item jw-center">
									<label class="inputFile">
										<input id="productImageInput3" name="" type="file" onchange="filePreview(this);" >
										<button type="button" class="btn-upload"><img src="../image/upload3.svg" alt=""> <span data-lan-eng="Image upload">Image upload</span></button>
									</label>
								</div>
								<div class="upload-item jw-center">
									<label class="inputFile">
										<input id="productImageInput4" name="" type="file" onchange="filePreview(this);" >
										<button type="button" class="btn-upload"><img src="../image/upload3.svg" alt=""> <span data-lan-eng="Image upload">Image upload</span></button>
									</label>
								</div>
							</div>
						</div>
						<div class="grid-item">
							<label class="label-name"><span data-lan-eng="Detailed introduction image">Detailed introduction image</span> <span class="req">*</span></label>
							<div class="upload-grid" data-field="detailImage">
								<div class="upload-item jw-center">
									<label class="inputFile">
										<input id="detailImageInput" name="" type="file" onchange="filePreview(this);" >
										<button type="button" class="btn-upload"><img src="../image/upload3.svg" alt=""> <span data-lan-eng="Image upload">Image upload</span></button>
									</label>
								</div>
							</div>
						</div>
						<div class="grid-item"></div>
						<div class="grid-item"></div>
					</div>
				</div>

				<h2 class="section-title jw-mgt32" data-section-name="flight-information" data-lan-eng="Flight Information">Flight Information</h2>
				<div class="card-panel jw-mgt16" data-section-name="flight-information" >
					<h3 class="grid-wrap-title" data-lan-eng="Departure flight">Departure flight</h3>

					<div class="grid-wrap jw-mgt16">
						<div class="grid-item">
							<label class="label-name"><span data-lan-eng="Flight number">Flight number</span> <span class="req">*</span></label>
							<input type="text" class="form-control" value="">
						</div>

						<div class="grid-item">
							<label class="label-name"><span data-lan-eng="Airline">Airline</span></label>
							<select class="select airline-select">
								<option value="">Select Airline</option>
								<option value="Cebu Pacific">Cebu Pacific</option>
								<option value="Air Asia">Air Asia</option>
								<option value="Jeju Air">Jeju Air</option>
							</select>
						</div>

						<div class="grid-item">
							<label class="label-name"><span data-lan-eng="Departure time">Departure time</span> <span class="req">*</span></label>
							<div class="meeting-wrap">
								<select class="select">
									<option>00</option>
									<option>01</option>
									<option>02</option>
									<option>03</option>
									<option>04</option>
									<option>05</option>
									<option>06</option>
									<option>07</option>
									<option>08</option>
									<option>09</option>
									<option>10</option>
									<option>11</option>
									<option>12</option>
									<option>13</option>
									<option>14</option>
									<option>15</option>
									<option>16</option>
									<option>17</option>
									<option>18</option>
									<option>19</option>
									<option>20</option>
									<option>21</option>
									<option>22</option>
									<option>23</option>
								</select>
								<select class="select">
									<option>00</option>
									<option>10</option>
									<option>20</option>
									<option>30</option>
									<option>40</option>
									<option>50</option>
								</select>
							</div>
						</div>

						<div class="grid-item">
							<label class="label-name"><span data-lan-eng="Arrival time">Arrival time</span> <span class="req">*</span></label>
							<div class="meeting-wrap">
								<select class="select">
									<option>00</option>
									<option>01</option>
									<option>02</option>
									<option>03</option>
									<option>04</option>
									<option>05</option>
									<option>06</option>
									<option>07</option>
									<option>08</option>
									<option>09</option>
									<option>10</option>
									<option>14</option>
									<option>15</option>
									<option>16</option>
									<option>17</option>
									<option>18</option>
									<option>19</option>
									<option>20</option>
									<option>21</option>
									<option>22</option>
									<option>23</option>
								</select>
								<select class="select">
									<option>00</option>
									<option>10</option>
									<option>20</option>
									<option>30</option>
									<option>40</option>
									<option>50</option>
								</select>
							</div>
						</div>
						<div class="grid-item">
							<label class="label-name"><span data-lan-eng="Departure point">Departure point</span> <span class="req">*</span></label>
							<input type="text" class="form-control" value="" placeholder="Departure point">
						</div>

						<div class="grid-item">
							<label class="label-name"><span data-lan-eng="Destination">Destination</span> <span class="req">*</span></label>
							<input type="text" class="form-control" value="" placeholder="Destination">
						</div>

						<div class="grid-item"></div>
					</div>
					</div>
				<div class="card-panel jw-mgt16" data-section-name="flight-information" >
					<h3 class="grid-wrap-title" data-lan-eng="Return trip">Return trip</h3>

					<div class="grid-wrap jw-mgt16">
						<div class="grid-item">
							<label class="label-name"><span data-lan-eng="Flight number">Flight number</span> <span class="req">*</span></label>
							<input type="text" class="form-control" value="">
						</div>

						<div class="grid-item">
							<label class="label-name"><span data-lan-eng="Airline">Airline</span></label>
							<select class="select airline-select">
								<option value="">Select Airline</option>
								<option value="Cebu Pacific">Cebu Pacific</option>
								<option value="Air Asia">Air Asia</option>
								<option value="Jeju Air">Jeju Air</option>
							</select>
						</div>

						<div class="grid-item">
							<label class="label-name"><span data-lan-eng="Departure time">Departure time</span> <span class="req">*</span></label>
							<div class="meeting-wrap">
								<select class="select">
									<option>00</option>
									<option>01</option>
									<option>02</option>
									<option>03</option>
									<option>04</option>
									<option>05</option>
									<option>06</option>
									<option>07</option>
									<option>08</option>
									<option>09</option>
									<option>10</option>
									<option>11</option>
									<option>12</option>
									<option>13</option>
									<option>17</option>
									<option>18</option>
									<option>19</option>
									<option>20</option>
									<option>21</option>
									<option>22</option>
									<option>23</option>
								</select>
								<select class="select">
									<option>00</option>
									<option>05</option>
									<option>10</option>
									<option>20</option>
									<option>30</option>
									<option>40</option>
									<option>50</option>
								</select>
							</div>
						</div>

						<div class="grid-item">
							<label class="label-name"><span data-lan-eng="Arrival time">Arrival time</span> <span class="req">*</span></label>
							<div class="meeting-wrap">
								<select class="select">
									<option>00</option>
									<option>01</option>
									<option>02</option>
									<option>03</option>
									<option>04</option>
									<option>05</option>
									<option>06</option>
									<option>07</option>
									<option>08</option>
									<option>09</option>
									<option>10</option>
									<option>11</option>
									<option>19</option>
									<option>20</option>
									<option>21</option>
									<option>22</option>
									<option>23</option>
								</select>
								<select class="select">
									<option>00</option>
									<option>05</option>
									<option>10</option>
									<option>20</option>
									<option>30</option>
									<option>40</option>
									<option>50</option>
								</select>
							</div>
						</div>
						<div class="grid-item">
							<label class="label-name"><span data-lan-eng="Departure point">Departure point</span> <span class="req">*</span></label>
							<input type="text" class="form-control" value="" placeholder="Departure point">
						</div>
						<div class="grid-item">
							<label class="label-name"><span data-lan-eng="Destination">Destination</span> <span class="req">*</span></label>
							<input type="text" class="form-control" value="" placeholder="Destination">
						</div>

						<div class="grid-item"></div>
					</div>
				</div>


				<h2 class="section-title jw-mgt32" id="section-sales-info" data-lan-eng="Sales Information">Sales Information</h2>
				<div class="card-panel jw-mgt16">
					<h3 class="grid-wrap-title" data-lan-eng="Basic Sales Information">Basic Sales Information</h3>

					<div class="grid-wrap jw-mgt16">
						<div class="grid-item">
							<label class="label-name"><span data-lan-eng="Sale period">Sale period</span> <span class="req">*</span></label>
							<div class="field-row jw-w400">
								<input id="contract-period" type="text" class="jw-w form-control" placeholder="YYYY-MM-DD ~ YYYY-MM-DD" data-lan-eng-placeholder="YYYY-MM-DD ~ YYYY-MM-DD" readonly>
								<button type="button" class="btn-icon calendar" aria-label=" " data-target="#contract-period"></button>
							</div>

							<p class="form-desc is-warning" data-lan-eng="The period can only be set up to a maximum of 100 days.">  <b>100</b>  .</p>
						</div>

						<div class="grid-item"></div>
						<div class="grid-item"></div>
						<div class="grid-item">
							<label class="label-name"><span data-lan-eng="Minimum departure headcount">Minimum departure headcount</span> <span class="req">*</span></label>
							<input id="minParticipants" type="number" class="form-control" value="" min="0" placeholder="Enter numbers">
						</div>

						<div class="grid-item">
							<label class="label-name"><span data-lan-eng="Maximum capacity">Maximum capacity</span> <span class="req">*</span></label>
							<input id="maxParticipants" type="text" class="form-control" value="" min="0" placeholder="Enter numbers">
						</div>

						<div class="grid-item" data-section-name="flight-information">
							<label class="label-name"><span data-lan-eng="Basic Airfare (₱)">Basic Airfare (₱)</span> <span class="req">*</span></label>
							<input type="text" class="form-control" value="" inputmode="numeric" placeholder="Only products that include flights can be entered." disabled>
						</div>
					</div>
				</div>

				<div class="card-panel jw-mgt16" data-section-name="iljastar">
					<h3 class="grid-wrap-title" data-lan-eng="Daily Sales Adjustment">Daily Sales Adjustment</h3>
					<div class="calendar-row jw-mgt16">
						<!--   (#contract-period)   JS  . -->

					</div>
					<div class="tableA-scrollY jw-mgt32" style="height:400px;">
						<table class="jw-tableA booking-detail">
							<colgroup>
								<col class="col-60">
								<col>
								<col>
								<col>
							</colgroup>
							<thead>
								<tr>
									<th class="no is-center">No</th>
									<th data-lan-eng="Flight departure date">Flight departure date</th>
									<th data-lan-eng="Maximum capacity">Maximum capacity</th>
									<th data-lan-eng="Airfare (₱)">Airfare (₱)</th>
								</tr>
							</thead>
							<tbody></tbody>
						</table>
					</div>
				</div>

				<h2 class="section-title jw-mgt32" id="section-schedule" data-lan-eng="Schedule">Schedule</h2>
				<div class="card-panel jw-mgt16">
					<h3 class="grid-wrap-title" id="section-meeting-info" data-lan-eng="Meeting Information">Meeting Information</h3>

					<div class="grid-wrap jw-mgt16">
						<div class="grid-item">
							<label class="label-name"><span data-lan-eng="Meeting time">Meeting time</span> <span class="req">*</span></label>
							<div class="meeting-wrap">
								<select class="select">
									<option>00</option>
									<option>01</option>
									<option>02</option>
									<option>03</option>
									<option>04</option>
									<option>05</option>
									<option>06</option>
									<option>07</option>
									<option>08</option>
									<option>09</option>
									<option>10</option>
									<option>11</option>
									<option>12</option>
									<option>13</option>
									<option>14</option>
									<option>15</option>
									<option>16</option>
									<option>17</option>
									<option>18</option>
									<option>19</option>
									<option>20</option>
									<option>21</option>
									<option>22</option>
									<option>23</option>
								</select>
								<select class="select">
									<option selected>00</option>
									<option>05</option>
									<option>10</option>
									<option>15</option>
									<option>20</option>
									<option>25</option>
									<option>30</option>
									<option>35</option>
									<option>40</option>
									<option>45</option>
									<option>50</option>
									<option>55</option>
								</select>
							</div>
						</div>
						<div class="grid-item"></div>
						<div class="grid-item"></div>
						<div class="grid-item col-span-3">
							<label class="label-name"><span data-lan-eng="Meeting place name">Meeting place name</span> <span class="req">*</span></label>
							<div class="jw-center jw-gap20">
								<input type="text" class="form-control jw-wf" value="Please search for an address" disabled>
								<button type="button" class="jw-button typeA " data-lan-eng="Address Search">Address Search</button>
							</div>
						</div>
						<div class="grid-item col-span-3">
							<label class="label-name"><span data-lan-eng="Meeting place address">Meeting place address</span> <span class="req">*</span></label>
							<input type="text" class="form-control" value="Please search for an address" disabled>
						</div>
					</div>
				</div>

				<div class="card-panel jw-mgt16" id="nday">
					<h3 class="grid-wrap-title">
						<!-- <select class="select">
							<option>1Day</option>
						</select> -->
						<button type="button" class="jw-w jw-cols jw-between" onclick="ndasdtoggle(this)">1Day <img src="../image/arrow42.svg" alt=""></button>
					</h3>
					<i class="line"></i>
					<div class="grid-wrap jw-mgt12">
						<div class="grid-item col-span-3">
							<label class="label-name" data-lan-eng="Schedule Summary">Schedule Summary</label>
							<input type="text" class="form-control" placeholder="Schedule Summary">
						</div>
					</div>
					<div class="sub-panel jw-mgt20">
						<h3 class="grid-wrap-title" data-lan-eng="Tourist Information">Tourist Information</h3>
						<div class="jw-cols jw-gap12 jw-mgt12">
							<button type="button" class="jw-button typeA" data-lan-eng="Load Sight" onclick="openSightSelectModal(this)">Load Sight</button>
						</div>
						<div class="grid-wrap grid-highlight jw-mgt12 dfghs">
							<div class="grid-item col-span-3">
								<label class="label-name"><span data-lan-eng="Sight Name">Sight Name</span> <span class="req">*</span></label>
								<div class="jw-center jw-gap20">
									<input type="text" class="form-control jw-wf" value="" placeholder="Please search for an address"  disabled>
									<button type="button" class="jw-button typeA " data-lan-eng="Address Search">Address Search</button>
								</div>
							</div>
							<div class="grid-item col-span-3">
								<label class="label-name"><span data-lan-eng="Sight Address">Sight Address</span> <span class="req">*</span></label>
								<input type="text" class="form-control" value="" placeholder="Please search for an address" data-lan-eng="Please search for an address" disabled >
							</div>
							<!-- multi-editor.js -->
							<div class="grid-item col-span-3">
								<label class="label-name"><span data-lan-eng="Sight Information">Sight Information</span> <span class="req">*</span></label>
								<div class="editor-box-wrap">
								<div class="jw-editor">
									<div class="toolbar">
										<div class="group">
											<button type="button" class="editor-btn ql-bold"><img src="../image/editer_bold.svg" alt=""></button>
											<button type="button" class="editor-btn ql-italic"><img src="../image/editer_italic.svg" alt=""></button>
											<button type="button" class="editor-btn ql-underline"><img src="../image/editer_underline.svg" alt=""></button>
											<button type="button" class="editor-btn ql-strike"><img src="../image/editer_strikethrough.svg" alt=""></button>
											<button type="button" class="editor-btn font-color" onclick="setColor(this);">A</button>
											<button type="button" class="background-color" onclick="setColor(this, 2);"></button>
										</div>
										<div class="group">
											<select class="ql-size">
											  <option value="" selected>Font</option>
											  <option value="12px">12px</option>
											  <option value="14px">14px</option>
											  <option value="16px">16px</option>
											  <option value="18px">18px</option>
											  <option value="24px">24px</option>
											</select>
										</div>
										<div class="group">
											<button type="button" class="editor-btn ql-align" value=""><img src="../image/editer_left.svg" alt=""></button>
											<button type="button" class="editor-btn ql-align" value="center"><img src="../image/editer_center.svg" alt=""></button>
											<button type="button" class="editor-btn ql-align" value="right"><img src="../image/editer_right.svg" alt=""></button>
										</div>
										<div class="group">
											<button type="button" class="editor-btn ql-list" value="ordered"><img src="../image/editer_ordered.svg" alt=""></button>
											<button type="button" class="editor-btn ql-list" value="bullet"><img src="../image/editer_bullet.svg" alt=""></button>
										</div>
									</div>
							
									<div class="jweditor" data-placeholder=" "></div>
								</div>
								</div>
							</div>
							<div class="grid-item">
								<label class="label-name"><span data-lan-eng="Sight Image">Sight Image</span> <span class="req">*</span></label>
								<div class="upload-grid">
									<div class="upload-item jw-center">
										<label class="inputFile">
											<input name="" type="file" onchange="filePreview(this); " >
											<button type="button" class="btn-upload"><img src="../image/upload3.svg" alt=""> <span data-lan-eng="Image upload">Image upload</span></button>
										</label>
									</div>
								</div>
							</div>
							<div class="grid-item col-span-3">
								<div class="grid-item-controoler">
									<button type="button" class="jw-button typeA" onclick="template_detail_hsdfghsh(this)"><img src="../image/trash.svg" alt="" data-lan-eng="Delete tourist attraction">Delete tourist attraction</button>
								</div>
							</div>
						</div>
					</div>
					<div class="sub-panel jw-mgt20">
						<h4 class="grid-wrap-title" data-lan-eng="Meal Information">Meal Information</h4>
						<div class="grid-wrap grid-highlight jw-mgt12">
							<div class="grid-item">
								<label class="label-name" data-lan-eng="Breakfast">Breakfast</label>
								<input type="text" class="form-control" value="" placeholder="Breakfast">
							</div>
							<div class="grid-item">
								<label class="label-name" data-lan-eng="Lunch">Lunch</label>
								<input type="text" class="form-control" value="" placeholder="Lunch">
							</div>
							<div class="grid-item">
								<label class="label-name" data-lan-eng="Dinner">Dinner</label>
								<input type="text" class="form-control" value="" placeholder="Dinner">
							</div>
						</div>
					</div>
				</div>

				<h2 class="section-title jw-mgt32" id="section-common-settings" data-lan-eng="Common Settings">Common Settings</h2>
				<div class="card-panel jw-mgt16" id="commonAccommodationPanel">
					<div class="jw-cols jw-between jw-align-center">
						<h3 class="grid-wrap-title"><span data-lan-eng="Accommodation Information">Accommodation Information</span></h3>
						<button type="button" class="jw-button typeA" onclick="addAccommodationBlock()" data-lan-eng="+ Add Accommodation">+ Add Accommodation</button>
					</div>
					<div id="accommodationBlocksContainer">
						<div class="accommodation-block" data-accom-idx="0">
							<div class="jw-cols jw-between jw-align-center jw-mgt16">
								<h4 class="accom-block-title" style="font-size:14px;font-weight:600;color:#4A90D9;">Accommodation 1</h4>
								<button type="button" class="jw-button typeB btn-sm" onclick="removeAccommodationBlock(this)" style="display:none;" data-lan-eng="Delete">Delete</button>
							</div>
							<div class="grid-wrap jw-mgt12 grid-highlight">
								<div class="grid-item col-span-3">
									<label class="label-name"><span data-lan-eng="Accommodation name">Accommodation name</span> <span class="req">*</span></label>
									<input type="text" class="form-control accom-name" value="" placeholder="Enter accommodation name" data-lan-eng-placeholder="Enter accommodation name">
								</div>
								<div class="grid-item col-span-3">
									<label class="label-name"><span data-lan-eng="Accommodation address">Accommodation address</span></label>
									<input type="text" class="form-control accom-address" value="" placeholder="Enter accommodation address" data-lan-eng-placeholder="Enter accommodation address">
								</div>
								<div class="grid-item col-span-3">
									<label class="label-name"><span data-lan-eng="Accommodation Description">Accommodation Description</span></label>
									<div class="editor-box-wrap">
										<div class="jw-editor">
											<div class="toolbar">
												<div class="group">
													<button type="button" class="editor-btn ql-bold"><img src="../image/editer_bold.svg" alt=""></button>
													<button type="button" class="editor-btn ql-italic"><img src="../image/editer_italic.svg" alt=""></button>
													<button type="button" class="editor-btn ql-underline"><img src="../image/editer_underline.svg" alt=""></button>
													<button type="button" class="editor-btn ql-strike"><img src="../image/editer_strikethrough.svg" alt=""></button>
												</div>
												<div class="group">
													<select class="ql-size">
														<option value="" selected>Font</option>
														<option value="12px">12px</option>
														<option value="14px">14px</option>
														<option value="16px">16px</option>
														<option value="18px">18px</option>
														<option value="24px">24px</option>
													</select>
												</div>
												<div class="group">
													<button type="button" class="editor-btn ql-align" value=""><img src="../image/editer_left.svg" alt=""></button>
													<button type="button" class="editor-btn ql-align" value="center"><img src="../image/editer_center.svg" alt=""></button>
													<button type="button" class="editor-btn ql-align" value="right"><img src="../image/editer_right.svg" alt=""></button>
												</div>
												<div class="group">
													<button type="button" class="editor-btn ql-list" value="ordered"><img src="../image/editer_ordered.svg" alt=""></button>
													<button type="button" class="editor-btn ql-list" value="bullet"><img src="../image/editer_bullet.svg" alt=""></button>
												</div>
											</div>
											<div class="jweditor accom-description" data-placeholder="Enter accommodation description"></div>
										</div>
									</div>
								</div>
								<div class="grid-item">
									<label class="label-name"><span data-lan-eng="Accommodation image">Accommodation image</span></label>
									<div class="upload-grid accom-image-grid">
										<div class="upload-item jw-center">
											<label class="inputFile">
												<input type="file" accept="image/*" onchange="filePreview(this);">
												<button type="button" class="btn-upload"><img src="../image/upload3.svg" alt=""> <span data-lan-eng="Image upload">Image upload</span></button>
											</label>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="card-panel jw-mgt16" id="commonTransportation">
					<h3 class="grid-wrap-title" data-lan-eng="Transportation Information">Transportation Information</h3>
					<div class="grid-wrap jw-mgt16">
						<div class="grid-item col-span-3">
							<label class="label-name" data-lan-eng="Description">Description</label>
							<div class="editor-box-wrap">
								<div class="jw-editor">
									<div class="toolbar" id="commonTransToolbar">
										<div class="group">
											<button type="button" class="editor-btn ql-bold"><img src="../image/editer_bold.svg" alt=""></button>
											<button type="button" class="editor-btn ql-italic"><img src="../image/editer_italic.svg" alt=""></button>
											<button type="button" class="editor-btn ql-underline"><img src="../image/editer_underline.svg" alt=""></button>
											<button type="button" class="editor-btn ql-strike"><img src="../image/editer_strikethrough.svg" alt=""></button>
										</div>
										<div class="group">
											<select class="ql-size">
												<option value="" selected>Font</option>
												<option value="12px">12px</option>
												<option value="14px">14px</option>
												<option value="16px">16px</option>
												<option value="18px">18px</option>
												<option value="24px">24px</option>
											</select>
										</div>
										<div class="group">
											<button type="button" class="editor-btn ql-align" value=""><img src="../image/editer_left.svg" alt=""></button>
											<button type="button" class="editor-btn ql-align" value="center"><img src="../image/editer_center.svg" alt=""></button>
											<button type="button" class="editor-btn ql-align" value="right"><img src="../image/editer_right.svg" alt=""></button>
										</div>
										<div class="group">
											<button type="button" class="editor-btn ql-list" value="ordered"><img src="../image/editer_ordered.svg" alt=""></button>
											<button type="button" class="editor-btn ql-list" value="bullet"><img src="../image/editer_bullet.svg" alt=""></button>
										</div>
									</div>
									<div class="jweditor" id="commonTransEditor" data-placeholder="Enter transportation description"></div>
								</div>
							</div>
						</div>
					</div>
				</div>

				<h2 class="section-title jw-mgt32" id="section-fee-info" data-lan-eng="Fee information">Fee information</h2>
				<div class="card-panel jw-mgt16">
					<h3 class="grid-wrap-title" data-lan-eng="Number of people fee">Number of people fee</h3>
					<i class="line"></i>
					<button type="button" class="jw-button typeA" onclick="template_detail_sfg1(this)" data-lan-eng="＋ Add">＋ Add</button>
					<div class="tableA-scroll jw-mgt12">
						<table class="jw-tableA booking-detail">
							<colgroup>
								<col class="col-80"> <!-- No -->
								<col> <!--  -->
								<col class="col-300"> <!--   -->
								<col class="col-100"> <!--  -->
							</colgroup>
							<thead>
								<tr>
									<th>No</th>
									<th data-lan-eng="Option name">Option name</th>
									<th data-lan-eng="Number of people fee (₱)">Number of people fee (₱)</th>
									<th data-lan-eng="Delete">Delete</th>
								</tr>
							</thead>
							<tbody>
								<tr>
									<td class="is-center">1</td>
									<td class="is-center"><div class="cell"><input type="text" class="form-control" value="" placeholder="Option name"></div></td>
									<td class="is-center"><div class="cell"><input type="text" class="form-control" value="" inputmode="numeric" placeholder="Enter numbers"></div></td>
									<td class="is-center">
										<button type="button" class="btn w-auto" onclick="template_detail_sfg1d(this)" aria-label="row delete"><img src="../image/trash.svg" alt=""></button>
									</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
				<div class="card-panel jw-mgt16">
					<h3 class="grid-wrap-title" data-lan-eng="Room rate for single occupancy">Room rate for single occupancy</h3>
					<div class="grid-wrap jw-mgt16">
						<div class="grid-item col-span-3">
							<label class="label-name"><span data-lan-eng="Single room usage fee (₱)">Single room usage fee (₱)</span> <span class="req">*</span></label>
							<input type="text" class="form-control jw-w348" value="" inputmode="numeric" placeholder=" " data-lan-eng="Enter numbers">
							<p class="form-desc is-warning" data-lan-eng="* When booking for 2 or more people, you will be charged for the number of single rooms selected. For 1 person booking, it is applied for free.">* When booking for 2 or more people, you will be charged for the number of single rooms selected. For 1 person booking, it is applied for free.</p>
						</div>
					</div>
				</div>

				<h2 class="section-title jw-mgt32" data-section-name="poham" data-lan-eng="Included/Not Included Items">Included/Not Included Items</h2>
				<div class="card-panel jw-mgt16" data-section-name="poham">
					<h3 class="grid-wrap-title" data-lan-eng="Included items">Included items</h3>
					<i class="line"></i>
					<button type="button" class="jw-button typeA" data-lan-eng="＋ Add" onclick="template_detail_sfg3(this)">＋ Add</button>
					<div class="tableA-scroll jw-mgt20">
						<table class="jw-tableA booking-detail">
							<colgroup>
								<col class="col-80"> <!-- No -->
								<col> <!--   -->
								<col class="col-100"> <!--  -->
							</colgroup>
							<thead>
								<tr>
									<th>No</th>
									<th data-lan-eng="Included items">Included items</th>
									<th data-lan-eng="Delete">Delete</th>
								</tr>
							</thead>
							<tbody>
								<tr>
									<td class="is-center">1</td>
									<td class="is-center">
										<div class="cell">
											<input type="text" class="form-control" value="" placeholder="Please enter your content">
										</div>
									</td>
									<td class="is-center jw-center">
										<button type="button" class="jw-button" aria-label="row delete" onclick="trash_typeA(this);"><img src="../image/trash.svg" alt=""></button>
									</td>
								</tr>
								
							</tbody>
						</table>
					</div>
					</div>
				<div class="card-panel jw-mgt16" data-section-name="poham">
					<h3 class="grid-wrap-title" data-lan-eng="Excluded items">Excluded items</h3>
					<i class="line"></i>
					<button type="button" class="jw-button typeA" data-lan-eng="＋ Add" onclick="template_detail_sfg3(this)">＋ Add</button>

					<div class="tableA-scroll jw-mgt20">
						<table class="jw-tableA booking-detail">
							<colgroup>
								<col class="col-80"> <!-- No -->
								<col> <!--   -->
								<col class="col-100"> <!--  -->
							</colgroup>
							<thead>
								<tr>
									<th data-lan-eng="">No</th>
									<th data-lan-eng="Excluded items">Excluded items</th>
									<th data-lan-eng="Delete">Delete</th>
								</tr>
							</thead>
							<tbody>
								<tr>
									<td class="is-center">1</td>
									<td class="is-center">
										<div class="cell">
											<input type="text" class="form-control" value="" placeholder="Please enter your content">
										</div>
									</td>
									<td class="is-center jw-center"><button type="button" class="jw-button" aria-label="row delete" onclick="trash_typeA(this);"><img src="../image/trash.svg" alt=""></button>
									</td>
								</tr>
								
							</tbody>
						</table>
					</div>
				</div>


				<h2 class="section-title jw-mgt32" id="section-usage-guide" data-lan-eng="Usage Guide">Usage Guide</h2>
				<div class="card-panel jw-mgt16">
					<div class="grid-wrap jw-mgt0">
						<div class="grid-item col-span-3">
							<label class="label-name"><span data-lan-eng="Notice">Notice</span> <span class="req">*</span></label>
							<label class="inputFile">
								<input name="" type="file" onchange="noticeUploadChange(this)" >
								<button type="button" class="btn-upload"><img src="../image/upload3.svg" alt=""> File upload</button>
							</label>
									</div>
						<!-- SMT (#165): Product documents -->
						<div class="grid-item col-span-3">
							<label class="label-name"><span data-lan-eng="Flyer file">Flyer file</span></label>
							<label class="inputFile">
								<input id="flyerFileInput" type="file" accept=".pdf,.jpg,.jpeg,.png" onchange="noticeUploadChange(this)">
								<button type="button" class="btn-upload"><img src="../image/upload3.svg" alt=""> <span data-lan-eng="File upload">File upload</span></button>
							</label>
						</div>
						<div class="grid-item col-span-3">
							<label class="label-name"><span data-lan-eng="Itinerary file">Itinerary file</span></label>
							<label class="inputFile">
								<input id="itineraryFileInput" type="file" accept=".pdf" onchange="noticeUploadChange(this)">
								<button type="button" class="btn-upload"><img src="../image/upload3.svg" alt=""> <span data-lan-eng="File upload">File upload</span></button>
							</label>
						</div>
						<div class="grid-item col-span-3">
							<label class="label-name"><span data-lan-eng="Detail file">Detail file</span></label>
							<label class="inputFile">
								<input id="detailFileInput" type="file" accept=".pdf,.jpg,.jpeg,.png" onchange="noticeUploadChange(this)">
								<button type="button" class="btn-upload"><img src="../image/upload3.svg" alt=""> <span data-lan-eng="File upload">File upload</span></button>
							</label>
						</div>
						<!-- multi-editor.js -->
						<div class="grid-item col-span-3">
							<label class="label-name"><span data-lan-eng="Description">Description</span> <span class="req">*</span></label>
							<div class="editor-box-wrap">
							<div class="jw-editor">
								<div class="toolbar">
									<div class="group">
										<button type="button" class="editor-btn ql-bold"><img src="../image/editer_bold.svg" alt=""></button>
										<button type="button" class="editor-btn ql-italic"><img src="../image/editer_italic.svg" alt=""></button>
										<button type="button" class="editor-btn ql-underline"><img src="../image/editer_underline.svg" alt=""></button>
										<button type="button" class="editor-btn ql-strike"><img src="../image/editer_strikethrough.svg" alt=""></button>
										<button type="button" class="editor-btn font-color" onclick="setColor(this);">A</button>
										<button type="button" class="background-color" onclick="setColor(this, 2);"></button>
									</div>
									<div class="group">
										<select class="ql-size">
										  <option value="" selected>Font</option>
										  <option value="12px">12px</option>
										  <option value="14px">14px</option>
										  <option value="16px">16px</option>
										  <option value="18px">18px</option>
										  <option value="24px">24px</option>
										</select>
									</div>
									<div class="group">
										<button type="button" class="editor-btn ql-align" value=""><img src="../image/editer_left.svg" alt=""></button>
										<button type="button" class="editor-btn ql-align" value="center"><img src="../image/editer_center.svg" alt=""></button>
										<button type="button" class="editor-btn ql-align" value="right"><img src="../image/editer_right.svg" alt=""></button>
									</div>
									<div class="group">
										<button type="button" class="editor-btn ql-list" value="ordered"><img src="../image/editer_ordered.svg" alt=""></button>
										<button type="button" class="editor-btn ql-list" value="bullet"><img src="../image/editer_bullet.svg" alt=""></button>
									</div>
								</div>
								<div class="jweditor" data-placeholder=" "></div>
							</div>
							</div>
						</div>
					</div>
				</div>

				<h2 class="section-title jw-mgt32" id="section-refund-policy" data-lan-eng="Cancellation/Refund Policy">Cancellation/Refund Policy</h2>
				<div class="card-panel jw-mgt16">
					<div class="grid-wrap jw-mgt0">
						<div class="grid-item col-span-3">
							<label class="label-name"><span data-lan-eng="Full refund available standard date">Full refund available standard date</span> <span class="req">*</span></label>
							<input type="text" class="form-control jw-w348" value="" inputmode="numeric" placeholder="Enter numbers">
							<p class="form-desc is-warning" data-lan-eng="Cancel up to 1 day before for a full refund">Cancel up to 1 day before for a full refund</p>
						</div>
						<!-- multi-editor.js -->
						<div class="grid-item col-span-3">
							<label class="label-name"><span data-lan-eng="Description">Description</span> <span class="req">*</span></label>
							<div class="editor-box-wrap">
							<div class="jw-editor">
								<div class="toolbar">
									<div class="group">
										<button type="button" class="editor-btn ql-bold"><img src="../image/editer_bold.svg" alt=""></button>
										<button type="button" class="editor-btn ql-italic"><img src="../image/editer_italic.svg" alt=""></button>
										<button type="button" class="editor-btn ql-underline"><img src="../image/editer_underline.svg" alt=""></button>
										<button type="button" class="editor-btn ql-strike"><img src="../image/editer_strikethrough.svg" alt=""></button>
										<button type="button" class="editor-btn font-color" onclick="setColor(this);">A</button>
										<button type="button" class="background-color" onclick="setColor(this, 2);"></button>
									</div>
									<div class="group">
										<select class="ql-size">
										  <option value="" selected>Font</option>
										  <option value="12px">12px</option>
										  <option value="14px">14px</option>
										  <option value="16px">16px</option>
										  <option value="18px">18px</option>
										  <option value="24px">24px</option>
										</select>
									</div>
									<div class="group">
										<button type="button" class="editor-btn ql-align" value=""><img src="../image/editer_left.svg" alt=""></button>
										<button type="button" class="editor-btn ql-align" value="center"><img src="../image/editer_center.svg" alt=""></button>
										<button type="button" class="editor-btn ql-align" value="right"><img src="../image/editer_right.svg" alt=""></button>
									</div>
									<div class="group">
										<button type="button" class="editor-btn ql-list" value="ordered"><img src="../image/editer_ordered.svg" alt=""></button>
										<button type="button" class="editor-btn ql-list" value="bullet"><img src="../image/editer_bullet.svg" alt=""></button>
									</div>
								</div>
						
								<div class="jweditor" data-placeholder=" "></div>
							</div>
							</div>
						</div>
					</div>
				</div>


				<h2 class="section-title jw-mgt32" id="section-visa-guide" data-lan-eng="Visa Application Guide">Visa Application Guide</h2>
				<div class="card-panel jw-mgt16">
					<div class="grid-wrap jw-mgt0">
						<!-- multi-editor.js -->
						<div class="grid-item col-span-3">
							<label class="label-name"><span data-lan-eng="Description">Description</span> <span class="req">*</span></label>
							<div class="editor-box-wrap">
								<div class="jw-editor">
									<div class="toolbar">
										<div class="group">
											<button type="button" class="editor-btn ql-bold"><img src="../image/editer_bold.svg" alt=""></button>
											<button type="button" class="editor-btn ql-italic"><img src="../image/editer_italic.svg" alt=""></button>
											<button type="button" class="editor-btn ql-underline"><img src="../image/editer_underline.svg" alt=""></button>
											<button type="button" class="editor-btn ql-strike"><img src="../image/editer_strikethrough.svg" alt=""></button>
											<button type="button" class="editor-btn font-color" onclick="setColor(this);">A</button>
											<button type="button" class="background-color" onclick="setColor(this, 2);"></button>
										</div>
										<div class="group">
											<select class="ql-size">
											  <option value="" selected>Font</option>
											  <option value="12px">12px</option>
											  <option value="14px">14px</option>
											  <option value="16px">16px</option>
											  <option value="18px">18px</option>
											  <option value="24px">24px</option>
											</select>
										</div>
										<div class="group">
											<button type="button" class="editor-btn ql-align" value=""><img src="../image/editer_left.svg" alt=""></button>
											<button type="button" class="editor-btn ql-align" value="center"><img src="../image/editer_center.svg" alt=""></button>
											<button type="button" class="editor-btn ql-align" value="right"><img src="../image/editer_right.svg" alt=""></button>
										</div>
										<div class="group">
											<button type="button" class="editor-btn ql-list" value="ordered"><img src="../image/editer_ordered.svg" alt=""></button>
											<button type="button" class="editor-btn ql-list" value="bullet"><img src="../image/editer_bullet.svg" alt=""></button>
										</div>
									</div>
									<div class="jweditor" data-placeholder=" "></div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>

			<aside class="content-aside" aria-label=" ">
				<h3 class="aside-title" data-lan-eng="Components">Components</h3>
				<div class="card-panel jw-mgt16">
						<div class="grid-item">
							<div class="aside-list">
								<div class="aside-row">
									<div class="aside-row__title" data-scroll-target="section-product-info" onclick="scrollToSection('section-product-info')" style="cursor:pointer;" data-lan-eng="Product Information">Product Information</div>
									<span class="aside-row__req" data-lan-eng="Required">Required</span>
								</div>
								<hr class="aside-row__sep">
								<div class="aside-row">
									<div class="aside-row__title" data-scroll-target="flight-information" onclick="scrollToSection('flight-information')" style="cursor:pointer;" data-lan-eng="Flight Information">Flight Information</div>
									<button type="button" class="jw-button aside-add-section" data-target-section="flight-information" onclick="togglePlusMinus(this)"><img src="../image/minus.svg" alt="minus"></button>
								</div>
								<div class="aside-row">
									<div class="aside-row__title" data-scroll-target="section-sales-info" onclick="scrollToSection('section-sales-info')" style="cursor:pointer;" data-lan-eng="Sales Information">Sales Information</div>
									<span class="aside-row__req" data-lan-eng="Required">Required</span>
								</div>
								<div class="aside-sub">
									<div class="aside-row">
										<div class="aside-row__subtitle" data-scroll-target="section-sales-info" onclick="scrollToSection('section-sales-info')" style="cursor:pointer;" data-lan-eng="Basic Sales Information">Basic Sales Information</div>
										<span class="aside-row__req" data-lan-eng="Required">Required</span>
									</div>
									<div class="aside-row">
										<div class="aside-row__subtitle" data-scroll-target="iljastar" onclick="scrollToSection('iljastar')" style="cursor:pointer;" data-lan-eng="Daily Sales Adjustment">Daily Sales Adjustment</div>
										<button type="button" class="jw-button aside-add-section" data-target-section="iljastar" onclick="togglePlusMinus(this)"><img src="../image/minus.svg" alt="minus"></button>
									</div>
								</div>
								<div class="aside-row">
									<div class="aside-row__title" data-scroll-target="section-schedule" onclick="scrollToSection('section-schedule')" style="cursor:pointer;" data-lan-eng="Schedule">Schedule</div>
									<span class="aside-row__req" data-lan-eng="Required">Required</span>
								</div>
								<div class="aside-sub">
									<div class="aside-row">
										<div class="aside-row__title" data-scroll-target="section-meeting-info" onclick="scrollToSection('section-meeting-info')" style="cursor:pointer;" data-lan-eng="Meeting Information">Meeting Information</div>
										<span class="aside-row__req" data-lan-eng="Required">Required</span>
									</div>
									<div class="aside-row-list">
										<div class="aside-row">
											<div class="aside-row__subtitle" data-scroll-target="day-1" onclick="scrollToDayPanel(1)" style="cursor:pointer;" data-lan-eng="1st day">1st day</div>
											<span class="aside-row__req" data-lan-eng="Required">Required</span>
										</div>
									</div>
									<div class="aside-row">
										<button type="button" class="jw-button aside-button-typeA" onclick="template_detail_sdaf(this)"><img src="../image/plus.svg" alt=""> <span data-lan-eng="Add day">Add day</span></button>
									</div>
								</div>
								<hr class="aside-row__sep">
								<div class="aside-row">
									<div class="aside-row__title" data-scroll-target="section-common-settings" onclick="scrollToSection('section-common-settings')" style="cursor:pointer;" data-lan-eng="Common Settings">Common Settings</div>
									<span class="aside-row__req" data-lan-eng="Required">Required</span>
								</div>
								<hr class="aside-row__sep">
								<div class="aside-row">
									<div class="aside-row__title" data-scroll-target="section-fee-info" onclick="scrollToSection('section-fee-info')" style="cursor:pointer;" data-lan-eng="Fee information">Fee information</div>
									<span class="aside-row__req" data-lan-eng="Required">Required</span>
								</div>
								<hr>
								<div class="aside-row">
									<div class="aside-row__title" data-scroll-target="poham" onclick="scrollToSection('poham')" style="cursor:pointer;" data-lan-eng="Included/Not Included Items">Included/Not Included Items</div>
									<button type="button" class="jw-button aside-add-section" data-target-section="poham" onclick="togglePlusMinus(this)"><img src="../image/minus.svg" alt="minus"></button>
								</div>
								<hr>
								<div class="aside-row">
									<div class="aside-row__title" data-scroll-target="section-usage-guide" onclick="scrollToSection('section-usage-guide')" style="cursor:pointer;" data-lan-eng="Usage Guide">Usage Guide</div>
									<span class="aside-row__req" data-lan-eng="Required">Required</span>
								</div>
								<hr>
								<div class="aside-row">
									<div class="aside-row__title" data-scroll-target="section-refund-policy" onclick="scrollToSection('section-refund-policy')" style="cursor:pointer;" data-lan-eng="Cancellation/Refund Policy">Cancellation/Refund Policy</div>
									<span class="aside-row__req" data-lan-eng="Required">Required</span>
								</div>
								<hr>
								<div class="aside-row">
									<div class="aside-row__title" data-scroll-target="section-visa-guide" onclick="scrollToSection('section-visa-guide')" style="cursor:pointer;" data-lan-eng="Visa Application Guide">Visa Application Guide</div>
									<span class="aside-row__req" data-lan-eng="Required">Required</span>
								</div>

							</div>

						</div>
	
						<div class="temporary-guide" style="position:relative; margin-top:50px; ">
							<button type="button" class="jw-button" onclick="modal('product-detail_m1.html', '580px', '508px')"><strong>1</strong></button>
							<button type="button" class="jw-button" onclick="modal('template-detail-modal1.html', '600px', '252px')"><strong>2</strong></button>
							<button type="button" class="jw-button" onclick="modal('product-detail_m3.html', '600px', '252px')"><strong>3</strong></button>
						</div>
					
				</div>
			</aside>

		</section>

	</main>

	<!-- 하단 고정 액션 바 -->
	<div class="fixed-bottom-bar">
		<button type="button" class="jw-button typeA" id="tempSaveBtn" data-lan-eng="Temporary save">Temporary save</button>
		<button type="button" class="jw-button typeA" id="testFillBtn" data-lan-eng="Test fill">Test fill</button>
		<button type="button" class="jw-button typeB" id="saveBtn" data-lan-eng="Save" onclick="product_registration_save(this)">Save</button>
	</div>

	<style>
		.layout-main {
			padding-bottom: 60px !important;
		}
		.fixed-bottom-bar {
			position: fixed;
			bottom: 0;
			left: 0;
			right: 0;
			height: 60px;
			background: #fff;
			border-top: 1px solid #e0e0e0;
			display: flex;
			align-items: center;
			justify-content: flex-end;
			padding: 0 24px;
			gap: 16px;
			z-index: 100;
		}
	</style>

	<!--   -->
	<script src="../js/default.js"></script>
	<script src="../js/super.js?v=20251226_prfix2"></script>
	<script src="../js/datepicker.js"></script>
	<script src="../js/multi-editor.js"></script>

	<script>
		init({
			headerUrl: '../inc/header.html',
			navUrl: '../inc/nav_super.html'
		});

		//   (  /   )
		try {
			if (!window.__jw_nday_proto) window.__jw_nday_proto = document.getElementById('nday')?.cloneNode(true) || null;
			if (!window.__jw_dfghs_proto) window.__jw_dfghs_proto = document.querySelector('.dfghs')?.cloneNode(true) || null;
		} catch (_) { }

		// Super  admin   ( /  401  )
		document.addEventListener('DOMContentLoaded', async () => {
			// product categories meta preload
			try {
				// " "   : super-api.php?action=getCategories
				const r = await fetch('../backend/api/super-api.php?action=getCategories', { credentials: 'same-origin' });
				const j = await r.json().catch(() => ({}));
				if (j?.success && Array.isArray(j?.data?.categories)) {
					window.__productCategoryMeta = j.data.categories;
					// /  " "  
					try {
						const mainSel = document.getElementById('mainCategory');
						const subSel = document.getElementById('subCategory');
						if (mainSel && subSel) {
							const lang = (typeof getCookie === 'function' ? (getCookie('lang') || 'eng') : 'eng');
							//   " "  (name)  .
							// placeholder 
							mainSel.innerHTML = '';
							{
								const opt = document.createElement('option');
								opt.value = '';
								opt.textContent = 'Select main category';
								opt.setAttribute('data-lan-eng', 'Select main category');
								opt.setAttribute('data-lan-ko', ' ');
								opt.setAttribute('data-lan-tl', 'Select main category');
								mainSel.appendChild(opt);
							}
							(window.__productCategoryMeta || []).forEach((m) => {
								const code = String(m?.code || '').trim();
								if (!code) return;
								const name = String(m?.name || code).trim();
								const opt = document.createElement('option');
								opt.value = code; //  (backend season/region/theme   )
								opt.textContent = name;
								//      (  )
								opt.setAttribute('data-lan-eng', name);
								opt.setAttribute('data-lan-ko', name);
								opt.setAttribute('data-lan-tl', name);
								mainSel.appendChild(opt);
							});

							//      + placeholder
							subSel.disabled = true;
							subSel.innerHTML = '';
							{
								const opt = document.createElement('option');
								opt.value = '';
								opt.textContent = 'Please select a main category first';
								opt.setAttribute('data-lan-eng', 'Please select a main category first');
								opt.setAttribute('data-lan-ko', '   ');
								opt.setAttribute('data-lan-tl', 'Please select a main category first');
								subSel.appendChild(opt);
							}
							// jw_select UI  +  
							try { if (typeof language_apply === 'function') language_apply(lang); } catch (_) {}
							try { if (typeof jw_select === 'function') jw_select(); } catch (_) {}
						}
					} catch (_) {}
				}
			} catch (_) {}

			try {
				const r = await fetch('../backend/api/check-session.php', { credentials: 'include' });
				const j = await r.json().catch(() => ({}));
				const ok = j && j.authenticated && (j.userType === 'admin' || j.userType === 'super');
				if (!ok) {
					window.location.href = '../index.html';
				}
			} catch (_) {
				window.location.href = '../index.html';
			}

		});
	</script>

	<script>
		function escapeHtml(str) {
			return String(str ?? '').replace(/[&<>"']/g, (m) => ({
				'&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;'
			}[m]));
		}

		//   (    )
		function template_detail_sdaf_cate(scope) {
			const root = scope ? (scope instanceof Element ? scope : document.querySelector(scope)) : document;
			const cat1 = root.querySelector('[data-category="1"]');
			const sel2 = root.querySelector('select[data-category="2"]');
			if (!cat1 || !sel2) return;

			// product categories meta (DB): /backend/api/categories.php
			// - main: season/region/theme/private/daytrip
			// - sub: code/name
			const normalizeMainCode = (v) => {
				const s = String(v || '').trim();
				const map = {
					'': 'season', 'Seasonal': 'season', 'season': 'season',
					'': 'region', 'Regional': 'region', 'region': 'region',
					'': 'theme', 'Theme': 'theme', 'theme': 'theme',
					'': 'private', 'Private': 'private', 'private': 'private',
					'': 'daytrip', 'Daytrip': 'daytrip', 'daytrip': 'daytrip', 'oneday': 'daytrip'
				};
				return map[s] || s;
			};

			const tag = cat1.tagName;
			const type = (cat1.type || '').toLowerCase();
			let hasValue = false;

			if (type === 'radio') {
				if (cat1.name) {
					const area = cat1.form || root;
					hasValue = !!area.querySelector(`input[type="radio"][name="${CSS.escape(cat1.name)}"]:checked`);
						} else {
					hasValue = cat1.checked;
				}
			} else if (type === 'checkbox') {
				hasValue = cat1.checked;
			} else if (type === 'file') {
				hasValue = !!(cat1.files && cat1.files.length);
			} else if (tag === 'SELECT') {
				hasValue = (cat1.value ?? '') !== '';
						} else {
				hasValue = ((cat1.value || '').trim().length > 0);
			}

			if (!hasValue) sel2.setAttribute('disabled', '');
			else sel2.removeAttribute('disabled');

			//      DB  ( : gyeonggi     )
			try {
				if (hasValue && window.__productCategoryMeta && Array.isArray(window.__productCategoryMeta)) {
					const mainCode = normalizeMainCode(cat1.value);
					const main = window.__productCategoryMeta.find(m => String(m.code || '').trim() === mainCode);
					const subs = Array.isArray(main?.subCategories) ? main.subCategories : [];
					const current = String(sel2.value || '').trim();

					//    
					sel2.innerHTML = '';
					//  placeholder (  )
					if (!subs.length) {
						// fallback(       )
						['Spring', 'Summer', 'Autumn', 'Winter'].forEach((name) => {
							const opt = document.createElement('option');
							opt.value = name.toLowerCase();
							opt.textContent = name;
							sel2.appendChild(opt);
						});
					} else {
						subs.forEach((s) => {
							const opt = document.createElement('option');
							opt.value = String(s.code || '').trim();
							opt.textContent = String(s.name || s.code || '').trim();
							sel2.appendChild(opt);
						});
					}

					//   ()
					if (current) {
						const opt = Array.from(sel2.options).find(o => String(o.value || '').toLowerCase() === current.toLowerCase());
						if (opt) sel2.value = opt.value;
					}
					//       
					if (!String(sel2.value || '').trim() && sel2.options.length) sel2.selectedIndex = 0;

					// jw_select UI ()
					try { __resetSelectWidgets(sel2.closest('.grid-item') || root); } catch (_) {}
				}
			} catch (_) {}

			const wrap = sel2.closest('.jw-select');
			if (wrap) {
				wrap.classList.toggle('is-disabled', sel2.disabled);
				const btn = wrap.querySelector('.jw-selected');
				if (btn) {
					btn.setAttribute('aria-disabled', sel2.disabled ? 'true' : 'false');
					btn.tabIndex = sel2.disabled ? -1 : 0;
				}
			}
		}

		function ndasdtoggle(btn) {
			const el = btn?.closest?.('.card-panel[id^="nday"], .nday-panel') || document.getElementById('nday');
			if (!el) return false;
			el.classList.toggle('off');
			const isOff = el.classList.contains('off');

			// CSS card-panel.off      JS    
			try {
				Array.from(el.children || []).forEach((ch) => {
					if (!ch || !(ch instanceof Element)) return;
					if (ch.matches('h3.grid-wrap-title') || ch.matches('i.line')) {
						ch.style.display = '';
						return;
					}
					ch.style.display = isOff ? 'none' : '';
				});
			} catch (_) {}

			return isOff;
		}

		function __resetSelectWidgets(root) {
			if (!root) return;
			// cloneNode  jw-select    " " .
			// => jw-select   native select(.select)   jw_select()  .
			root.querySelectorAll('.jw-select').forEach(wrap => {
				const sel = wrap.querySelector('select');
				if (!sel) { wrap.remove(); return; }
				sel.classList.remove('jw-sr-only');
				sel.classList.add('select');
				wrap.parentNode?.insertBefore(sel, wrap);
				wrap.remove();
			});
			//        
			root.querySelectorAll('select.jw-sr-only').forEach(sel => {
				if (sel.closest('.jw-select')) return;
				sel.classList.remove('jw-sr-only');
				sel.classList.add('select');
			});
			if (typeof jw_select === 'function') jw_select();
		}

		function __resetEditors(root) {
			if (!root) return;
			//   Quill DOM        .
			root.querySelectorAll('.jweditor').forEach(ed => {
				ed.className = 'jweditor';
				ed.innerHTML = '';
			});
			if (typeof board === 'function') board();
		}

		//  ( Quill  )  DOM ""  .
		// => create   Quill    .
		function __clearEditorsContent(root) {
			if (!root) return;
			root.querySelectorAll('.jweditor').forEach(ed => {
				try {
					if (window.Quill && typeof Quill.find === 'function') {
						const q = Quill.find(ed);
						if (q) {
							q.setText('');
							return;
						}
					}
				} catch (_) {}
				// fallback: Quill DOM  ql-editor 
				try {
					const ql = ed.querySelector('.ql-editor');
					if (ql) {
						ql.innerHTML = '';
						ql.classList.add('ql-blank');
						return;
					}
				} catch (_) {}
				ed.innerHTML = '';
			});
		}

		function __resetInputs(root) {
			if (!root) return;
			root.querySelectorAll('input').forEach(inp => {
				const type = (inp.type || '').toLowerCase();
				if (type === 'file') {
					// IMPORTANT:
					// file input clone    , (img.preview) label     
					// "   "  . =>  UI  .
					try { inp.value = ''; } catch (_) {}
					try { delete inp.dataset.existing; } catch (_) {}
					try {
						const item = inp.closest('.upload-item');
						if (item) {
							item.classList.remove('is-filled', 'has-image');
							//  
							item.querySelectorAll('img.preview').forEach(n => n.remove());
							//   label/ 
							const lab = item.querySelector('label.inputFile');
							if (lab) lab.style.display = '';
							const btn = item.querySelector('.btn-upload');
							if (btn) btn.style.display = '';
							//   close  (   )
							item.querySelectorAll('button.btn-close').forEach(b => b.remove());
						}
					} catch (_) {}
					return;
				}
				// disabled input  (Please search...)   
				if (type === 'checkbox' || type === 'radio') { inp.checked = false; return; }
				if (type === 'hidden') return;
				inp.value = '';
			});
			root.querySelectorAll('textarea').forEach(t => { t.value = ''; });
			// SMT   - select  (   )
			root.querySelectorAll('select').forEach(sel => {
				//  select   (  )
				if (sel.id === 'mainCategory' || sel.id === 'subCategory' || sel.id === 'salesTarget') return;
				//    
				if (sel.options.length > 0) {
					sel.selectedIndex = 0;
				}
			});
			// SMT  
		}

		function template_detail_sdaf(btn) {
			const list = (btn.closest('.aside') || document).querySelector('.aside-row-list');
			if (!list) return;
			const day = list.querySelectorAll('.aside-row').length + 1;

			// 1)  ()
			const li = document.createElement('li');
			li.className = 'aside-row';
			li.innerHTML = `
				<div class="aside-row__subtitle" data-scroll-target="day-${day}" onclick="scrollToDayPanel(${day})" style="cursor:pointer;" data-lan-eng="Day ${day}">Day ${day}</div>
				<button type="button" class="jw-button aside-add-section" onclick="template_detail_sdaf_delete(this)"><img src="../image/minus.svg" alt=""></button>
			`;
			list.appendChild(li);

			// 2)   () 
			const base = document.getElementById('nday');
			if (base) {
				// base    1 
				base.dataset.day = base.dataset.day || '1';
				base.classList.add('nday-panel');

				//  ,   ( /   )
				const proto = window.__jw_nday_proto || null;
				const copy = (proto ? proto.cloneNode(true) : base.cloneNode(true));
				copy.removeAttribute('id');
				copy.dataset.day = String(day);
				copy.classList.add('nday-panel');
				//   
				const dayBtn = copy.querySelector('h3 button');
				if (dayBtn) {
					dayBtn.setAttribute('onclick', 'ndasdtoggle(this)');
					dayBtn.childNodes.forEach(n => { if (n.nodeType === Node.TEXT_NODE) n.textContent = `${day}Day `; });
					//     
					if (!dayBtn.textContent.includes('Day')) {
						dayBtn.innerHTML = `${day}Day <img src="../image/arrow42.svg" alt="">`;
					}
				}
				//  ( )
				__resetInputs(copy);

				//     (DOM   editor/select   )
				const panels = Array.from(base.parentNode.querySelectorAll('.nday-panel'));
				const last = panels[panels.length - 1] || base;
				last.parentNode.insertBefore(copy, last.nextSibling);

				// editor  DOM      Transportation/Accommodation   
				__resetEditors(copy);

				// select  UI (    select )
				__resetSelectWidgets(copy);
			}

			const lang = (typeof getCookie === 'function' ? (getCookie('lang') || 'eng') : 'eng');
			if (typeof language_apply === 'function') language_apply(lang);
		}

		function template_detail_sdaf_delete(btn) {
			const row = btn.closest('.aside-row');
			if (!row) return;
			const list = row.closest('.aside-row-list');
			//   day  (aside-row-list   , 1 )
			let dayNum = null;
			if (list) {
				const rows = Array.from(list.querySelectorAll('.aside-row'));
				const idx = rows.indexOf(row);
				if (idx >= 0) dayNum = idx + 1;
			}

			//   
			if (dayNum && dayNum > 1) {
				document.querySelector(`.nday-panel[data-day="${dayNum}"]`)?.remove();
			}

			row.remove();

			// aside  +
			if (list) {
				list.querySelectorAll('.aside-row').forEach((el, i) => {
					const n = i + 1;
					const sub = el.querySelector('.aside-row__subtitle');
					if (sub) {
						sub.setAttribute('data-lan-eng', `Day ${n}`);
						sub.setAttribute('data-scroll-target', `day-${n}`);
						sub.setAttribute('onclick', `scrollToDayPanel(${n})`);
						sub.style.cursor = 'pointer';
						sub.textContent = `Day ${n}`;
					}
				});
			}
			const panels = Array.from(document.querySelectorAll('.nday-panel'));
			panels.forEach((p, i) => {
				const n = i + 1;
				p.dataset.day = String(n);
				const dayBtn = p.querySelector('h3 button');
				if (dayBtn) {
					dayBtn.setAttribute('onclick', 'ndasdtoggle(this)');
					dayBtn.childNodes.forEach(node => { if (node.nodeType === Node.TEXT_NODE) node.textContent = `${n}Day `; });
					if (!dayBtn.textContent.includes('Day')) dayBtn.innerHTML = `${n}Day <img src="../image/arrow42.svg" alt="">`;
				}
			});
			const lang = (typeof getCookie === 'function' ? (getCookie('lang') || 'eng') : 'eng');
			if (typeof language_apply === 'function') language_apply(lang);
		}

		function template_detail_dfghs(btn) {
			const panel = btn.closest('.sub-panel');
			if (!panel) return;
			//  ,    (/   )
			const proto = window.__jw_dfghs_proto || null;
			const tpl = proto || panel.querySelector('.dfghs');
			if (!tpl) return;
			const copy = tpl.cloneNode(true);
			copy.removeAttribute('id');
			//    /   
			__resetInputs(copy);
			panel.appendChild(copy);
			// editor  DOM        
			__resetEditors(copy);
			// DOM   jw_select   select 
			__resetSelectWidgets(copy);
			try { copy.scrollIntoView({ block: 'start', behavior: 'smooth' }); } catch (_) {}
			return copy;
		}

		function template_detail_hsdfghsh(btn) {
			const box = btn.closest('.dfghs');
			if (!box) return false;
			box.remove();
			return true;
		}

		// 숙소 블록 추가
		let accommodationBlockCounter = 1;
		function addAccommodationBlock() {
			const container = document.getElementById('accommodationBlocksContainer');
			if (!container) return;

			accommodationBlockCounter++;
			const idx = accommodationBlockCounter;

			// 첫 번째 블록을 템플릿으로 복제
			const firstBlock = container.querySelector('.accommodation-block');
			if (!firstBlock) return;

			const newBlock = firstBlock.cloneNode(true);
			newBlock.dataset.accomIdx = String(idx);

			// 제목 업데이트
			const title = newBlock.querySelector('.accom-block-title');
			if (title) title.textContent = `Accommodation ${idx}`;

			// 삭제 버튼 표시
			const deleteBtn = newBlock.querySelector('button[onclick*="removeAccommodationBlock"]');
			if (deleteBtn) deleteBtn.style.display = '';

			// 입력값 초기화
			newBlock.querySelectorAll('input.form-control').forEach(inp => {
				inp.value = '';
				inp.removeAttribute('disabled');
			});

			// 에디터 초기화
			const editorEl = newBlock.querySelector('.accom-description');
			if (editorEl) {
				editorEl.innerHTML = '';
				editorEl.removeAttribute('data-quill-ready');
			}

			// 이미지 업로드 초기화
			const imageGrid = newBlock.querySelector('.accom-image-grid');
			if (imageGrid) {
				imageGrid.innerHTML = `
					<div class="upload-item jw-center">
						<label class="inputFile">
							<input type="file" accept="image/*" onchange="filePreview(this);">
							<button type="button" class="btn-upload"><img src="../image/upload3.svg" alt=""> <span data-lan-eng="Image upload">Image upload</span></button>
						</label>
					</div>
				`;
			}

			container.appendChild(newBlock);

			// 에디터 재초기화
			__resetEditors(newBlock);

			// 모든 블록의 삭제 버튼 가시성 업데이트
			updateAccommodationDeleteButtons();

			try { newBlock.scrollIntoView({ block: 'start', behavior: 'smooth' }); } catch (_) {}
		}

		// 숙소 블록 삭제
		function removeAccommodationBlock(btn) {
			const block = btn.closest('.accommodation-block');
			if (!block) return;

			const container = document.getElementById('accommodationBlocksContainer');
			const blocks = container?.querySelectorAll('.accommodation-block') || [];

			// 마지막 하나는 삭제 불가
			if (blocks.length <= 1) {
				alert('At least one accommodation block is required.');
				return;
			}

			if (!confirm('Are you sure you want to delete this accommodation?')) return;

			block.remove();
			updateAccommodationDeleteButtons();
			renumberAccommodationBlocks();
		}

		// 숙소 블록 삭제 버튼 가시성 업데이트
		function updateAccommodationDeleteButtons() {
			const container = document.getElementById('accommodationBlocksContainer');
			if (!container) return;
			const blocks = container.querySelectorAll('.accommodation-block');
			blocks.forEach((block, i) => {
				const deleteBtn = block.querySelector('button[onclick*="removeAccommodationBlock"]');
				if (deleteBtn) {
					// 블록이 1개면 삭제 버튼 숨김, 2개 이상이면 표시
					deleteBtn.style.display = blocks.length > 1 ? '' : 'none';
				}
			});
		}

		// 숙소 블록 번호 재정렬
		function renumberAccommodationBlocks() {
			const container = document.getElementById('accommodationBlocksContainer');
			if (!container) return;
			const blocks = container.querySelectorAll('.accommodation-block');
			blocks.forEach((block, i) => {
				const num = i + 1;
				block.dataset.accomIdx = String(num);
				const title = block.querySelector('.accom-block-title');
				if (title) title.textContent = `Accommodation ${num}`;
			});
			accommodationBlockCounter = blocks.length;
		}

		function template_detail_sfg1(btn) {
			const panel = btn.closest('.card-panel');
			const tbody = panel?.querySelector('tbody');
			if (!tbody) return;
			const rows = Array.from(tbody.querySelectorAll('tr'));
			const last = rows[rows.length - 1];
			if (!last) {
				// :     ""  
				const tr = document.createElement('tr');
				tr.innerHTML = `
					<td class="is-center">1</td>
					<td class="is-center"><div class="cell"><input type="text" class="form-control" value="" placeholder="Option name"></div></td>
					<td class="is-center"><div class="cell"><input type="text" class="form-control" value="" inputmode="numeric" placeholder="Enter numbers"></div></td>
					<td class="is-center jw-center">
						<button type="button" class="btn w-auto" onclick="template_detail_sfg1d(this)" aria-label="row delete"><img src="../image/trash.svg" alt=""></button>
					</td>
				`;
				tbody.appendChild(tr);
				return;
			}
			const clone = last.cloneNode(true);
			clone.querySelectorAll('input,textarea,select').forEach(el => { el.value = ''; });
			tbody.appendChild(clone);
			Array.from(tbody.querySelectorAll('tr')).forEach((tr, i) => {
				const td = tr.querySelector('td');
				if (td) td.textContent = String(i + 1);
			});
		}

		function template_detail_sfg1d(btn) {
			const tr = btn.closest('tr');
			const tbody = tr?.closest('tbody');
			if (!tr || !tbody) return;
			// :        " 1 "
			const rows = Array.from(tbody.querySelectorAll('tr'));
			if (rows.length <= 1) {
				//  1    
				tr.querySelectorAll('input,textarea,select').forEach(el => { try { el.value = ''; } catch (_) {} });
				return;
			}
			tr.remove();
			Array.from(tbody.querySelectorAll('tr')).forEach((r, i) => {
				const td = r.querySelector('td');
				if (td) td.textContent = String(i + 1);
			});
		}

		function template_detail_sfg3(btn) {
			const panel = btn.closest('.card-panel');
			const tbody = panel?.querySelector('tbody');
			if (!tbody) return;
			const rows = Array.from(tbody.querySelectorAll('tr'));
			const last = rows[rows.length - 1];
			if (!last) return;
			const clone = last.cloneNode(true);
			clone.querySelectorAll('input,textarea,select').forEach(el => { el.value = ''; });
			tbody.appendChild(clone);
			Array.from(tbody.querySelectorAll('tr')).forEach((tr, i) => {
				const td = tr.querySelector('td');
				if (td) td.textContent = String(i + 1);
			});
		}

		function noticeUploadChange(_input) {
			// UI  (     )
			try {
				const input = _input;
				if (!input) return;
				const label = input.closest('label.inputFile');
				if (!label) return;
				const btn = label.querySelector('button.btn-upload');
				if (!btn) return;

				const fileName = input?.files?.[0]?.name
					|| input.dataset?.existingName
					|| input.dataset?.existing
					|| '';

				//   ( )
				const img = btn.querySelector('img');
				btn.textContent = fileName ? `File: ${fileName}` : 'File upload';
				if (img) {
					btn.prepend(img);
					btn.insertAdjacentText('afterbegin', ' ');
				}
			} catch (e) {
				console.warn('noticeUploadChange failed:', e);
			}
		}

		function getEditorPlainText() {
			const editor = document.getElementById('productDescriptionEditor');
			if (!editor) return '';
			const ql = editor.querySelector('.ql-editor');
			return (ql ? ql.innerText : editor.innerText || '').trim();
		}

		function collectPreviewData() {
			// NOTE:  (ko/en)    data-lan-eng  .
			const getEditorHtml = (ed) => {
				if (!ed) return '';
				const ql = ed.querySelector('.ql-editor');
				return String(ql ? ql.innerHTML : ed.innerHTML || '').trim();
			};
			const normalizeAssetSrc = (srcOrName, kind = 'products') => {
				const s = String(srcOrName || '').trim();
				if (!s) return '';
				if (/^https?:\/\//i.test(s) || s.startsWith('/')) return s;
				if (kind === 'usage_guides') return `/uploads/usage_guides/${encodeURIComponent(s)}`;
				return `/uploads/products/${encodeURIComponent(s)}`;
			};
			const getUploadSrc = (root, kind = 'products') => {
				// 1) 먼저 input[type="file"]에 선택된 파일이 있으면 새 blob URL 생성 (revoke 문제 방지)
				const fileInput = root?.querySelector?.('input[type="file"]');
				if (fileInput?.files?.[0]) {
					try { return URL.createObjectURL(fileInput.files[0]); } catch (_) {}
				}
				// 2) 파일이 없으면 기존 이미지 src 확인 (서버에서 로드된 이미지)
				const img = root?.querySelector?.('.upload-item.is-filled img.preview, .upload-item.is-filled img');
				const src = String(img?.getAttribute?.('src') || '').trim();
				// blob URL은 이미 revoke되었을 수 있으므로 무시
				if (src && !src.startsWith('blob:')) return src;
				// 3) dataset.existing 확인
				const existing = String(fileInput?.dataset?.existing || '').trim();
				return normalizeAssetSrc(existing, kind);
			};
			const getUploadSrcs = (root, limit = 5, kind = 'products') => {
				// 각 upload-item에서 파일 또는 기존 이미지 URL을 수집 (revoke된 blob URL 문제 방지)
				const uploadItems = Array.from(root?.querySelectorAll?.('.upload-item') || []).slice(0, limit);
				const out = [];
				uploadItems.forEach((item) => {
					const inp = item.querySelector('input[type="file"]');
					// 1) 파일이 선택되어 있으면 새 blob URL 생성
					if (inp?.files?.[0]) {
						try { out.push(URL.createObjectURL(inp.files[0])); } catch (_) {}
						return;
					}
					// 2) 기존 이미지 (서버에서 로드된)가 있으면 사용 (blob: 제외)
					const img = item.querySelector('img.preview, img');
					const src = String(img?.getAttribute?.('src') || '').trim();
					if (src && !src.startsWith('blob:')) {
						out.push(src);
						return;
					}
					// 3) dataset.existing 확인
					const ex = String(inp?.dataset?.existing || '').trim();
					if (ex) out.push(normalizeAssetSrc(ex, kind));
				});
				return out.slice(0, limit);
			};

			const findGridItemByLan = (eng) => {
				const sel = `.grid-item .label-name[data-lan-eng="${CSS.escape(eng)}"], .grid-item .label-name [data-lan-eng="${CSS.escape(eng)}"]`;
				const el = document.querySelector(sel);
				return el ? el.closest('.grid-item') : null;
			};

			const getSelectedText = (sel) => {
				if (!sel) return '';
				const opt = sel.options?.[sel.selectedIndex];
				return String(opt?.textContent || sel.value || '').trim();
			};
			const readFlightPanel = (kind) => {
				const panels = Array.from(document.querySelectorAll('[data-section-name="flight-information"].card-panel'));
				const panel = panels.find(p => {
					const h3 = p.querySelector('h3.grid-wrap-title');
					const eng = String(h3?.getAttribute?.('data-lan-eng') || '').trim();
					const text = String(h3?.textContent || '').trim();
					if (kind === 'departure') return eng === 'Departure flight' || /departure/i.test(text);
					return eng === 'Return trip' || /return/i.test(text);
				});
				if (!panel) return {};
				// inputs: [0]=Flight number, [1]=Departure point, [2]=Destination
				const inputs = Array.from(panel.querySelectorAll('input.form-control'));
				// Airline은 별도 select (.airline-select)
				const airlineName = String(panel.querySelector('.airline-select')?.value || '').trim();
				// NOTE:    select   00  .
				const selects = Array.from(panel.querySelectorAll('.meeting-wrap select'));
				const pad2 = (v) => String(v ?? '').padStart(2, '0');
				const flightNo = String(inputs[0]?.value || '').trim();
				const dep = `${pad2(selects[0]?.value || '00')}:${pad2(selects[1]?.value || '00')}`;
				const arr = `${pad2(selects[2]?.value || '00')}:${pad2(selects[3]?.value || '00')}`;
				return {
					flightNo,
					airlineName,
					departTime: dep,
					arriveTime: arr,
					from: String(inputs[1]?.value || '').trim(),
					to: String(inputs[2]?.value || '').trim()
				};
			};
			const readSalesPanel = () => {
				const panel = Array.from(document.querySelectorAll('.card-panel'))
					.find(p => p.querySelector('.grid-wrap-title[data-lan-eng="Basic Sales Information"]'));
				const salesPeriod = String(document.getElementById('contract-period')?.value || '').trim();
				if (!panel) return { period: salesPeriod };
				const findValByLabelEng = (labelEng) => {
					const span = panel.querySelector(`.label-name [data-lan-eng="${CSS.escape(labelEng)}"]`);
					const grid = span ? span.closest('.grid-item') : null;
					const input = grid?.querySelector('input.form-control');
					return String(input?.value || '').trim();
				};
				return {
					period: salesPeriod,
					minParticipants: findValByLabelEng('Minimum departure headcount'),
					maxParticipants: findValByLabelEng('Maximum capacity'),
					baseFlightFare: findValByLabelEng('Basic Airfare (₱)')
				};
			};
			const readDailySalesAdjustment = () => {
				const panel = document.querySelector('[data-section-name="iljastar"]');
				if (!panel) return [];
				return Array.from(panel.querySelectorAll('tbody tr')).map((tr) => {
					const tds = Array.from(tr.querySelectorAll('td'));
					const inputs = Array.from(tr.querySelectorAll('input.form-control'));
					return {
						date: String(tds[1]?.textContent || '').trim(),
						capacity: String(inputs[0]?.value || '').trim(),
						fee: String(inputs[1]?.value || '').trim()
					};
				}).filter(r => r.date);
			};

			// 
			const thumbItem = findGridItemByLan('Thumbnail image');
			const prodItem = findGridItemByLan('Product image');
			const detailItem = findGridItemByLan('Detailed introduction image');

			// (/)
			const schedulePanel = Array.from(document.querySelectorAll('.card-panel'))
				.find(p => p.querySelector('h3.grid-wrap-title[data-lan-eng="Meeting Information"]'));
			const meetingSelects = Array.from(schedulePanel?.querySelectorAll('select') || []);
			const meetingInputs = Array.from(schedulePanel?.querySelectorAll('input.form-control') || []);
			const meeting = {
				time: `${String(meetingSelects[0]?.value || '00').padStart(2, '0')}:${String(meetingSelects[1]?.value || '00').padStart(2, '0')}`,
				place: String(meetingInputs[0]?.value || '').trim(),
				address: String(meetingInputs[1]?.value || '').trim()
			};
			const dayPanels = Array.from(document.querySelectorAll('.nday-panel'));
			const panelsToUse = dayPanels.length ? dayPanels : [document.getElementById('nday')].filter(Boolean);
			const days = panelsToUse.map((p, idx) => {
				const dayNum = idx + 1;
				const summary = String(p.querySelector('input.form-control[placeholder="Schedule Summary"]')?.value || '').trim();

				const attractions = Array.from(p.querySelectorAll('.dfghs')).map((block) => {
					const inputs = Array.from(block.querySelectorAll('input.form-control'));
					const infoEd = block.querySelector('.jweditor');
					return {
						name: String(inputs[0]?.value || '').trim(),
						address: String(inputs[1]?.value || '').trim(),
						infoHtml: getEditorHtml(infoEd),
						imageSrc: getUploadSrc(block)
					};
				}).filter(a => a.name || a.address || a.infoHtml || a.imageSrc);

				const accomPanel = Array.from(p.querySelectorAll('.sub-panel'))
					.find(sp => sp.querySelector('[data-lan-eng="Accommodation Information"]'));
				const accomInputs = Array.from(accomPanel?.querySelectorAll('input.form-control') || []);
				const accomEd = accomPanel?.querySelector('.jweditor');
				const accommodation = {
					name: String(accomInputs[0]?.value || '').trim(),
					address: String(accomInputs[1]?.value || '').trim(),
					descriptionHtml: getEditorHtml(accomEd),
					imageSrc: getUploadSrc(accomPanel, 'products')
				};

				const transPanel = Array.from(p.querySelectorAll('.sub-panel'))
					.find(sp => sp.querySelector('[data-lan-eng="Transportation Information"]'));
				const transEd = transPanel?.querySelector('.jweditor');
				const transportation = { descriptionHtml: getEditorHtml(transEd) };

				const mealPanel = Array.from(p.querySelectorAll('.sub-panel'))
					.find(sp => sp.querySelector('[data-lan-eng="Meal Information"]'));
				const mealInputs = Array.from(mealPanel?.querySelectorAll('input.form-control') || []);
				const meals = {
					breakfast: String(mealInputs[0]?.value || '').trim(),
					lunch: String(mealInputs[1]?.value || '').trim(),
					dinner: String(mealInputs[2]?.value || '').trim()
				};

				return { day: dayNum, summary, attractions, accommodation, transportation, meals };
			});

			// /
			const pricing = (function () {
				const feePanel = Array.from(document.querySelectorAll('.card-panel'))
					.find(p => p.querySelector('.grid-wrap-title[data-lan-eng="Number of people fee"]'));
				const rows = Array.from(feePanel?.querySelectorAll('tbody tr') || []);
				const perPerson = rows.map((tr) => {
					const inputs = Array.from(tr.querySelectorAll('input.form-control'));
					return { optionName: String(inputs[0]?.value || '').trim(), price: String(inputs[1]?.value || '').trim() };
				}).filter(r => r.optionName || r.price);
				const singlePanel = Array.from(document.querySelectorAll('.card-panel'))
					.find(p => p.querySelector('.grid-wrap-title[data-lan-eng="Room rate for single occupancy"]'));
				const singleRoomFee = String(singlePanel?.querySelector('input.form-control')?.value || '').trim();
				return { perPerson, singleRoomFee };
			})();
			const included = (function () {
				const panel = Array.from(document.querySelectorAll('.card-panel'))
					.find(p => p.querySelector('.grid-wrap-title[data-lan-eng="Included items"]'));
				const inputs = Array.from(panel?.querySelectorAll('tbody input.form-control') || []);
				return inputs.map(i => String(i.value || '').trim()).filter(Boolean);
			})();
			const excluded = (function () {
				const panel = Array.from(document.querySelectorAll('.card-panel'))
					.find(p => p.querySelector('.grid-wrap-title[data-lan-eng="Excluded items"]'));
				const inputs = Array.from(panel?.querySelectorAll('tbody input.form-control') || []);
				return inputs.map(i => String(i.value || '').trim()).filter(Boolean);
			})();

			// //
			const sectionPanelByLan = (lan) => {
				const h2 = document.querySelector(`h2.section-title[data-lan-eng="${CSS.escape(lan)}"]`);
				return h2?.nextElementSibling || null;
			};
			const usagePanel = sectionPanelByLan('Usage Guide');
			const cancelPanel = sectionPanelByLan('Cancellation/Refund Policy');
			const visaPanel = sectionPanelByLan('Visa Application Guide');
			const usageEd = Array.from(usagePanel?.querySelectorAll('.jweditor') || []).pop() || null;
			const cancelEd = Array.from(cancelPanel?.querySelectorAll('.jweditor') || []).pop() || null;
			const visaEd = Array.from(visaPanel?.querySelectorAll('.jweditor') || []).pop() || null;
			const usageFileInput = usagePanel?.querySelector('input[type="file"]') || null;

			//   value( )  "   " 
			const mainSel = document.getElementById('mainCategory');
			const subSel = document.getElementById('subCategory');

			return {
				productName: document.getElementById('productName')?.value || '',
				targetMarket: document.getElementById('salesTarget')?.value || '',
				mainCategory: getSelectedText(mainSel),
				subCategory: getSelectedText(subSel),
				descriptionHtml: getEditorHtml(document.getElementById('productDescriptionEditor')),
				thumbnailSrc: (function () {
					const inp = thumbItem?.querySelector('input[type="file"]');
					if (inp?.files?.[0]) { try { return URL.createObjectURL(inp.files[0]); } catch (_) {} }
					return getUploadSrc(thumbItem, 'products');
				})(),
				productImageSrcs: getUploadSrcs(prodItem, 5, 'products'),
				detailImageSrc: (function () {
					const inp = detailItem?.querySelector('input[type="file"]');
					if (inp?.files?.[0]) { try { return URL.createObjectURL(inp.files[0]); } catch (_) {} }
					return getUploadSrc(detailItem, 'products');
				})(),
				flight: { departure: readFlightPanel('departure'), return: readFlightPanel('return') },
				sales: readSalesPanel(),
				dailySalesAdjustment: readDailySalesAdjustment(),
				meeting,
				days,
				pricing,
				included,
				excluded,
				usageGuide: {
					fileName: String(usageFileInput?.files?.[0]?.name || usageFileInput?.dataset?.existingName || usageFileInput?.dataset?.existing || '').trim(),
					descriptionHtml: getEditorHtml(usageEd)
				},
				cancellationPolicy: {
					descriptionHtml: getEditorHtml(cancelEd)
				},
				visaGuide: {
					descriptionHtml: getEditorHtml(visaEd)
				}
			};
		}

		async function saveFromPreviewToDb(options = {}) {
			// NOTE:
			//  (`user/product-detail.php`) packages + package_flights + package_schedules + package_usage_guide  .
			//  packages.php   /  " "  .
			// =>   1:1  `backend/api/product-register.php` multipart/form-data .

			// IMPORTANT:
			// -  UI (ko/en)    .
			// - textContent.includes(...)      .
			const mapMain = { '': 'season', '': 'region', '': 'theme', '': 'private', '': 'daytrip' };
			const normalizeMainCategory = (raw) => {
				const v = String(raw || '').trim();
				if (!v) return '';
				if (v === 'season' || v === 'region' || v === 'theme' || v === 'private' || v === 'daytrip') return v;
				if (v === 'oneday') return 'daytrip';
				// 한글 매핑 확인, 없으면 원래 값 그대로 반환 (US 등 커스텀 카테고리 지원)
				return mapMain[v] || v;
			};
			const normalizeSubCategory = (raw) => {
				const v = String(raw || '').trim();
				if (!v) return '';
				return v.toLowerCase().replace(/\s+/g, '');
			};
			const getEditorHtml = (ed) => {
				if (!ed) return '';
				try {
					// Quill  ql-editor HTML  
					const ql = ed.querySelector?.('.ql-editor');
					if (ql) return String(ql.innerHTML || '').trim();
				} catch (_) { }
				return String(ed.innerHTML || '').trim();
			};
			const findGridItemByLan = (eng) => {
				try {
					const span = document.querySelector(`.label-name [data-lan-eng="${CSS.escape(eng)}"]`);
					if (span) return span.closest('.grid-item');
				} catch (_) { }
				// label  data-lan-eng  (  )
				try {
					const label = document.querySelector(`.label-name[data-lan-eng="${CSS.escape(eng)}"]`);
					if (label) return label.closest('.grid-item');
				} catch (_) { }
				return null;
			};
			const findCardByH3Lan = (lanEng, fallbackKoRe = null) => {
				const cards = Array.from(document.querySelectorAll('.card-panel'));
				let found = cards.find(p => p.querySelector(`h3.grid-wrap-title[data-lan-eng="${CSS.escape(lanEng)}"]`));
				if (found) return found;
				// fallback: data-lan-eng   / 
				if (fallbackKoRe instanceof RegExp) {
					found = cards.find(p => {
						const h3 = p.querySelector('h3.grid-wrap-title');
						const t = String(h3?.textContent || '').trim();
						return fallbackKoRe.test(t);
					});
				}
				return found || null;
			};
			const findPanelByLanH2 = (lanEng, fallbackKoRe = null) => {
				let h2 = null;
				try { h2 = document.querySelector(`h2.section-title[data-lan-eng="${CSS.escape(lanEng)}"]`); } catch (_) { h2 = null; }
				if (!h2 && fallbackKoRe instanceof RegExp) {
					h2 = Array.from(document.querySelectorAll('h2.section-title')).find(el => fallbackKoRe.test(String(el.textContent || '').trim())) || null;
				}
				return h2?.nextElementSibling || null;
			};
			const getExistingFilenameFromRoot = (root) => {
				// 1) input dataset.existing
				const inp = root?.querySelector?.('input[type="file"]') || null;
				const ds = inp?.dataset || {};
				if (ds.existing) return String(ds.existing).trim();
				// 2) filled preview img src -> basename
				const img = root?.querySelector?.('.upload-item.is-filled img.preview, .upload-item.is-filled img') || null;
				const src = String(img?.getAttribute?.('src') || '').trim();
				if (!src) return '';
				try {
					const u = new URL(src, window.location.href);
					return u.pathname.split('/').pop() || '';
				} catch (_) {
					return src.split('?')[0].split('#')[0].split('/').pop() || '';
				}
			};

			const saveMode = String(options?.saveMode || 'active').trim().toLowerCase();
			const isTemporarySave = saveMode === 'temporary' || saveMode === 'temp' || saveMode === 'draft';

			const packageName = String(document.getElementById('productName')?.value || '').trim();
			if (!packageName) throw new Error(' .');

			const salesTarget = String(document.getElementById('salesTarget')?.value || '').trim() || 'B2B';
			const mainCategory = normalizeMainCategory(document.getElementById('mainCategory')?.value) || (isTemporarySave ? 'season' : '');
			const subCategory = normalizeSubCategory(document.getElementById('subCategory')?.value) || (isTemporarySave ? '' : '');
			if (!isTemporarySave && (!mainCategory || !subCategory)) {
				throw new Error('카테고리를 선택해주세요.');
			}

			const descHtml = getEditorHtml(document.getElementById('productDescriptionEditor'));
			if (!isTemporarySave) {
				if (!descHtml || descHtml === '<p><br></p>') throw new Error('  : productDescription');
			}

			const fd = new FormData();
			const currentId = Number(new URLSearchParams(window.location.search).get('id') || 0);
			if (currentId > 0) fd.append('packageId', String(currentId));

			fd.append('productName', packageName);
			fd.append('salesTarget', salesTarget);
			fd.append('mainCategory', mainCategory);
			fd.append('subCategory', subCategory);
			//  description  ( OK)
			if (descHtml) fd.append('productDescription', descHtml);
			fd.append('saveMode', isTemporarySave ? 'temporary' : 'active');

			//  ( range )
			const salesPeriod = String(document.getElementById('contract-period')?.value || '').trim();
			if (salesPeriod) fd.append('salesPeriod', salesPeriod);

			// /
			const minP = String(document.getElementById('minParticipants')?.value || '').trim();
			const maxP = String(document.getElementById('maxParticipants')?.value || '').trim();
			const basePrice = String(document.getElementById('baseFlightFare')?.value || '').trim();
			if (minP) fd.append('minParticipants', minP);
			if (maxP) fd.append('maxParticipants', maxP);
			if (basePrice) fd.append('basePrice', basePrice);
			// packages.packagePrice( 1 ) " "   .
			// ( (basePrice) base_price  )
			(function () {
				const feePanel =
					document.querySelector('.card-panel .grid-wrap-title[data-lan-eng="Number of people fee"]')?.closest('.card-panel') ||
					Array.from(document.querySelectorAll('.card-panel')).find(p => (p.querySelector('.grid-wrap-title')?.textContent || '').includes(' '));
				if (!feePanel) {
					//  :      
					if (basePrice) fd.append('adultPrice', basePrice);
					return;
				}
				const rows = Array.from(feePanel.querySelectorAll('tbody tr'));
				let adult = null, child = null, infant = null;
				rows.forEach((tr) => {
					const inputs = Array.from(tr.querySelectorAll('input.form-control'));
					const name = String(inputs[0]?.value || '').toLowerCase().trim();
					const price = String(inputs[1]?.value || '').trim().replace(/[^0-9.]/g, '');
					if (!name || price === '') return;
					const p = parseFloat(price);
					if (!Number.isFinite(p)) return;
					if (name.includes('adult') || name.includes('')) adult = p;
					else if (name.includes('child') || name.includes('')) child = p;
					else if (name.includes('infant') || name.includes('')) infant = p;
				});
				if (adult !== null) fd.append('adultPrice', String(adult));
				else if (basePrice) fd.append('adultPrice', basePrice);
				if (child !== null) fd.append('childPrice', String(child));
				if (infant !== null) fd.append('infantPrice', String(infant));
			})();

			//  (/)
			(function () {
				const schedulePanel = findCardByH3Lan('Meeting Information', /\s*/i);
				if (!schedulePanel) return;
				const selects = Array.from(schedulePanel.querySelectorAll('.meeting-wrap select, select'));
				//    meeting-wrap 2 select
				const hour = selects[0]?.value ?? '00';
				const minute = selects[1]?.value ?? '00';
				fd.append('meetingHour', hour);
				fd.append('meetingMinute', minute);
				const inputs = Array.from(schedulePanel.querySelectorAll('input.form-control'));
				// SMT: do not overwrite meeting location/address with disabled placeholder values
				const v0 = String(inputs[0]?.value || '').trim();
				const v1 = String(inputs[1]?.value || '').trim();
				if (inputs[0] && !inputs[0].disabled && v0 && !/^please search/i.test(v0)) fd.append('meetingLocation', v0);
				if (inputs[1] && !inputs[1].disabled && v1 && !/^please search/i.test(v1)) fd.append('meetingAddress', v1);
			})();

			// / ( input  )
			const buildLinesFromTableByLan = (lanEng, fallbackKoRe = null) => {
				const panel = findCardByH3Lan(lanEng, fallbackKoRe);
				if (!panel) return '';
				const inputs = Array.from(panel.querySelectorAll('tbody input.form-control, tbody textarea.form-control, tbody input[type="text"]'));
				return inputs.map(i => String(i.value || '').trim()).filter(Boolean).join('\n');
			};
			const includedItems = buildLinesFromTableByLan('Included items', /\s*/i);
			const excludedItems = buildLinesFromTableByLan('Excluded items', /\s*/i);
			if (includedItems) fd.append('included_items', includedItems);
			if (excludedItems) fd.append('excluded_items', excludedItems);

			// (/) -  DOM
			const readFlightPanel = (kind) => {
				const panels = Array.from(document.querySelectorAll('[data-section-name="flight-information"].card-panel'));
				const panel = panels.find(p => {
					const h3 = p.querySelector('h3.grid-wrap-title');
					const eng = String(h3?.getAttribute?.('data-lan-eng') || '').trim();
					const txt = String(h3?.textContent || '').trim();
					if (kind === 'departure') return eng === 'Departure flight' || /departure/i.test(txt);
					return eng === 'Return trip' || /return/i.test(txt);
				});
				if (!panel) return null;
				// NOTE: flight panel  / select     select
				const selects = Array.from(panel.querySelectorAll('.meeting-wrap select'));
				// : selects[0]=hour, [1]=min / : [2]=hour, [3]=min
				const depH = String(selects[0]?.value || '00').padStart(2, '0');
				const depM = String(selects[1]?.value || '00').padStart(2, '0');
				const arrH = String(selects[2]?.value || '00').padStart(2, '0');
				const arrM = String(selects[3]?.value || '00').padStart(2, '0');
				// Airline은 별도 select (.airline-select)
				const airlineName = String(panel.querySelector('.airline-select')?.value || '').trim();
				// textInputs: [0]=Flight number, [1]=Departure point, [2]=Destination
				const textInputs = Array.from(panel.querySelectorAll('input.form-control'));
				const flightNumber = String(textInputs[0]?.value || '').trim();
				const depPoint = String(textInputs[1]?.value || '').trim();
				const dest = String(textInputs[2]?.value || '').trim();
				return { flightNumber, airlineName, depH, depM, arrH, arrM, depPoint, dest };
			};
			const dep = readFlightPanel('departure');
			const ret = readFlightPanel('return');
			// flight  "  "  DB         .
			if ((dep || ret) && !String(dep?.flightNumber || '').trim() && !String(ret?.flightNumber || '').trim()) {
				fd.append('clearFlights', '1');
			}
			if (dep && dep.flightNumber) {
				fd.append('departureFlightNumber', dep.flightNumber);
				fd.append('departureFlightAirline', dep.airlineName);
				fd.append('departureFlightDepartureHour', dep.depH);
				fd.append('departureFlightDepartureMinute', dep.depM);
				fd.append('departureFlightArrivalHour', dep.arrH);
				fd.append('departureFlightArrivalMinute', dep.arrM);
				fd.append('departureFlightDeparturePoint', dep.depPoint);
				fd.append('departureFlightDestination', dep.dest);
			}
			if (ret && ret.flightNumber) {
				fd.append('returnFlightNumber', ret.flightNumber);
				fd.append('returnFlightAirline', ret.airlineName);
				fd.append('returnFlightDepartureHour', ret.depH);
				fd.append('returnFlightDepartureMinute', ret.depM);
				fd.append('returnFlightArrivalHour', ret.arrH);
				fd.append('returnFlightArrivalMinute', ret.arrM);
				fd.append('returnFlightDeparturePoint', ret.depPoint);
				fd.append('returnFlightDestination', ret.dest);
			}

			// :  () +  // "" 
			const dayPanels = Array.from(document.querySelectorAll('.nday-panel')) || [];
			const panelsToUse = dayPanels.length ? dayPanels : [document.getElementById('nday')].filter(Boolean);

			// /:   file       
			const __uploadDebug = { attractions: [], accommodations: [], airports: [] };
			const __missingUploads = [];

			let attractionIdx = 0;
			const attractions = [];

			panelsToUse.forEach((p, idx) => {
				const dayNum = idx + 1;

				//  
				const summary = String(p.querySelector('input.form-control[placeholder="Schedule Summary"]')?.value || '').trim();
				fd.append(`day${dayNum}_description`, summary);

				// (): dfghs   1 
				const attractionBlocks = Array.from(p.querySelectorAll('.dfghs'));
				attractionBlocks.forEach((block, bIdx) => {
					//   select ( toolbar  select    )
					const selects = Array.from(block.querySelectorAll('.meeting-wrap select'));
					const textInputs = Array.from(block.querySelectorAll('input.form-control'));
					const name = String(textInputs[0]?.value || '').trim();
					const address = String(textInputs[1]?.value || '').trim();
					const descEd = block.querySelector('.jweditor');
					const descriptionHtml = String(descEd?.innerHTML || '').trim();

					const imageKey = `attractionImage_${attractionIdx}`;
					// NOTE: block   file input  upload-grid  file input 
					const fileInput = block.querySelector('.upload-grid input[type="file"]');
					const picked = fileInput?.files?.[0] || null;
					if (picked) fd.append(imageKey, picked);

					const existingImage = String(block.dataset?.existingImage || fileInput?.dataset?.existing || '').trim();
					__uploadDebug.attractions.push({
						day: dayNum,
						order: bIdx + 1,
						imageKey,
						hasFile: !!picked,
						fileName: picked?.name || '',
						fileSize: picked?.size || 0,
						existingImage,
						hasPreview: !!block.querySelector('.upload-grid img.preview')
					});
					//   file/existing         
					if (!existingImage && !picked && block.querySelector('.upload-grid img.preview')) {
						__missingUploads.push(`Day ${dayNum}     (  )`);
					}

					attractions.push({
						day: dayNum,
						order: bIdx + 1,
						name,
						address,
						descriptionHtml,
						startHour: selects[0]?.value ?? '',
						startMinute: selects[1]?.value ?? '',
						endHour: selects[2]?.value ?? '',
						endMinute: selects[3]?.value ?? '',
						imageKey,
						existingImage
					});

					attractionIdx += 1;
				});

				// : schedule(=package_schedules) airport_* " " 
				const firstBlock = attractionBlocks[0];
				if (firstBlock) {
					const selects = Array.from(firstBlock.querySelectorAll('.meeting-wrap select'));
					fd.append(`day${dayNum}_startHour`, selects[0]?.value ?? '00');
					fd.append(`day${dayNum}_startMinute`, selects[1]?.value ?? '00');
					fd.append(`day${dayNum}_endHour`, selects[2]?.value ?? '00');
					fd.append(`day${dayNum}_endMinute`, selects[3]?.value ?? '00');
					const textInputs = Array.from(firstBlock.querySelectorAll('input.form-control'));
					fd.append(`day${dayNum}_airport`, String(textInputs[0]?.value || '').trim());
					fd.append(`day${dayNum}_airportAddress`, String(textInputs[1]?.value || '').trim());
					const ed = firstBlock.querySelector('.jweditor');
					fd.append(`day${dayNum}_airport_description`, String(ed?.innerHTML || '').trim());

					const firstFile = firstBlock.querySelector('.upload-grid input[type="file"]');
					const firstPicked = firstFile?.files?.[0] || null;
					if (firstPicked) fd.append(`day${dayNum}_airportImage`, firstPicked);
					const firstExisting = String(firstBlock.dataset?.existingImage || firstFile?.dataset?.existing || '').trim();
					if (firstExisting) fd.append(`day${dayNum}_airportImage_existing`, firstExisting);
					__uploadDebug.airports.push({
						day: dayNum,
						hasFile: !!firstPicked,
						fileName: firstPicked?.name || '',
						fileSize: firstPicked?.size || 0,
						existingImage: firstExisting,
						hasPreview: !!firstBlock.querySelector('.upload-grid img.preview')
					});
				}

				//  ()
				const mealPanel = Array.from(p.querySelectorAll('.sub-panel'))
					.find(sp => sp.querySelector('[data-lan-eng="Meal Information"]')) || null;
				if (mealPanel) {
					const mealInputs = Array.from(mealPanel.querySelectorAll('input.form-control'));
					fd.append(`day${dayNum}_breakfast`, String(mealInputs[0]?.value || '').trim());
					fd.append(`day${dayNum}_lunch`, String(mealInputs[1]?.value || '').trim());
					fd.append(`day${dayNum}_dinner`, String(mealInputs[2]?.value || '').trim());
				}
			});

			// / :     (  )
			try { window.__lastUploadDebug = __uploadDebug; } catch (_) {}
			if (__missingUploads.length) {
				console.warn('Image upload missing:', __missingUploads, __uploadDebug);
				throw new Error(__missingUploads[0]);
			}

			fd.append('attractionsJson', JSON.stringify(attractions));

			// 공통 숙박 정보 (Common Accommodation) - 다중 숙소 지원
			(function() {
				const container = document.getElementById('accommodationBlocksContainer');
				if (!container) return;

				const blocks = Array.from(container.querySelectorAll('.accommodation-block'));
				const accommodations = [];

				blocks.forEach((block, idx) => {
					const nameInput = block.querySelector('.accom-name');
					const addrInput = block.querySelector('.accom-address');
					const descEditor = block.querySelector('.accom-description');
					const imageGrid = block.querySelector('.accom-image-grid');

					const name = String(nameInput?.value || '').trim();
					const address = String(addrInput?.value || '').trim();
					const description = String(descEditor?.innerHTML || '').trim();

					// 이미지 처리
					const imageFile = imageGrid?.querySelector('input[type="file"]');
					const imagePicked = imageFile?.files?.[0] || null;
					const existingImage = String(block.dataset?.existingImage || imageFile?.dataset?.existing || '').trim();

					// 이미지 파일이 있으면 FormData에 추가
					if (imagePicked) {
						fd.append(`accommodationImage_${idx}`, imagePicked);
					}

					accommodations.push({
						sortOrder: idx,
						name: name,
						address: address,
						description: description,
						existingImage: existingImage,
						hasNewImage: !!imagePicked
					});
				});

				fd.append('accommodationsJson', JSON.stringify(accommodations));
			})();

			// 공통 교통 정보 (Common Transportation)
			(function() {
				const transPanel = document.getElementById('commonTransportation');
				if (transPanel) {
					const descEditor = document.getElementById('commonTransEditor');
					fd.append('common_transportation_description', String(descEditor?.innerHTML || '').trim());
				}
			})();

			//  (/) → backend/api/product-register.php  optionName/optionPrice  
			(function () {
				const feePanel = findCardByH3Lan('Number of people fee', /\s*/i);
				if (!feePanel) return;
				const rows = Array.from(feePanel.querySelectorAll('tbody tr'));
				rows.forEach((tr) => {
					const inputs = Array.from(tr.querySelectorAll('input.form-control'));
					const optionName = String(inputs[0]?.value || '').trim();
					const optionPriceRaw = String(inputs[1]?.value || '').trim();
					if (!optionName) return;
					//  (/ )
					const optionPrice = optionPriceRaw.replace(/[^0-9.]/g, '');
					fd.append('optionName[]', optionName);
					fd.append('optionPrice[]', optionPrice || '0');
				});
					})();

			//   (package_availability)
			(function () {
				const panel = document.querySelector('[data-section-name="iljastar"]');
				if (!panel) return;
				const rows = Array.from(panel.querySelectorAll('tbody tr'));
				rows.forEach((tr) => {
					const tds = Array.from(tr.querySelectorAll('td'));
					const date = String(tds[1]?.textContent || '').trim();
					const inputs = Array.from(tr.querySelectorAll('input.form-control'));
					const seats = String(inputs[0]?.value || '').trim().replace(/[^0-9]/g, '');
					const price = String(inputs[1]?.value || '').trim().replace(/[^0-9.]/g, '');
					if (!date) return;
					fd.append('availabilityDate[]', date);
					fd.append('availabilitySeats[]', seats || '0');
					fd.append('availabilityPrice[]', price || '0');
				});
			})();

			//   
			(function () {
				const feePanel = findCardByH3Lan('Room rate for single occupancy');
				const input = feePanel?.querySelector('input.form-control');
				const val = String(input?.value || '').trim();
				if (val) fd.append('singleRoomFee', val);
			})();

			// // (  card-panel  jweditor )
			const sectionEditorHtmlByLan = (lanEng, fallbackKoRe = null) => {
				const panel = findPanelByLanH2(lanEng, fallbackKoRe);
				if (!panel) return '';
				const eds = Array.from(panel.querySelectorAll('.jweditor'));
				return getEditorHtml(eds[eds.length - 1] || null);
			};
			const usageHtml = sectionEditorHtmlByLan('Usage Guide');
			const cancelHtml = sectionEditorHtmlByLan('Cancellation/Refund Policy', /\s*\/?\s*/i);
			const visaHtml = sectionEditorHtmlByLan('Visa Application Guide');
			if (usageHtml) fd.append('usage_guide', usageHtml);
			if (cancelHtml) fd.append('cancellation_policy', cancelHtml);
			if (visaHtml) fd.append('visa_guide', visaHtml);

			//  ( PDF) → packages.usage_guide_file/name/size
			(function () {
				const panel = findPanelByLanH2('Usage Guide');
				const file = panel?.querySelector('input[type="file"]');
				if (file?.files?.[0]) {
					fd.append('usageGuideFile', file.files[0]);
				} else if (file?.dataset?.existing) {
					fd.append('usageGuideFile_existing', file.dataset.existing);
					if (file.dataset.existingName) fd.append('usageGuideFileName_existing', file.dataset.existingName);
					if (file.dataset.existingSize) fd.append('usageGuideFileSize_existing', file.dataset.existingSize);
				}
			})();

			// SMT (#165): product documents (flyer/itinerary/detail)
			(function () {
				const flyer = document.getElementById('flyerFileInput');
				if (flyer?.files?.[0]) fd.append('flyerFile', flyer.files[0]);
				else if (flyer?.dataset?.existing) {
					fd.append('flyerFile_existing', flyer.dataset.existing);
					if (flyer.dataset.existingName) fd.append('flyerFileName_existing', flyer.dataset.existingName);
					if (flyer.dataset.existingSize) fd.append('flyerFileSize_existing', flyer.dataset.existingSize);
				}

				const itin = document.getElementById('itineraryFileInput');
				if (itin?.files?.[0]) fd.append('itineraryFile', itin.files[0]);
				else if (itin?.dataset?.existing) {
					fd.append('itineraryFile_existing', itin.dataset.existing);
					if (itin.dataset.existingName) fd.append('itineraryFileName_existing', itin.dataset.existingName);
					if (itin.dataset.existingSize) fd.append('itineraryFileSize_existing', itin.dataset.existingSize);
				}

				const detail = document.getElementById('detailFileInput');
				if (detail?.files?.[0]) fd.append('detailFile', detail.files[0]);
				else if (detail?.dataset?.existing) {
					fd.append('detailFile_existing', detail.dataset.existing);
					if (detail.dataset.existingName) fd.append('detailFileName_existing', detail.dataset.existingName);
					if (detail.dataset.existingSize) fd.append('detailFileSize_existing', detail.dataset.existingSize);
				}
			})();

			// / (refundDays)
			(function () {
				const panel = findPanelByLanH2('Cancellation/Refund Policy', /\s*\/?\s*/i);
				// "Full refund available standard date" ( input)
				let input = null;
				try {
					const span = panel?.querySelector('[data-lan-eng="Full refund available standard date"]');
					input = span?.closest('.grid-item')?.querySelector('input.form-control') || null;
				} catch (_) { input = null; }
				if (!input) input = panel?.querySelector('input.form-control') || null;
				const val = String(input?.value || '').trim().replace(/[^0-9]/g, '');
				if (val) fd.append('refundDays', val);
			})();

			//  (//) -    
			(function () {
				// 1:  id (/  )
				const thumbInputById = document.getElementById('thumbnailImageInput');
				const detailInputById = document.getElementById('detailImageInput');
				const productInputsById = [
					document.getElementById('productImageInput0'),
					document.getElementById('productImageInput1'),
					document.getElementById('productImageInput2'),
					document.getElementById('productImageInput3'),
					document.getElementById('productImageInput4'),
				].filter(Boolean);

				const thumbItem = thumbInputById?.closest?.('.grid-item') || findGridItemByLan('Thumbnail image');
				const detailItem = detailInputById?.closest?.('.grid-item') || findGridItemByLan('Detailed introduction image');
				const prodItem = (productInputsById[0]?.closest?.('.grid-item')) || findGridItemByLan('Product image');

				const thumb = thumbInputById || (thumbItem?.querySelector('input[type="file"]') || null);
				if (thumb?.files?.[0]) fd.append('thumbnailImage', thumb.files[0]);
				else {
					const ex = String(thumb?.dataset?.existing || '').trim();
					if (ex) fd.append('thumbnailImage_existing', ex);
				}

				const detail = detailInputById || (detailItem?.querySelector('input[type="file"]') || null);
				if (detail?.files?.[0]) fd.append('detailImage', detail.files[0]);
				else {
					const ex = String(detail?.dataset?.existing || '').trim();
					if (ex) fd.append('detailImage_existing', ex);
				}

				//  ( 5)
				if (prodItem) {
					const inputs = productInputsById.length ? productInputsById : Array.from(prodItem.querySelectorAll('input[type="file"]'));
					// IMPORTANT:
					// -   " " , / 5     .
					// -  productImages_existing [slot0..slot4]  5  (  '').
					const existing = [];
					inputs.slice(0, 5).forEach((inp, i) => {
						if (inp.files && inp.files[0]) {
							fd.append(`productImage_${i}`, inp.files[0]);
							existing.push(''); //     (backend slot replace)
						} else {
							existing.push(String(inp.dataset?.existing || '').trim());
						}
					});
					fd.append('productImages_existing', JSON.stringify(existing.slice(0, 5)));
				}
			})();

			// backend 2  
			const res = await fetch('../../backend/api/product-register.php', {
				method: 'POST',
				credentials: 'same-origin',
				body: fd
			});

			const json = await res.json().catch(() => ({}));
			if (!res.ok || !json.success) {
				throw new Error(json.message || `  (HTTP ${res.status})`);
			}
			return json;
		}

		// :       
		function product_registration_save(btn) {
			// IMPORTANT:
			// - default.js essentialCheck() data-essential="y" ,
			//          .
			// - super.js essentialCheck2() "*  " /  .
			try {
				// 1)   (*, ,  ) +  hidden   super.js 
				let missingList = [];
				if (typeof essentialCheck2_list === 'function') {
					missingList = essentialCheck2_list(btn) || [];
				} else if (typeof essentialCheck2 === 'function') {
					const m = essentialCheck2(btn);
					if (m) missingList = [m];
				} else if (typeof essentialCheck === 'function') {
					const ok = essentialCheck(btn);
					if (!ok) missingList = [' '];
				}

				// 2)    
				const uniq = (arr) => Array.from(new Set((arr || []).map(s => String(s || '').trim()).filter(Boolean)));
				const isSectionHidden = (name) => {
					const nodes = Array.from(document.querySelectorAll(`[data-section-name="${name}"]`));
					if (!nodes.length) return false;
					return nodes.every(n => n.classList.contains('hidden'));
				};
				const flightHidden = isSectionHidden('flight-information');
				const iljastarHidden = isSectionHidden('iljastar');
				const pohamHidden = isSectionHidden('poham');

				//  : ~  100() 
				try {
					const raw = String(document.getElementById('contract-period')?.value || '').trim();
					const m = raw.match(/(\d{4}-\d{2}-\d{2})/g) || [];
					if (m.length >= 1) {
						const s = new Date(m[0] + 'T00:00:00');
						const e = new Date((m[1] || m[0]) + 'T00:00:00');
						if (!Number.isNaN(s.getTime()) && !Number.isNaN(e.getTime())) {
							const a = (s <= e) ? s : e;
							const b = (s <= e) ? e : s;
							const diffDays = Math.floor((b.getTime() - a.getTime()) / (24 * 60 * 60 * 1000)) + 1; // inclusive
							if (diffDays > 100) {
								missingList.push('Sale period (max 100 days)');
							}
						}
					}
				} catch (_) {}

				//  ( ):  1   +   /  
				try {
					// NOTE: (eng/tl)   textContent  " "    
					// data-lan-eng  .
					const feePanel =
						(document.querySelector('.grid-wrap-title[data-lan-eng="Number of people fee"]')?.closest('.card-panel')) ||
						Array.from(document.querySelectorAll('.card-panel')).find(p => (p.querySelector('.grid-wrap-title')?.textContent || '').includes(' '));
					const rowsAll = Array.from(feePanel?.querySelectorAll('tbody tr') || []);
					const isHiddenRow = (tr) => {
						try {
							if (!tr) return true;
							const st = window.getComputedStyle(tr);
							if (st && (st.display === 'none' || st.visibility === 'hidden')) return true;
							if (tr.offsetParent === null && st.position !== 'fixed') return true;
						} catch (_) {}
						return false;
					};
					const rows = rowsAll.filter(tr => !isHiddenRow(tr));
					let anyFilled = false;
					for (const tr of rows) {
						const inputs = Array.from(tr.querySelectorAll('input.form-control'));
						const optName = (inputs[0]?.value || '').trim();
						//  '1,000'   (   )
						const optPrice = (inputs[1]?.value || '').toString().trim();
						if (optName || optPrice) anyFilled = true;
						if ((optName && !optPrice) || (!optName && optPrice)) {
							missingList.push(' ');
							break;
						}
					}
					if (!anyFilled) missingList.push(' ');
				} catch (_) {}

				// /(  ):    (   )
				if (!pohamHidden) {
					try {
						const panels = Array.from(document.querySelectorAll('[data-section-name="poham"].card-panel'));
						for (const panel of panels) {
							const inputs = Array.from(panel.querySelectorAll('tbody input.form-control'));
							for (const inp of inputs) {
								if (((inp.value || '').trim().length) === 0) {
									missingList.push('/ ');
									throw new Error('break');
								}
							}
						}
					} catch (_) {}
				}

				//   (    ):   /  
				if (!flightHidden && !iljastarHidden) {
					try {
						const panel = document.querySelector('[data-section-name="iljastar"]');
						const rows = Array.from(panel?.querySelectorAll('tbody tr') || []);
						if (!rows.length) {
							missingList.push('  ');
						} else {
							for (const tr of rows) {
								const inputs = Array.from(tr.querySelectorAll('input, select'));
								//   input    ,    
								const nums = inputs
									.map(el => (el && 'value' in el) ? String(el.value || '').trim() : '')
									.filter(v => v !== '');
								//  2(/)   
								//     
								const cap = String(inputs[0]?.value || '').trim();
								const fee = String(inputs[1]?.value || '').trim();
								if (cap === '' || fee === '') {
									missingList.push('  ');
									break;
								}
							}
						}
					} catch (_) {}
				}

				missingList = uniq(missingList);
				if (missingList.length) {
					const esc = (s) => String(s)
						.replace(/&/g, '&amp;')
						.replace(/</g, '&lt;')
						.replace(/>/g, '&gt;')
						.replace(/"/g, '&quot;')
						.replace(/'/g, '&#39;');
					const html = missingList.map(esc).join('<br>');
					window.__jwLastRequiredMissingHtml = html;

					const applyToDialog = (dialog) => {
						if (!dialog) return false;
						const tg = dialog.querySelector('#lllll');
						if (!tg) return false;
						tg.innerHTML = html;
						return true;
					};
					const onLoaded = (event) => {
						const { dialog, action } = event.detail || {};
						if (!dialog || !action) return;
						if (!String(action).includes('template-detail-modal1.html')) return;
						applyToDialog(dialog);
						document.removeEventListener('modal:loaded', onLoaded);
					};
					document.addEventListener('modal:loaded', onLoaded);

					modal('template-detail-modal1.html', '600px', '252px');
					setTimeout(() => applyToDialog(document.querySelector('dialog:last-of-type')), 50);
					setTimeout(() => applyToDialog(document.querySelector('dialog:last-of-type')), 300);
					return;
				}
			} catch (_) { }

			window.__productPreviewData = collectPreviewData();
			modal('product-preview.html', '90%', '90%');
		}

		document.addEventListener('modal:loaded', (evt) => {
			const action = evt?.detail?.action || '';
			const d = evt?.detail?.dialog;
			if (!d) return;
			if (!action.includes('product-preview.html')) return;

				const data = window.__productPreviewData || {};
			d.querySelector('#previewProductName')?.replaceChildren(document.createTextNode(data.productName || '-'));
			d.querySelector('#previewTargetMarket')?.replaceChildren(document.createTextNode(data.targetMarket || '-'));
			d.querySelector('#previewMainCategory')?.replaceChildren(document.createTextNode(data.mainCategory || '-'));
			d.querySelector('#previewSubCategory')?.replaceChildren(document.createTextNode(data.subCategory || '-'));
			{
				const el = d.querySelector('#previewDescription');
				if (el) el.innerHTML = data.descriptionHtml || '-';
			}

			// 
			const thumb = d.querySelector('#previewThumbnail');
			if (thumb) {
				thumb.src = data.thumbnailSrc || '';
				thumb.style.display = data.thumbnailSrc ? '' : 'none';
			}
			const prodWrap = d.querySelector('#previewProductImages');
			if (prodWrap) {
				const srcs = Array.isArray(data.productImageSrcs) ? data.productImageSrcs : [];
				prodWrap.innerHTML = srcs.length
					? srcs.map((src) => `<div class="thumbnail"><img class="preview" src="${escapeHtml(src)}" alt=""></div>`).join('')
					: '<p>-</p>';
			}
			const detail = d.querySelector('#previewDetailImage');
			if (detail) {
				detail.src = data.detailImageSrc || '';
				detail.style.display = data.detailImageSrc ? '' : 'none';
			}

				const dep = data.flight?.departure || {};
				const ret = data.flight?.return || {};
				d.querySelector('#previewDepFlightNo')?.replaceChildren(document.createTextNode(dep.flightNo || '-'));
				d.querySelector('#previewDepDepartTime')?.replaceChildren(document.createTextNode(dep.departTime || '-'));
				d.querySelector('#previewDepArriveTime')?.replaceChildren(document.createTextNode(dep.arriveTime || '-'));
				d.querySelector('#previewDepFrom')?.replaceChildren(document.createTextNode(dep.from || '-'));
				d.querySelector('#previewDepTo')?.replaceChildren(document.createTextNode(dep.to || '-'));
				d.querySelector('#previewRetFlightNo')?.replaceChildren(document.createTextNode(ret.flightNo || '-'));
				d.querySelector('#previewRetDepartTime')?.replaceChildren(document.createTextNode(ret.departTime || '-'));
				d.querySelector('#previewRetArriveTime')?.replaceChildren(document.createTextNode(ret.arriveTime || '-'));
				d.querySelector('#previewRetFrom')?.replaceChildren(document.createTextNode(ret.from || '-'));
				d.querySelector('#previewRetTo')?.replaceChildren(document.createTextNode(ret.to || '-'));

				const sales = data.sales || {};
			d.querySelector('#previewSalesPeriod')?.replaceChildren(document.createTextNode(sales.period || '-'));
				d.querySelector('#previewMinParticipants')?.replaceChildren(document.createTextNode(sales.minParticipants || '-'));
				d.querySelector('#previewMaxParticipants')?.replaceChildren(document.createTextNode(sales.maxParticipants || '-'));
				d.querySelector('#previewBaseFlightFare')?.replaceChildren(document.createTextNode(sales.baseFlightFare || '-'));

			//   ( )
			{
				const tbody = d.querySelector('#previewSalesAdjustTbody');
				if (tbody) {
					const rows = Array.isArray(data.dailySalesAdjustment) ? data.dailySalesAdjustment : [];
					tbody.innerHTML = rows.map((r, i) => `
						<tr>
							<td class="is-center">${i + 1}</td>
							<td class="is-center">${escapeHtml(r.date || '')}</td>
							<td class="is-center">${escapeHtml(r.capacity || '')}</td>
							<td class="is-center">${escapeHtml(r.fee || '')}</td>
						</tr>
					`).join('');
				}
			}

			// ( + )
			d.querySelector('#previewMeetingTime')?.replaceChildren(document.createTextNode(data.meeting?.time || '-'));
			d.querySelector('#previewMeetingPlace')?.replaceChildren(document.createTextNode(data.meeting?.place || '-'));
			d.querySelector('#previewMeetingAddress')?.replaceChildren(document.createTextNode(data.meeting?.address || '-'));
			{
				const host = d.querySelector('#previewItineraryDays');
				if (host) {
					const days = Array.isArray(data.days) ? data.days : [];
					host.innerHTML = days.map((day) => {
						const atts = Array.isArray(day.attractions) ? day.attractions : [];
						return `
							<div class="jw-mgt24">
								<h3 class="grid-wrap-title">${escapeHtml(String(day.day || ''))}Day</h3>
								<hr>
								<div class="grid-wrap">
									<div class="grid-item col-span-3">
										<label class="label-name">Schedule Summary</label>
										<p>${escapeHtml(day.summary || '-')}</p>
									</div>
								</div>
								<h3 class="grid-wrap-title">Tourist Information</h3>
								${atts.map((a) => `
									<div class="grid-wrap"><div class="grid-item col-span-3"><label class="label-name">Sight Name</label><p>${escapeHtml(a.name || '-')}</p></div></div>
									<div class="grid-wrap"><div class="grid-item col-span-3"><label class="label-name">Sight Address</label><p>${escapeHtml(a.address || '-')}</p></div></div>
									<div class="grid-wrap"><div class="grid-item col-span-3"><label class="label-name">Sight Information</label><div>${a.infoHtml || '-'}</div></div></div>
									${a.imageSrc ? `<div class="grid-wrap"><div class="grid-item col-span-3"><label class="label-name">Sight Image</label><div class="thumbnail"><img class="preview" src="${escapeHtml(a.imageSrc)}" alt=""></div></div></div>` : ''}
								`).join('')}

								<h3 class="grid-wrap-title">Accommodation Information</h3>
								<div class="grid-wrap">
									<div class="grid-item col-span-3"><label class="label-name">Accommodation name</label><p>${escapeHtml(day.accommodation?.name || '-')}</p></div>
									<div class="grid-item col-span-3"><label class="label-name">Accommodation address</label><p>${escapeHtml(day.accommodation?.address || '-')}</p></div>
									<div class="grid-item col-span-3"><label class="label-name">Accommodation Description</label><div>${day.accommodation?.descriptionHtml || '-'}</div></div>
								</div>
								${day.accommodation?.imageSrc ? `<div class="grid-wrap"><div class="grid-item col-span-3"><label class="label-name">Accommodation image</label><div class="thumbnail"><img class="preview" src="${escapeHtml(day.accommodation.imageSrc)}" alt=""></div></div></div>` : ''}

								<h3 class="grid-wrap-title">Transportation Information</h3>
								<div class="grid-wrap"><div class="grid-item col-span-3"><label class="label-name">Description</label><div>${day.transportation?.descriptionHtml || '-'}</div></div></div>

								<h3 class="grid-wrap-title">Meal Information</h3>
								<div class="grid-wrap">
									<div class="grid-item"><label class="label-name">Breakfast</label><p>${escapeHtml(day.meals?.breakfast || '-')}</p></div>
									<div class="grid-item"><label class="label-name">Lunch</label><p>${escapeHtml(day.meals?.lunch || '-')}</p></div>
									<div class="grid-item"><label class="label-name">Dinner</label><p>${escapeHtml(day.meals?.dinner || '-')}</p></div>
								</div>
							</div>
						`;
					}).join('');
				}
			}

			// /
			{
				const tb = d.querySelector('#previewPricingTbody');
				if (tb) {
					const rows = Array.isArray(data.pricing?.perPerson) ? data.pricing.perPerson : [];
					tb.innerHTML = rows.map((r, i) => `
						<tr>
							<td class="is-center">${i + 1}</td>
							<td class="is-center">${escapeHtml(r.optionName || '')}</td>
							<td class="is-center">${escapeHtml(r.price || '')}</td>
						</tr>
					`).join('');
				}
				d.querySelector('#previewSingleRoomFee')?.replaceChildren(document.createTextNode(data.pricing?.singleRoomFee || '-'));
			}
			{
				const inc = d.querySelector('#previewIncludedTbody');
				if (inc) {
					const items = Array.isArray(data.included) ? data.included : [];
					inc.innerHTML = items.map((t, i) => `<tr><td class="is-center">${i + 1}</td><td>${escapeHtml(t)}</td></tr>`).join('');
				}
				const exc = d.querySelector('#previewExcludedTbody');
				if (exc) {
					const items = Array.isArray(data.excluded) ? data.excluded : [];
					exc.innerHTML = items.map((t, i) => `<tr><td class="is-center">${i + 1}</td><td>${escapeHtml(t)}</td></tr>`).join('');
				}
			}

			// //
			{
				const fileBox = d.querySelector('#previewUsageGuideFile');
				if (fileBox) {
					const img = fileBox.querySelector('img');
					const name = String(data.usageGuide?.fileName || '').trim();
					fileBox.textContent = name ? ` ${name}` : ' No file';
					if (img) fileBox.prepend(img);
				}
				const dlBtn = d.querySelector('#previewUsageGuideDownload');
				if (dlBtn) {
					const name = String(data.usageGuide?.fileName || '').trim();
					dlBtn.disabled = !name;
					dlBtn.onclick = () => {
						if (!name) return;
						const rel = name.startsWith('/uploads/') ? name : `/uploads/usage_guides/${name}`;
						window.open(`/backend/api/download.php?file=${encodeURIComponent(rel)}`, '_blank');
					};
				}
				const usageDesc = d.querySelector('#previewUsageGuideDescription');
				if (usageDesc) usageDesc.innerHTML = data.usageGuide?.descriptionHtml || '-';
				const cancelDesc = d.querySelector('#previewCancellationRefund');
				if (cancelDesc) cancelDesc.innerHTML = data.cancellationPolicy?.descriptionHtml || '-';
				const visaDesc = d.querySelector('#previewVisaGuide');
				if (visaDesc) visaDesc.innerHTML = data.visaGuide?.descriptionHtml || '-';
			}

			const saveBtn = d.querySelector('#saveFromPreview');
			if (saveBtn) {
				saveBtn.addEventListener('click', async () => {
					try {
						saveBtn.disabled = true;
						await saveFromPreviewToDb({ saveMode: 'active' });
						alert('.');
						modal_close();
						//    
						window.location.href = 'product-list.html';
					} catch (e) {
						console.error(e);
						alert(e?.message || '   .');
					} finally {
						saveBtn.disabled = false;
					}
				}, { once: true });
			}
		});

		//    (template-detail-modal1.html): "Please enter [label]" 
		document.addEventListener('modal:loaded', (evt) => {
			const action = evt?.detail?.action || '';
			const d = evt?.detail?.dialog;
			if (!d) return;
			if (!action.includes('template-detail-modal1.html')) return;
			const target = d.querySelector('#lllll');
			if (target) {
				target.textContent = String(window.__lastEssentialMissingLabel || '').trim();
			}
			d.querySelector('#closeDialog')?.addEventListener('click', () => {
				try { modal_close(); } catch (_) {}
			}, { once: true });
		});

		//  :    ( )
		(function bindTempSave() {
			const run = () => {
				const btn = document.getElementById('tempSaveBtn');
				if (!btn) return;
				btn.addEventListener('click', async () => {
					try {
						btn.disabled = true;
						btn.classList.add('is-loading');
						await saveFromPreviewToDb({ saveMode: 'temporary' });
						alert('.');
						//     (     )
						window.location.href = 'product-list.html';
					} catch (e) {
						console.error(e);
						alert(e?.message || '   .');
					} finally {
						btn.disabled = false;
						btn.classList.remove('is-loading');
					}
				});
			};
			if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', run, { once: true });
			else run();
		})();

		//   /  "  "    
		(function bindFlightFareToggleGate() {
			const getBaseFareInput = () => {
				try {
					const span = document.querySelector('.card-panel .label-name [data-lan-eng="Basic Airfare (₱)"]');
					return span?.closest('.grid-item')?.querySelector('input.form-control') || null;
				} catch (_) {
					return null;
				}
			};
			const update = () => {
				const t = document.querySelector('button[data-target-section="flight-information"]');
				const flightActive = !(t && t.classList.contains('on'));
				const baseFare = getBaseFareInput();
				if (baseFare) {
					baseFare.disabled = !flightActive;
					//   id   
					if (!baseFare.id) baseFare.id = 'baseFlightFare';
				}
				//        on/off
				const panel = document.querySelector('[data-section-name="iljastar"]');
				if (panel) {
					Array.from(panel.querySelectorAll('tbody tr')).forEach((tr) => {
						const inputs = Array.from(tr.querySelectorAll('input.form-control'));
						const fee = inputs[1] || null; // [0]=capacity, [1]=fee
						if (fee) fee.disabled = !flightActive;
					});
				}
			};

			// togglePlusMinus    
			document.addEventListener('click', (e) => {
				const btn = e.target?.closest?.('button[data-target-section="flight-information"]');
				if (!btn) return;
				setTimeout(update, 0);
			});

			if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', update, { once: true });
			else update();
		})();

		//   (product-detail_m1.html): //
		document.addEventListener('modal:loaded', (evt) => {
			const action = evt?.detail?.action || '';
			const d = evt?.detail?.dialog;
			if (!d) return;
			if (!action.includes('product-detail_m1.html')) return;

			const input = d.querySelector('#templateSearchInput');
			const btn = d.querySelector('#templateSearchBtn');
			const listHost = d.querySelector('#templateList');
			const loadBtn = d.querySelector('#templateLoadBtn');

			let selectedId = null;

			const escapeHtml = (s) => {
				const div = document.createElement('div');
				div.textContent = String(s ?? '');
				return div.innerHTML;
			};

			const renderList = (templates) => {
				if (!listHost) return;
				const items = Array.isArray(templates) ? templates : [];
				if (!items.length) {
					listHost.innerHTML = `<div class="wrap jw-mgt8"><input type="text" class="form-control" value="No templates" disabled></div>`;
					selectedId = null;
					if (loadBtn) loadBtn.disabled = true;
					return;
				}

				listHost.innerHTML = items.map((t) => {
					const id = t.templateId ?? '';
					const name = t.templateName ?? '';
					return `
						<div class="wrap jw-mgt8 template-item" data-template-id="${escapeHtml(id)}" style="cursor:pointer;">
							<input type="text" class="form-control" value="${escapeHtml(name)}" readonly>
						</div>
					`;
				}).join('');

				listHost.querySelectorAll('.template-item').forEach((el) => {
					el.addEventListener('click', () => {
						listHost.querySelectorAll('.template-item').forEach(x => x.classList.remove('is-selected'));
						el.classList.add('is-selected');
						selectedId = el.getAttribute('data-template-id');
						if (loadBtn) loadBtn.disabled = !selectedId;
					});
				});
			};

			const fetchTemplates = async (q) => {
				try {
					if (listHost) listHost.innerHTML = `<div class="wrap jw-mgt8"><input type="text" class="form-control" value="Loading..." disabled></div>`;
					const params = new URLSearchParams({
						action: 'getTemplates',
						page: '1',
						limit: '50'
					});
					const qq = String(q || '').trim();
					if (qq) params.append('search', qq);
					const res = await fetch(`../backend/api/super-api.php?${params.toString()}`, { credentials: 'include' });
					const json = await res.json().catch(() => ({}));
					if (res.status === 401) throw new Error('Admin login required');
					if (!res.ok || !json.success) throw new Error(json.message || `HTTP ${res.status}`);
					renderList(json.data?.templates || []);
				} catch (e) {
					console.error('Template search failed:', e);
					if (listHost) listHost.innerHTML = `<div class="wrap jw-mgt8"><input type="text" class="form-control" value="Failed to load templates" disabled></div>`;
					selectedId = null;
					if (loadBtn) loadBtn.disabled = true;
					if (String(e?.message || '').includes('Admin login required')) {
						alert(' .');
						window.location.href = '../index.html';
					}
				}
			};

			//  :       ( :   )
			const applyTemplateToProductForm = async (templateId) => {
				const id = String(templateId || '').trim();
				if (!id) return;

				const params = new URLSearchParams({ action: 'getTemplateDetail', id });
				const res = await fetch(`../backend/api/super-api.php?${params.toString()}`, { credentials: 'include' });
				const json = await res.json().catch(() => ({}));
				if (res.status === 401) throw new Error('Admin login required');
				if (!res.ok || !json.success) throw new Error(json.message || `HTTP ${res.status}`);
				const t = json.data?.template || {};
				const data = t.data || {};

				//  JSON ( ):
				// data.template.templateName
				// data.product.{targetMarket,mainCategory,subCategory,descriptionHtml,images}
				// data.schedule.meeting + data.schedule.days[]
				// data.pricing.{perPerson,singleRoomFee}
				// data.included/excluded (array)
				// data.usageGuide.{descriptionHtml,file{filePath,originalName,fileName,fileSize}}
				// data.cancellationPolicy.{refundDays,descriptionHtml}
				// data.visaGuide.{descriptionHtml}

				const ensureCategoryMeta = async () => {
					if (window.__productCategoryMeta && Array.isArray(window.__productCategoryMeta) && window.__productCategoryMeta.length) return;
					try {
						// product-registration super-api.php?action=getCategories  select    
						const r = await fetch('../backend/api/super-api.php?action=getCategories', { credentials: 'same-origin' });
						const j = await r.json().catch(() => ({}));
						if (j?.success && Array.isArray(j?.data?.categories)) window.__productCategoryMeta = j.data.categories;
					} catch (_) {}
				};

				const findGridItemByLan = (eng) => {
					// label  data-lan-eng   +  span    
					const sel = `.grid-item .label-name[data-lan-eng="${CSS.escape(eng)}"], .grid-item .label-name [data-lan-eng="${CSS.escape(eng)}"]`;
					const el = document.querySelector(sel);
					return el ? el.closest('.grid-item') : null;
				};
				const findPanelByLanH2 = (eng) => {
					const h2 = document.querySelector(`h2.section-title[data-lan-eng="${CSS.escape(eng)}"]`);
					return h2 ? h2.nextElementSibling : null;
				};

				//  Quill `.jweditor`  `.ql-editor` ,
				// Quill    `.ql-editor`  HTML  " " .
				const setEditorHtml = (containerEl, html, tries = 10) => {
					if (!containerEl) return;
					const val = String(html || '');
					const tryOnce = (n) => {
						// 1) Quill   : ql-editor   ( )
						try {
							const ql = containerEl.querySelector('.ql-editor');
							if (ql) {
								ql.innerHTML = val;
								return true;
							}
						} catch (_) {}

						try {
							if (window.Quill && typeof Quill.find === 'function') {
								const q = Quill.find(containerEl);
								if (q) {
									q.setText('');
									if (q.clipboard && typeof q.clipboard.dangerouslyPasteHTML === 'function') {
										q.clipboard.dangerouslyPasteHTML(val);
									} else {
										// fallback: ql-editor 
										const ql = containerEl.querySelector('.ql-editor');
										if (ql) ql.innerHTML = val;
										else containerEl.innerHTML = val;
									}
									return true;
								}
							}
						} catch (_) {}
						// 2) Quill  : jweditor  HTML (Quill    HTML    )
						try { containerEl.innerHTML = val; } catch (_) {}
						if (n > 0) setTimeout(() => tryOnce(n - 1), 120);
						return false;
					};
					tryOnce(tries);
				};

				const setExistingFile = (fileInput, srcOrName, extra = {}) => {
					if (!fileInput || !srcOrName) return;
					fileInput.dataset.existing = String(srcOrName);
					if (extra.name) fileInput.dataset.existingName = String(extra.name);
					if (extra.size != null) fileInput.dataset.existingSize = String(extra.size);
				};

				const resolvePreviewSrc = (srcOrName) => {
					const isUrl = /^https?:\/\//i.test(String(srcOrName)) || String(srcOrName).startsWith('/');
					const src = isUrl ? String(srcOrName) : `../../uploads/products/${encodeURIComponent(String(srcOrName))}`;
					return src;
				};
				const isValidImageFilename = (fn) => /\.(jpe?g|png|gif|webp)$/i.test(String(fn || '').trim());
				const setSlotUiFilled = (slotEl, filled) => {
					if (!slotEl) return;
					const uploadBtn = slotEl.querySelector('.btn-upload');
					if (uploadBtn) uploadBtn.style.display = filled ? 'none' : '';
					slotEl.classList.toggle('is-filled', !!filled);
				};
				const ensureSlotDeleteButton = (slotEl, inputEl) => {
					if (!slotEl) return null;
					let btn = slotEl.querySelector('button.jw-button.btn-close[data-slot-delete="1"]');
					if (!btn) {
						btn = document.createElement('button');
						btn.type = 'button';
						btn.className = 'jw-button btn-close';
						btn.setAttribute('aria-label', 'remove');
						btn.dataset.slotDelete = '1';
						btn.innerHTML = `<div class="ic-close" style="width:15px; height:15px; --line:1px; --color:#969696"></div>`;
						btn.addEventListener('click', (e) => {
							e.preventDefault();
							e.stopPropagation();
							try { if (inputEl) { inputEl.value = ''; delete inputEl.dataset.existing; } } catch (_) {}
							slotEl.querySelectorAll('img.preview').forEach(n => n.remove());
							setSlotUiFilled(slotEl, false);
						});
						slotEl.appendChild(btn);
					}
					return btn;
				};
				const setSinglePreview = (gridEl, srcOrName) => {
					if (!gridEl) return;
					//     "  "   
					const slot = gridEl.querySelector('.upload-item') || null;
					if (!slot) return;
					slot.querySelectorAll('img.preview').forEach(n => n.remove());
					setSlotUiFilled(slot, false);
					if (!srcOrName) return;
					//      (Blob UUID ) 
					const s = String(srcOrName).trim();
					const isUrl = /^https?:\/\//i.test(s) || s.startsWith('/');
					if (!isUrl && !isValidImageFilename(s)) return;
					const src = resolvePreviewSrc(s);
					const img = document.createElement('img');
					img.className = 'preview';
					img.alt = '';
					img.src = src;
					slot.prepend(img);
					setSlotUiFilled(slot, true);
					//  grid input  delete  (/ 1)
					const inp = gridEl.querySelector('input[type="file"]') || null;
					ensureSlotDeleteButton(slot, inp);
				};
				// product images must remain max 5 slots; never prepend extra upload-item nodes
				const setPreviewInInputSlot = (inputEl, srcOrName) => {
					if (!inputEl) return;
					const slot = inputEl.closest('.upload-item') || null;
					if (!slot) return;
					slot.querySelectorAll('img.preview').forEach(n => n.remove());
					setSlotUiFilled(slot, false);
					const s = String(srcOrName || '').trim();
					if (!s) return;
					const isUrl = /^https?:\/\//i.test(s) || s.startsWith('/');
					if (!isUrl && !isValidImageFilename(s)) return;
					const src = resolvePreviewSrc(s);
					const img = document.createElement('img');
					img.className = 'preview';
					img.alt = '';
					img.src = src;
					slot.prepend(img);
					setSlotUiFilled(slot, true);
					ensureSlotDeleteButton(slot, inputEl);
				};

				// (1)  =   Product Name ,  
				const tplName = String(data?.template?.templateName || t.templateName || '').trim();
				const productNameFromTpl = String(data?.product?.productName || '').trim();
				if (document.getElementById('productName')) {
					document.getElementById('productName').value = productNameFromTpl || tplName;
				}

				// (2) /
				const targetMarket = String(data?.product?.targetMarket || t.targetMarket || '').trim();
				if (targetMarket && document.getElementById('salesTarget')) document.getElementById('salesTarget').value = targetMarket;

				const normalizeMainCode = (v) => {
					const s = String(v || '').trim();
					const map = {
						'': 'season', 'Seasonal': 'season', 'season': 'season',
						'': 'region', 'Regional': 'region', 'region': 'region',
						'': 'theme', 'Theme': 'theme', 'theme': 'theme',
						'': 'private', 'Private': 'private', 'private': 'private',
						'': 'daytrip', 'Daytrip': 'daytrip', 'daytrip': 'daytrip', 'oneday': 'daytrip'
					};
					return map[s] || s;
				};
				const mainCodeRaw = String(data?.product?.mainCategory || t.mainCategory || '').trim();
				const mainCode = normalizeMainCode(mainCodeRaw);
				const mainSel = document.getElementById('mainCategory');
				if (mainSel && mainCode) {
					// option.value code  code  (  )
					const has = Array.from(mainSel.options || []).some(o => String(o.value || '').trim() === mainCode);
					if (!has) {
						const opt = document.createElement('option');
						opt.value = mainCode;
						opt.textContent = mainCode;
						mainSel.appendChild(opt);
					}
					mainSel.value = mainCode;
					try { mainSel.dispatchEvent(new Event('change', { bubbles: true })); } catch (_) {}
				}
				if (document.getElementById('subCategory')) {
					await ensureCategoryMeta();
					const subSel = document.getElementById('subCategory');
					subSel.disabled = false;
					const subCode = String(data?.product?.subCategory || t.subCategory || '').trim();
					//  DB   
					try { template_detail_sdaf_cate('.content-main'); } catch (_) {}
					if (subCode) {
						const opt = Array.from(subSel.options).find(o => String(o.value || o.textContent || '').toLowerCase() === subCode.toLowerCase());
						subSel.value = opt ? opt.value : subSel.value;
					}
					// placeholder   (  )
					if (!String(subSel.value || '').trim() || /please|select|first/i.test(String(subSel.value))) {
						const cand = Array.from(subSel.options).map(o => o.value || o.textContent).find(v => v && !/please|select|first/i.test(String(v)));
						if (cand) subSel.value = cand;
					}
				}

				// (3)  
				const descHtml = String(data?.product?.descriptionHtml || '').trim();
				const descEd = document.getElementById('productDescriptionEditor');
				if (descEd) setEditorHtml(descEd, descHtml, 12);

				// (4) (//)
				const imgs = data?.product?.images || {};
				const thumbSrc = imgs?.thumbnail || '';
				const detailSrc = imgs?.detailImage || '';
				const prodImgs = Array.isArray(imgs?.productImages) ? imgs.productImages : [];

				const thumbItem = (document.querySelector('.upload-grid[data-field="thumbnailImage"]')?.closest('.grid-item')) || findGridItemByLan('Thumbnail image');
				if (thumbItem) {
					const inp = thumbItem.querySelector('input[type="file"]');
					setExistingFile(inp, thumbSrc || '');
					setSinglePreview(thumbItem.querySelector('.upload-grid'), thumbSrc || '');
				}
				const detailItem = (document.querySelector('.upload-grid[data-field="detailImage"]')?.closest('.grid-item')) || findGridItemByLan('Detailed introduction image');
				if (detailItem) {
					const inp = detailItem.querySelector('input[type="file"]');
					setExistingFile(inp, detailSrc || '');
					setSinglePreview(detailItem.querySelector('.upload-grid'), detailSrc || '');
				}
				const prodItem = (document.querySelector('.upload-grid[data-field="productImages"]')?.closest('.grid-item')) || findGridItemByLan('Product image');
				if (prodItem) {
					const inputs = Array.from(prodItem.querySelectorAll('input[type="file"]')).slice(0, 5);
					//  UI  ,    (   )
					inputs.forEach((inp) => {
						try { delete inp.dataset.existing; } catch (_) {}
						const slot = inp.closest('.upload-item') || null;
						slot?.querySelectorAll('img.preview')?.forEach(n => n.remove());
						if (slot) setSlotUiFilled(slot, false);
					});
					inputs.forEach((inp, i) => {
						const srcOrName = prodImgs[i] || '';
						setExistingFile(inp, srcOrName);
						setPreviewInInputSlot(inp, srcOrName);
					});
				}

				// (5)  
				const meeting = data?.schedule?.meeting || {};
				(function applyMeeting() {
					const panel = Array.from(document.querySelectorAll('.card-panel')).find(p => p.querySelector('h3.grid-wrap-title[data-lan-eng="Meeting Information"]')) ||
						Array.from(document.querySelectorAll('.card-panel')).find(p => (p.querySelector('h3')?.getAttribute('data-lan-eng') || '') === 'Meeting Information');
					if (!panel) return;
					const selects = Array.from(panel.querySelectorAll('select'));
					const hour = String(meeting.hour || '').padStart(2, '0');
					const minute = String(meeting.minute || '').padStart(2, '0');
					if (hour && selects[0]) selects[0].value = hour;
					if (minute && selects[1]) selects[1].value = minute;
					try { selects.forEach(s => s.dispatchEvent(new Event('change', { bubbles: true }))); } catch (_) {}
					const inputs = Array.from(panel.querySelectorAll('input.form-control'));
					if (inputs[0]) inputs[0].value = String(meeting.placeName || '');
					if (inputs[1]) inputs[1].value = String(meeting.placeAddress || '');
				})();

				// (6) (////)
				const days = Array.isArray(data?.schedule?.days) ? data.schedule.days : [];
				const base = document.getElementById('nday');
				if (base) {
					//   (aside-row-list) 1  (1day  4day )
					try {
						const list = document.querySelector('.aside-row-list');
						if (list) {
							const rows = Array.from(list.querySelectorAll('.aside-row'));
							rows.slice(1).forEach(r => r.remove());
							const first = rows[0] || list.querySelector('.aside-row');
							if (first) {
								const sub = first.querySelector('.aside-row__subtitle');
								if (sub) {
									sub.setAttribute('data-lan-eng', 'Day 1');
									sub.setAttribute('data-scroll-target', 'day-1');
									sub.setAttribute('onclick', 'scrollToDayPanel(1)');
									sub.style.cursor = 'pointer';
									sub.textContent = 'Day 1';
								}
							}
						}
					} catch (_) {}

					// 1 
					try { document.querySelectorAll('.nday-panel').forEach(p => { if (p !== base) p.remove(); }); } catch (_) {}
					base.dataset.day = '1';
					base.classList.add('nday-panel');

					const addDayBtn = document.querySelector('.aside-button-typeA');
					const need = Math.max(1, days.length || 1);
					const getPanels = () => Array.from(document.querySelectorAll('.nday-panel'));
					while (getPanels().length < need && addDayBtn) {
						try { template_detail_sdaf(addDayBtn); } catch (_) { break; }
					}

					getPanels().forEach((p, idx) => {
						const dayData = days[idx] || {};
						// 
						const summaryInput = p.querySelector('input.form-control[placeholder="Schedule Summary"]');
						if (summaryInput) summaryInput.value = String(dayData.summary || '');

						// 
						const atts = Array.isArray(dayData.attractions) ? dayData.attractions : [];
						const addSightBtn = p.querySelector('button[onclick*="template_detail_dfghs"]');
						const blocks = () => Array.from(p.querySelectorAll('.dfghs'));
						while (blocks().length < atts.length && addSightBtn) {
							try { template_detail_dfghs(addSightBtn); } catch (_) { break; }
						}
						blocks().slice(0, Math.max(1, atts.length || 1)).forEach((block, bi) => {
							const a = atts[bi] || {};
							//  select( toolbar select  )
							const selects = Array.from(block.querySelectorAll('.meeting-wrap select'));
							if (selects[0]) selects[0].value = String(a.startHour ?? '');
							if (selects[1]) selects[1].value = String(a.startMinute ?? '');
							if (selects[2]) selects[2].value = String(a.endHour ?? '');
							if (selects[3]) selects[3].value = String(a.endMinute ?? '');
							try { selects.forEach(s => s.dispatchEvent(new Event('change', { bubbles: true }))); } catch (_) {}

							const inputs = Array.from(block.querySelectorAll('input.form-control'));
							if (inputs[0]) inputs[0].value = String(a.name || '');
							if (inputs[1]) inputs[1].value = String(a.address || '');
							const ed = block.querySelector('.jweditor');
							if (ed) setEditorHtml(ed, String(a.infoHtml || ''), 12);

							// (/URL)
							// NOTE: block   file input  upload-grid  file input 
							const fileInput = block.querySelector('.upload-grid input[type="file"]');
							//   block.dataset.existingImage   ()
							try { block.dataset.existingImage = String(a.image || ''); } catch (_) {}
							setExistingFile(fileInput, a.image || '');
							const grid = block.querySelector('.upload-grid');
							if (grid) {
								setSinglePreview(grid, a.image || '');
							}
						});

						//
						const meals = dayData.meals || {};
						const mealPanel = Array.from(p.querySelectorAll('.sub-panel')).find(sp => sp.querySelector('[data-lan-eng="Meal Information"]'));
						if (mealPanel) {
							const inputs = Array.from(mealPanel.querySelectorAll('input.form-control'));
							if (inputs[0]) inputs[0].value = String(meals.breakfast || '');
							if (inputs[1]) inputs[1].value = String(meals.lunch || '');
							if (inputs[2]) inputs[2].value = String(meals.dinner || '');
						}
					});
				}

				// 공통 숙박 정보 로드 (Common Accommodation) - 다중 숙소 지원
				(function applyCommonAccommodations() {
					const accommodations = data?.product?.accommodations || [];
					if (!accommodations.length) return;

					const container = document.getElementById('accommodationBlocksContainer');
					if (!container) return;

					// 기존 블록 가져오기
					const existingBlocks = container.querySelectorAll('.accommodation-block');
					const firstBlock = existingBlocks[0];
					if (!firstBlock) return;

					// 첫 번째 숙소 데이터로 첫 번째 블록 채우기
					const fillBlock = (block, accom, idx) => {
						const nameInput = block.querySelector('.accom-name');
						const addrInput = block.querySelector('.accom-address');
						const descEditor = block.querySelector('.accom-description');
						const imageGrid = block.querySelector('.accom-image-grid');

						if (nameInput) nameInput.value = String(accom.name || '');
						if (addrInput) addrInput.value = String(accom.address || '');
						if (descEditor) setEditorHtml(descEditor, String(accom.description || ''), 12);

						// 이미지
						if (accom.image && imageGrid) {
							const fileInput = imageGrid.querySelector('input[type="file"]');
							try { block.dataset.existingImage = String(accom.image || ''); } catch (_) {}
							if (fileInput) setExistingFile(fileInput, accom.image || '');
							setSinglePreview(imageGrid, accom.image || '');
						}

						// 제목 업데이트
						const title = block.querySelector('.accom-block-title');
						if (title) title.textContent = `Accommodation ${idx + 1}`;
						block.dataset.accomIdx = String(idx + 1);
					};

					// 첫 번째 블록 채우기
					fillBlock(firstBlock, accommodations[0], 0);

					// 추가 숙소가 있으면 블록 추가
					for (let i = 1; i < accommodations.length; i++) {
						const newBlock = firstBlock.cloneNode(true);
						newBlock.dataset.accomIdx = String(i + 1);

						// 제목 업데이트
						const title = newBlock.querySelector('.accom-block-title');
						if (title) title.textContent = `Accommodation ${i + 1}`;

						// 삭제 버튼 표시
						const deleteBtn = newBlock.querySelector('button[onclick*="removeAccommodationBlock"]');
						if (deleteBtn) deleteBtn.style.display = '';

						// 입력값 초기화 후 데이터 채우기
						newBlock.querySelectorAll('input.form-control').forEach(inp => {
							inp.value = '';
							inp.removeAttribute('disabled');
						});

						// 에디터 초기화
						const editorEl = newBlock.querySelector('.accom-description');
						if (editorEl) {
							editorEl.innerHTML = '';
							editorEl.removeAttribute('data-quill-ready');
						}

						// 이미지 업로드 초기화
						const imageGrid = newBlock.querySelector('.accom-image-grid');
						if (imageGrid) {
							imageGrid.innerHTML = `
								<div class="upload-item jw-center">
									<label class="inputFile">
										<input type="file" accept="image/*" onchange="filePreview(this);">
										<button type="button" class="btn-upload"><img src="../image/upload3.svg" alt=""> <span data-lan-eng="Image upload">Image upload</span></button>
									</label>
								</div>
							`;
						}

						container.appendChild(newBlock);

						// 에디터 재초기화
						__resetEditors(newBlock);

						// 데이터 채우기
						fillBlock(newBlock, accommodations[i], i);
					}

					// 블록 카운터 업데이트
					accommodationBlockCounter = accommodations.length;

					// 삭제 버튼 가시성 업데이트
					updateAccommodationDeleteButtons();
				})();

				// 공통 교통 정보 로드 (Common Transportation)
				(function applyCommonTransportation() {
					const trans = data?.product?.commonTransportation || {};
					const descEditor = document.getElementById('commonTransEditor');
					if (descEditor) setEditorHtml(descEditor, String(trans.descriptionHtml || ''), 12);
				})();

				// (7)  (/)
				(function applyPricing() {
					const per = Array.isArray(data?.pricing?.perPerson) ? data.pricing.perPerson : [];
					const feePanel =
						Array.from(document.querySelectorAll('.card-panel')).find(p => p.querySelector('.grid-wrap-title[data-lan-eng="Number of people fee"]'));
					if (feePanel) {
						const addBtn = feePanel.querySelector('button.jw-button.typeA');
						// rows 
						const rows = () => Array.from(feePanel.querySelectorAll('tbody tr'));
						while (rows().length < per.length && addBtn) { try { addBtn.click(); } catch (_) { break; } }
						rows().forEach((tr, i) => {
							const item = per[i] || null;
							if (!item) return;
							const inputs = Array.from(tr.querySelectorAll('input.form-control'));
							if (inputs[0]) inputs[0].value = String(item.optionName || '');
							if (inputs[1]) inputs[1].value = String(item.price || '');
						});
					}
					const singleFee = String(data?.pricing?.singleRoomFee || '').trim();
					{
						const p =
							Array.from(document.querySelectorAll('.card-panel')).find(x => x.querySelector('.grid-wrap-title[data-lan-eng="Room rate for single occupancy"]'));
						const inp = p?.querySelector('input.form-control');
						if (inp) inp.value = singleFee;
					}
				})();

				// (8) /
				(function applyIncExc() {
					const fillTable = (title, arr) => {
						const panel =
							Array.from(document.querySelectorAll('.card-panel')).find(p => p.querySelector(`.grid-wrap-title[data-lan-eng="${CSS.escape(title)}"]`));
						if (!panel) return;
						const addBtn = panel.querySelector('button.jw-button.typeA');
						const rows = () => Array.from(panel.querySelectorAll('tbody tr'));
						while (rows().length < arr.length && addBtn) { try { addBtn.click(); } catch (_) { break; } }
						const inputs = Array.from(panel.querySelectorAll('tbody input.form-control'));
						arr.forEach((txt, i) => { if (inputs[i]) inputs[i].value = String(txt || ''); });
					};
					fillTable('Included items', Array.isArray(data?.included) ? data.included : []);
					fillTable('Excluded items', Array.isArray(data?.excluded) ? data.excluded : []);
				})();

				// (9) ( +  PDF)
				(function applyUsageGuide() {
					const panel = findPanelByLanH2('Usage Guide');
					if (!panel) return;
					const eds = Array.from(panel.querySelectorAll('.jweditor'));
					const ed = eds[eds.length - 1];
					if (ed) setEditorHtml(ed, String(data?.usageGuide?.descriptionHtml || ''), 12);
					const file = panel.querySelector('input[type="file"]');
					const f = data?.usageGuide?.file || null;
					if (file && f && (f.filePath || f.fileName)) {
						setExistingFile(file, String(f.filePath || f.fileName), { name: f.originalName || f.fileName, size: f.fileSize });
						try { noticeUploadChange(file); } catch (_) {}
					}
				})();

				// (10) /( + )
				(function applyCancel() {
					const panel = findPanelByLanH2('Cancellation/Refund Policy');
					if (!panel) return;
					const input = panel.querySelector('input.form-control');
					const days = data?.cancellationPolicy?.refundDays;
					if (input && days != null) input.value = String(days);
					const eds = Array.from(panel.querySelectorAll('.jweditor'));
					const ed = eds[eds.length - 1];
					if (ed) setEditorHtml(ed, String(data?.cancellationPolicy?.descriptionHtml || ''), 12);
				})();

				// (11)   ()
				(function applyVisa() {
					const panel = findPanelByLanH2('Visa Application Guide');
					if (!panel) return;
					const eds = Array.from(panel.querySelectorAll('.jweditor'));
					const ed = eds[eds.length - 1];
					if (ed) setEditorHtml(ed, String(data?.visaGuide?.descriptionHtml || ''), 12);
				})();

				// : jw_select( select)   +   (   )
				try { __resetSelectWidgets(document.querySelector('.content-main') || document); } catch (_) {}
				setTimeout(() => {
					try { __resetSelectWidgets(document.querySelector('.content-main') || document); } catch (_) {}
					try {
						//           
						if (descEd) setEditorHtml(descEd, descHtml, 12);
					} catch (_) {}
				}, 150);

				//  
				try { modal_close(); } catch (_) {}
			};

			// 
			if (btn) btn.addEventListener('click', () => fetchTemplates(input?.value || ''));
			if (input) input.addEventListener('keydown', (e) => {
				if (e.key === 'Enter') {
					e.preventDefault();
					fetchTemplates(input.value || '');
				}
			});
			if (loadBtn) loadBtn.addEventListener('click', async () => {
				try {
					if (!selectedId) return;
					loadBtn.disabled = true;
					await applyTemplateToProductForm(selectedId);
				} catch (e) {
					console.error(e);
					alert(e?.message || '    .');
					loadBtn.disabled = false;
				}
			});

			//  
			fetchTemplates('');
		});

		// Test Fill ( DOMContentLoaded  )
		function bindTestFill() {
			const btn = document.getElementById('testFillBtn');
							if (!btn) return;
			btn.addEventListener('click', () => {
				try {
					//  :  Test fill  3  .
					// - Flight Information
					// - Sales Information
					// - Daily Sales Adjustment

					const randInt = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
					const pick = (arr) => arr[randInt(0, arr.length - 1)];
					const dispatch = (el, type) => { try { el?.dispatchEvent?.(new Event(type, { bubbles: true })); } catch (_) {} };
					const fmtDate = (d) => `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}`;
					const fmtMoney = (n) => Number(n || 0).toLocaleString('en-US');

					// 1) Flight Information (/)
					(function fillFlights() {
						const panels = Array.from(document.querySelectorAll('[data-section-name="flight-information"].card-panel'));
						const pickPanel = (kind) => {
							return panels.find(p => {
								const h3 = p.querySelector('h3.grid-wrap-title');
								const eng = h3?.getAttribute?.('data-lan-eng') || '';
								const text = (h3?.textContent || '').trim();
								if (kind === 'departure') return eng === 'Departure flight' || /departure/i.test(text);
								return eng === 'Return trip' || /return/i.test(text);
							});
						};
						const fillOne = (panel, prefix, from, to) => {
							if (!panel) return;
							const inputs = Array.from(panel.querySelectorAll('input.form-control'));
							const selects = Array.from(panel.querySelectorAll('select'));
							if (inputs[0]) inputs[0].value = `${prefix}${randInt(100, 999)}`;

							const depH = String(randInt(0, 23)).padStart(2, '0');
							const depM = pick(['00', '10', '20', '30', '40', '50']);
							const arrH = String(randInt(0, 23)).padStart(2, '0');
							const arrM = pick(['00', '10', '20', '30', '40', '50']);
							if (selects[0]) selects[0].value = depH;
							if (selects[1]) selects[1].value = depM;
							if (selects[2]) selects[2].value = arrH;
							if (selects[3]) selects[3].value = arrM;
							selects.forEach(s => dispatch(s, 'change'));

							if (inputs[1]) inputs[1].value = from;
							if (inputs[2]) inputs[2].value = to;
						};

						fillOne(pickPanel('departure'), 'PR', 'Manila (MNL)', 'Incheon (ICN)');
						fillOne(pickPanel('return'), 'PR', 'Incheon (ICN)', 'Manila (MNL)');
					})();

					// 2) Sales Information (  /    /   /   )
					(function fillSalesInfo() {
						const panel = Array.from(document.querySelectorAll('.card-panel'))
							.find(p => p.querySelector('.grid-wrap-title[data-lan-eng="Basic Sales Information"]'));
						if (!panel) return;

						const contract = document.getElementById('contract-period') || panel.querySelector('#contract-period');
						if (contract) {
							const start = new Date();
							start.setDate(start.getDate() + randInt(1, 20));
							const days = randInt(2, 30); // < 100
							const end = new Date(start);
							end.setDate(start.getDate() + days);
							contract.value = `${fmtDate(start)} ~ ${fmtDate(end)}`;
							dispatch(contract, 'change');
						}

						const setByLabelEng = (labelEng, value) => {
							const span = panel.querySelector(`.label-name [data-lan-eng="${CSS.escape(labelEng)}"]`);
							const grid = span ? span.closest('.grid-item') : null;
							const input = grid?.querySelector('input.form-control');
							if (input) input.value = value;
						};
						setByLabelEng('Minimum departure headcount', String(randInt(1, 10)));
						setByLabelEng('Maximum capacity', String(randInt(10, 60)));
						setByLabelEng('Basic Airfare (₱)', fmtMoney(randInt(12000, 50000)));
					})();

					// 3) Daily Sales Adjustment (   / )
					(function fillDailyAdjustment() {
						const panel = document.querySelector('[data-section-name="iljastar"]');
						if (!panel) return;
						Array.from(panel.querySelectorAll('tbody tr')).forEach((tr) => {
							const inputs = Array.from(tr.querySelectorAll('input.form-control'));
							// [0]= , [1]= 
							if (inputs[0]) inputs[0].value = String(randInt(1, 60));
							if (inputs[1]) inputs[1].value = fmtMoney(randInt(12000, 50000));
						});
					})();

					alert('Test fill done: only Flight / Sales / Daily Sales Adjustment were filled.');
				} catch (e) {
					console.error('Test fill error:', e);
					alert(`Test fill failed: ${e?.message || e}`);
				}
			}, { once: false });
		}

		if (document.readyState === 'loading') {
			document.addEventListener('DOMContentLoaded', bindTestFill, { once: true });
					} else {
			bindTestFill();
		}

		// Create     (:     )
		(function clearCreateDefaults() {
			const isCreate = () => {
				const params = new URLSearchParams(window.location.search);
				const id = params.get('id');
				const mode = params.get('mode');
				if (id) return false; // (id )  
				if (mode && mode !== 'create') return false;
				return true;
			};

			const resetCreate = () => {
				try {
					if (!isCreate()) return;

					const main = document.querySelector('.content-main') || document;

					// 0)   : create    "  "    
					// - Flight Information
					// - Daily Sales Adjustment
					// - Included/Not Included Items
					try {
						['flight-information', 'iljastar', 'poham'].forEach((sec) => {
							//   
							document.querySelectorAll(`[data-section-name="${sec}"]`).forEach(el => el.classList.add('hidden'));
							//    plus(on)  
							const btn = document.querySelector(`button.aside-add-section[data-target-section="${sec}"]`);
							if (btn) {
								btn.classList.add('on');
								const img = btn.querySelector('img');
								if (img) { img.src = '../image/plus.svg'; img.alt = 'plus'; }
							}
						});
					} catch (_) {}

					// 1) /  
					__resetInputs(main);
					__clearEditorsContent(main);

					// 2) (/////) /  
					main.querySelectorAll('.upload-item.is-filled').forEach(el => el.remove());
					main.querySelectorAll('input[type="file"]').forEach(inp => {
						try {
							delete inp.dataset.existing;
							delete inp.dataset.existingName;
							delete inp.dataset.existingSize;
						} catch (_) {}
					});
					//    
					main.querySelectorAll('input[type="file"][onchange*="noticeUploadChange"]').forEach(inp => {
						try { noticeUploadChange(inp); } catch (_) {}
					});

					// 3) : 1 ,   1 
					const base = document.getElementById('nday');
					if (base) {
						//      
						document.querySelectorAll('.nday-panel').forEach((p) => {
							if (p === base) return;
							p.remove();
						});
						base.dataset.day = '1';
						base.classList.add('nday-panel');
						//   1
						const sub = base.querySelector('.sub-panel');
						if (sub) {
							const blocks = Array.from(sub.querySelectorAll('.dfghs'));
							blocks.slice(1).forEach(b => b.remove());
						}
					}

					// 4)    1 ()
					const dayList = document.querySelector('.aside-row-list');
					if (dayList) {
						const rows = Array.from(dayList.querySelectorAll('.aside-row'));
						rows.slice(1).forEach(r => r.remove());
					}

					// 5) 1  placeholder (  )
					const cat1 = document.getElementById('mainCategory');
					if (cat1) cat1.selectedIndex = 0;
					try { template_detail_sdaf_cate(); } catch (_) {}

					// 6) jw_select   cloneNode   
					// -          Day1   
					if (base) __resetSelectWidgets(base);
					else __resetSelectWidgets(main);

					// 7)   :   0   +   
					try {
						const panel = document.querySelector('[data-section-name="iljastar"]');
						const tbody = panel?.querySelector('tbody');
						if (tbody) tbody.innerHTML = '';
						panel?.querySelectorAll('.cal-day.is-selected').forEach(el => el.classList.remove('is-selected'));
					} catch (_) {}
				} catch (e) {
					console.warn('clearCreateDefaults failed:', e);
				}
			};

			// datepicker/multi-editor/jw_select DOMContentLoaded     2 ( + )
			const run = () => {
				resetCreate();
				setTimeout(resetCreate, 80);
				setTimeout(resetCreate, 250);
			};
			if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', run, { once: true });
			else run();
		})();

		//   (Daily Sales Adjustment)
		// -  (contract-period)   
		// - :  0
		// -       /
		(function initDailySalesAdjustment() {
			const panel = document.querySelector('[data-section-name="iljastar"]');
			if (!panel) return;
			const calRow = panel.querySelector('.calendar-row');
			const tbody = panel.querySelector('tbody');
			const contract = document.getElementById('contract-period');
			if (!calRow || !tbody || !contract) return;

			const state = {
				selected: new Set(), // date string(YYYY-MM-DD)
				values: {} // { [date]: { capacity: string, fee: string } }
			};

			const pad2 = (n) => String(n).padStart(2, '0');
			const fmtDate = (d) => `${d.getFullYear()}-${pad2(d.getMonth() + 1)}-${pad2(d.getDate())}`;
			const parseRange = () => {
				const raw = String(contract.value || '').trim();
				// : "YYYY-MM-DD ~ YYYY-MM-DD"   
				const m = raw.match(/(\d{4}-\d{2}-\d{2})/g);
				if (!m || !m.length) return null;
				const start = new Date(m[0] + 'T00:00:00');
				const end = new Date((m[1] || m[0]) + 'T00:00:00');
				if (Number.isNaN(start.getTime()) || Number.isNaN(end.getTime())) return null;
				if (start > end) return { start: end, end: start };
				return { start, end };
			};
			const inRange = (dateStr, range) => {
				if (!range) return false;
				const d = new Date(dateStr + 'T00:00:00');
				if (Number.isNaN(d.getTime())) return false;
				return d >= range.start && d <= range.end;
			};
			const monthLabel = (y, m0) => {
				// UI        
				const names = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
				return `${names[m0]} ${y}`;
			};
			const buildMonth = (year, month0, range) => {
				const first = new Date(year, month0, 1);
				const last = new Date(year, month0 + 1, 0);
				const firstDow = first.getDay(); // 0=sun
				const total = last.getDate();
				const cells = [];
				for (let i = 0; i < firstDow; i++) cells.push('<div class="cal-day is-empty"></div>');
				for (let day = 1; day <= total; day++) {
					const d = new Date(year, month0, day);
					const ds = fmtDate(d);
					const dow = d.getDay();
					const cls = [];
					cls.push('cal-day');
					if (dow === 0) cls.push('is-sun');
					if (dow === 6) cls.push('is-sat');
					const ok = inRange(ds, range);
					if (ok) cls.push('is-in-range');
					else cls.push('is-disabled');
					if (state.selected.has(ds)) cls.push('is-selected');
					cells.push(`<div class="${cls.join(' ')}" data-date="${ds}"><time datetime="${ds}">${day}</time></div>`);
				}
				return `
					<div class="cal-month">
						<div class="cal-header">${monthLabel(year, month0)}</div>
						<div class="cal-head"><div>S</div><div>M</div><div>T</div><div>W</div><div>T</div><div>F</div><div>S</div></div>
						<div class="cal-body">${cells.join('')}</div>
					</div>
				`;
			};
			const renderCalendar = () => {
				const range = parseRange();
				if (!range) {
					calRow.innerHTML = `<div style="padding:12px; color:#6b7280;">Please select a sale period first.</div>`;
					return;
				}
				//   ( 6)
				const months = [];
				let y = range.start.getFullYear();
				let m = range.start.getMonth();
				const endY = range.end.getFullYear();
				const endM = range.end.getMonth();
				let guard = 0;
				while (guard++ < 6) {
					months.push({ y, m });
					if (y === endY && m === endM) break;
					m += 1;
					if (m > 11) { m = 0; y += 1; }
				}
				calRow.innerHTML = months.map(({ y, m }) => `<div>${buildMonth(y, m, range)}</div>`).join('');
			};

			const renumber = () => {
				Array.from(tbody.querySelectorAll('tr')).forEach((tr, idx) => {
					const td = tr.querySelector('td.no');
					if (td) td.textContent = String(idx + 1);
				});
			};
			const rebuildTable = () => {
				const dates = Array.from(state.selected).sort(); // YYYY-MM-DD lexical sort = date sort
				const canEditFare = (function () {
					const t = document.querySelector('button[data-target-section="flight-information"]');
					// default.js: on=true => hidden(plus icon), on=false => shown(minus icon)
					return !(t && t.classList.contains('on'));
				})();
				tbody.innerHTML = dates.map((ds, idx) => {
					const v = state.values[ds] || {};
					return `
						<tr data-date="${ds}">
							<td class="no is-center">${idx + 1}</td>
							<td class="is-center">${ds}</td>
							<td class="is-center"><div class="cell"><input type="text" class="form-control" value="${String(v.capacity || '').replace(/"/g, '&quot;')}" min="0" placeholder="Enter numbers"></div></td>
							<td class="is-center"><div class="cell"><input type="text" class="form-control" value="${String(v.fee || '').replace(/"/g, '&quot;')}" inputmode="numeric" placeholder="Enter numbers" ${canEditFare ? '' : 'disabled'}></div></td>
						</tr>
					`;
				}).join('');
			};
			const getBaseFare = () => {
				//      input(id edit    )
				const baseFare = document.getElementById('baseFlightFare') || null;
				const raw = String(baseFare?.value || '').trim();
				return raw;
			};

			//    state (  )
			tbody.addEventListener('input', (e) => {
				const tr = e.target?.closest?.('tr');
				const ds = tr?.getAttribute?.('data-date');
				if (!ds) return;
				const inputs = Array.from(tr.querySelectorAll('input.form-control'));
				state.values[ds] = state.values[ds] || {};
				state.values[ds].capacity = String(inputs[0]?.value || '');
				state.values[ds].fee = String(inputs[1]?.value || '');
			});

			//  ()
			calRow.addEventListener('click', (e) => {
				const cell = e.target?.closest?.('.cal-day');
				if (!cell) return;
				if (cell.classList.contains('is-disabled') || cell.classList.contains('is-empty')) return;
				const ds = String(cell.getAttribute('data-date') || cell.querySelector('time')?.getAttribute('datetime') || '').trim();
				if (!ds) return;
				const range = parseRange();
				if (!inRange(ds, range)) return;

				if (state.selected.has(ds)) {
					state.selected.delete(ds);
					cell.classList.remove('is-selected');
					//  (   )
				} else {
					state.selected.add(ds);
					cell.classList.add('is-selected');
					//        ( )
					state.values[ds] = state.values[ds] || {};
					{
						const t = document.querySelector('button[data-target-section="flight-information"]');
						const canEditFare = !(t && t.classList.contains('on'));
						if (canEditFare && !state.values[ds].fee) state.values[ds].fee = getBaseFare() || '';
					}
				}
				rebuildTable();
				renumber();
			});

			const clearIfCreate = () => {
				const params = new URLSearchParams(window.location.search);
				const id = params.get('id');
				const mode = params.get('mode');
				const isCreate = !id && (!mode || mode === 'create');
				if (!isCreate) return;
				state.selected.clear();
				state.values = {};
				tbody.innerHTML = '';
			};

			const refresh = () => {
				clearIfCreate();
				renderCalendar();
				rebuildTable();
				renumber();
			};

			// datepicker value   ( )
			const run = () => {
				refresh();
				setTimeout(refresh, 120);
				setTimeout(refresh, 500);
			};
			contract.addEventListener('change', run);
			contract.addEventListener('input', run);
			// daterangepicker input   change       
			try {
				if (window.jQuery) {
					window.jQuery(contract).on('apply.daterangepicker cancel.daterangepicker', run);
				}
			} catch (_) {}
			if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', run, { once: true });
			else run();
		})();

		// Flight time minute selects: enable 1-minute step (00~59) for product registration
		(function patchFlightMinuteSelects1() {
			const buildMinuteOptions = () => {
				const opts = [];
				for (let i = 0; i < 60; i++) {
					const v = String(i).padStart(2, '0');
					opts.push(`<option value="${v}">${v}</option>`);
				}
				return opts.join('');
			};
			const apply = () => {
				try {
					const panels = Array.from(document.querySelectorAll('[data-section-name="flight-information"].card-panel'));
					const html = buildMinuteOptions();
					panels.forEach((p) => {
						// flight panels have 4 selects inside .meeting-wrap: [depH, depM, arrH, arrM]
						const sels = Array.from(p.querySelectorAll('.meeting-wrap select'));
						const min1 = sels[1] || null;
						const min2 = sels[3] || null;
						[min1, min2].forEach((sel) => {
							if (!sel) return;
							const cur = String(sel.value || '').trim();
							sel.innerHTML = html;
							if (cur) sel.value = cur; // keep existing selection if possible
						});
					});
					// re-init jw_select UI
					try { __resetSelectWidgets(document.querySelector('.content-main') || document); } catch (_) {}
					try { if (typeof jw_select === 'function') jw_select(); } catch (_) {}
				} catch (_) {}
			};

			if (document.readyState === 'loading') {
				document.addEventListener('DOMContentLoaded', () => {
					apply();
					setTimeout(apply, 120);
					setTimeout(apply, 500);
				}, { once: true });
			} else {
				apply();
				setTimeout(apply, 120);
			}
		})();

		// Flight time hour selects: ensure 00~23 are present (some publishing HTML had missing hours)
		(function patchFlightHourSelects1() {
			const buildHourOptions = () => {
				const opts = [];
				for (let i = 0; i < 24; i++) {
					const v = String(i).padStart(2, '0');
					opts.push(`<option value="${v}">${v}</option>`);
				}
				return opts.join('');
			};
			const apply = () => {
				try {
					const panels = Array.from(document.querySelectorAll('[data-section-name="flight-information"].card-panel'));
					const html = buildHourOptions();
					panels.forEach((p) => {
						// flight panels have 4 selects inside .meeting-wrap: [depH, depM, arrH, arrM]
						const sels = Array.from(p.querySelectorAll('.meeting-wrap select'));
						const h1 = sels[0] || null;
						const h2 = sels[2] || null;
						[h1, h2].forEach((sel) => {
							if (!sel) return;
							const cur = String(sel.value || '').trim();
							sel.innerHTML = html;
							if (cur) sel.value = cur;
						});
					});
					try { __resetSelectWidgets(document.querySelector('.content-main') || document); } catch (_) {}
					try { if (typeof jw_select === 'function') jw_select(); } catch (_) {}
				} catch (_) {}
			};

			if (document.readyState === 'loading') {
				document.addEventListener('DOMContentLoaded', () => {
					apply();
					setTimeout(apply, 120);
					setTimeout(apply, 500);
				}, { once: true });
			} else {
				apply();
				setTimeout(apply, 120);
			}
		})();

		// Edit : DB  " "   ( )
		(async function loadEditIfNeeded() {
			const params = new URLSearchParams(window.location.search);
			const id = Number(params.get('id') || 0);
			if (!id) return;

			try {
				const res = await fetch(`../../backend/api/package-detail.php?id=${encodeURIComponent(String(id))}`, { credentials: 'same-origin' });
				const json = await res.json().catch(() => ({}));
				if (!res.ok || !json.success) throw new Error(json?.message || `   (HTTP ${res.status})`);

				const data = json.data || {};
				const pkg = data.package || {};
				const schedules = Array.isArray(data.schedules) ? data.schedules : [];
				const flights = Array.isArray(data.flights) ? data.flights : [];
				const pricingOptions = Array.isArray(data.pricingOptions) ? data.pricingOptions : [];
				const availability = Array.isArray(data.availability) ? data.availability : [];
				const guides = Array.isArray(data.guides) ? data.guides : [];

				const mapMainToUi = { season: '', region: '', theme: '' };

				//   
				if (document.getElementById('productName')) document.getElementById('productName').value = pkg.packageName || '';
				if (document.getElementById('salesTarget')) document.getElementById('salesTarget').value = pkg.sales_target || 'B2B';
				if (document.getElementById('mainCategory')) {
					const uiMain = mapMainToUi[pkg.packageCategory] || pkg.packageCategory || '';
					document.getElementById('mainCategory').value = uiMain;
					try { document.getElementById('mainCategory').dispatchEvent(new Event('change', { bubbles: true })); } catch (_) {}
				}
				if (document.getElementById('subCategory')) {
					const subSel = document.getElementById('subCategory');
					subSel.disabled = false;
					const wanted = String(pkg.subCategory || '');
					if (wanted) {
						const opt = Array.from(subSel.options).find(o => String(o.value || o.textContent || '').toLowerCase() === wanted.toLowerCase());
						if (opt) subSel.value = opt.value;
						else subSel.value = wanted;
					}
				}
				const descEd = document.getElementById('productDescriptionEditor');
				if (descEd) descEd.innerHTML = pkg.packageDescription || '';

				//  
				const contract = document.getElementById('contract-period');
				if (contract) {
					const s = String(pkg.sales_start_date || '').trim();
					const e = String(pkg.sales_end_date || '').trim();
					if (s && e) contract.value = `${s} ~ ${e}`;
					else if (pkg.sales_period) contract.value = String(pkg.sales_period);
				}
				const minP = document.getElementById('minParticipants');
				if (minP) minP.value = pkg.minParticipants ?? '';
				const maxP = document.getElementById('maxParticipants');
				if (maxP) maxP.value = pkg.maxParticipants ?? '';
				const baseFare = document.getElementById('baseFlightFare');
				if (baseFare) baseFare.value = pkg.base_price ?? '';

				//  
				{
					const feePanel = Array.from(document.querySelectorAll('.card-panel')).find(p => (p.querySelector('.grid-wrap-title')?.textContent || '').includes(''));
					const input = feePanel?.querySelector('input.form-control');
					if (input && pkg.single_room_fee != null) input.value = String(pkg.single_room_fee);
				}

				//  (//): "is-filled"  prepend      
				// NOTE: /    (setSinglePreview) 
				const setUploadPreview = (gridItemLabel, filename) => {
					const item = Array.from(document.querySelectorAll('.grid-item')).find(el => (el.querySelector('.label-name')?.textContent || '').includes(gridItemLabel));
					const grid = item?.querySelector('.upload-grid');
					if (!grid) return;
					const inp = item?.querySelector('input[type="file"]') || null;
					if (inp && filename) setExistingFile(inp, filename);
					setSinglePreview(grid, filename || '');
				};
				setUploadPreview('', pkg.thumbnail_image);
				setUploadPreview('  ', pkg.detail_image);

				//  ( 5)
				try {
					const imgs = JSON.parse(pkg.product_images || '[]');
					if (Array.isArray(imgs)) {
						//          ,
						// label   prepend  ,  setSinglePreview  (   X) 
						//          slot      .
						imgs.slice(0, 1).forEach((fn) => setUploadPreview(' ', fn));
					}
				} catch (_) { }

				// (/)
				const byType = {};
				flights.forEach(f => { byType[f.flight_type] = f; });
				const fillFlight = (title, obj) => {
					const panels = Array.from(document.querySelectorAll('[data-section-name="flight-information"].card-panel'));
					const panel = panels.find(p => (p.querySelector('h3')?.textContent || '').includes(title));
					if (!panel || !obj) return;
					// textInputs: [0]=Flight number, [1]=Departure point, [2]=Destination
					const textInputs = Array.from(panel.querySelectorAll('input.form-control'));
					// Airline은 별도 select (.airline-select)
					const airlineSelect = panel.querySelector('.airline-select');
					// 시간 select들 (.meeting-wrap 내부)
					const timeSelects = Array.from(panel.querySelectorAll('.meeting-wrap select'));
					if (textInputs[0]) textInputs[0].value = obj.flight_number || '';
					if (airlineSelect) airlineSelect.value = obj.airline_name || '';
					if (timeSelects[0] && obj.departure_time) timeSelects[0].value = String(obj.departure_time).slice(0, 2);
					if (timeSelects[1] && obj.departure_time) timeSelects[1].value = String(obj.departure_time).slice(3, 5);
					if (timeSelects[2] && obj.arrival_time) timeSelects[2].value = String(obj.arrival_time).slice(0, 2);
					if (timeSelects[3] && obj.arrival_time) timeSelects[3].value = String(obj.arrival_time).slice(3, 5);
					if (textInputs[1]) textInputs[1].value = obj.departure_point || '';
					if (textInputs[2]) textInputs[2].value = obj.destination || '';
				};
				fillFlight('', byType.departure);
				fillFlight('', byType.return);

				//   (   )
				(function () {
					const panel = document.querySelector('[data-section-name="iljastar"]');
					if (!panel) return;
					const map = {};
					availability.forEach(a => { if (a.availableDate) map[String(a.availableDate)] = a; });
					const rows = Array.from(panel.querySelectorAll('tbody tr'));
					rows.forEach((tr) => {
						const tds = Array.from(tr.querySelectorAll('td'));
						const date = String(tds[1]?.textContent || '').trim();
						const a = map[date];
						if (!a) return;
						const inputs = Array.from(tr.querySelectorAll('input.form-control'));
						if (inputs[0] && a.availableSeats != null) inputs[0].value = String(a.availableSeats);
						if (inputs[1] && a.price != null) inputs[1].value = String(a.price);
					});
				})();

				//  
				(function () {
					const feePanel = Array.from(document.querySelectorAll('.card-panel')).find(p => (p.querySelector('.grid-wrap-title')?.textContent || '').includes(' '));
					if (!feePanel) return;
					const tbody = feePanel.querySelector('tbody');
							if (!tbody) return;
					//  1  
							tbody.innerHTML = '';
					pricingOptions.forEach((opt, i) => {
								const tr = document.createElement('tr');
								tr.innerHTML = `
							<td class="is-center">${i + 1}</td>
							<td class="is-center"><div class="cell"><input type="text" class="form-control" value="${String(opt.option_name || '').replace(/"/g, '&quot;')}" placeholder="Option name"></div></td>
							<td class="is-center"><div class="cell"><input type="text" class="form-control" value="${String(opt.price ?? '')}" inputmode="numeric" placeholder="Enter numbers"></div></td>
							<td class="is-center">
								<button type="button" class="btn w-auto" onclick="template_detail_sfg1d(this)" aria-label="row delete"><img src="../image/trash.svg" alt=""></button>
							</td>
								`;
								tbody.appendChild(tr);
							});
					if (pricingOptions.length === 0) {
							const tr = document.createElement('tr');
							tr.innerHTML = `
							<td class="is-center">1</td>
							<td class="is-center"><div class="cell"><input type="text" class="form-control" value="" placeholder="Option name"></div></td>
							<td class="is-center"><div class="cell"><input type="text" class="form-control" value="" inputmode="numeric" placeholder="Enter numbers"></div></td>
							<td class="is-center">
								<button type="button" class="btn w-auto" onclick="template_detail_sfg1d(this)" aria-label="row delete"><img src="../image/trash.svg" alt=""></button>
							</td>
						`;
						tbody.appendChild(tr);
					}
				})();

				// /(   )
				const fillLinesToTable = (panelTitle, text) => {
					const panels = Array.from(document.querySelectorAll('.card-panel'));
					const panel = panels.find(p => (p.querySelector('.grid-wrap-title')?.textContent || '').includes(panelTitle));
					if (!panel) return;
					const tbody = panel.querySelector('tbody');
							if (!tbody) return;
					const lines = String(text || '').split('\n').map(s => s.trim()).filter(Boolean);
							tbody.innerHTML = '';
					const ensureRow = (val, i) => {
								const tr = document.createElement('tr');
								tr.innerHTML = `
							<td class="is-center">${i + 1}</td>
							<td class="is-center"><div class="cell"><input type="text" class="form-control" value="${val.replace(/"/g, '&quot;')}" placeholder="Please enter your content"></div></td>
							<td class="is-center jw-center">
								<button type="button" class="jw-button" aria-label="row delete" onclick="trash_typeA(this);"><img src="../image/trash.svg" alt=""></button>
							</td>
								`;
								tbody.appendChild(tr);
					};
					if (lines.length === 0) ensureRow('', 0);
					else lines.forEach((v, i) => ensureRow(v, i));
				};
				fillLinesToTable(' ', pkg.included_items);
				fillLinesToTable(' ', pkg.excluded_items);

				// /() - day  /
				const wantDays = schedules.length || 1;
				const getDayPanels = () => Array.from(document.querySelectorAll('.nday-panel'));
				while (getDayPanels().length < wantDays) {
					try { template_detail_sdaf(document.querySelector('.aside-button-typeA')); } catch (_) { break; }
				}
				const dayPanelsNow = getDayPanels();
				schedules.forEach((sc, idx) => {
					const dayPanel = dayPanelsNow[idx];
					if (!dayPanel) return;
					dayPanel.querySelector('input.form-control[placeholder="Schedule Summary"]')?.setAttribute('value', '');
					const sumInput = dayPanel.querySelector('input.form-control[placeholder="Schedule Summary"]');
					if (sumInput) sumInput.value = sc.description || '';

					//   
					const attList = Array.isArray(sc.attractions) ? sc.attractions : [];
					const blocks = Array.from(dayPanel.querySelectorAll('.dfghs'));
					const addBtn = Array.from(dayPanel.querySelectorAll('button')).find(b => (b.textContent || '').includes(' '));
					while (blocks.length < attList.length && addBtn) {
						try { template_detail_dfghs(addBtn); } catch (_) { break; }
						blocks.push(...Array.from(dayPanel.querySelectorAll('.dfghs')).slice(blocks.length));
					}
					const finalBlocks = Array.from(dayPanel.querySelectorAll('.dfghs'));
					attList.forEach((a, i) => {
						const block = finalBlocks[i];
						if (!block) return;
						block.dataset.existingImage = a.attraction_image || '';
						const inputs = Array.from(block.querySelectorAll('input.form-control'));
						if (inputs[0]) inputs[0].value = a.attraction_name || '';
						if (inputs[1]) inputs[1].value = a.attraction_address || '';
						const ed = block.querySelector('.jweditor');
						if (ed) ed.innerHTML = a.attraction_description || '';
						//  : input.dataset.existing  +    
						{
							const grid = block.querySelector('.upload-grid');
							const fileInput = grid?.querySelector('input[type="file"]') || null;
							if (fileInput) setExistingFile(fileInput, a.attraction_image || '');
							if (grid) setSinglePreview(grid, a.attraction_image || '');
						}
					});

					// //
					const accomPanel = Array.from(dayPanel.querySelectorAll('.sub-panel')).find(sp => (sp.querySelector('h4')?.textContent || '').includes(''));
					if (accomPanel) {
						const inputs = Array.from(accomPanel.querySelectorAll('input.form-control'));
						if (inputs[0]) inputs[0].value = sc.accommodation_name || '';
						if (inputs[1]) inputs[1].value = sc.accommodation_address || '';
						const ed = accomPanel.querySelector('.jweditor');
						if (ed) ed.innerHTML = sc.accommodation_description || '';
						//  : input.dataset.existing  +    
						{
							const grid = accomPanel.querySelector('.upload-grid');
							const fileInput = grid?.querySelector('input[type="file"]') || null;
							if (fileInput) setExistingFile(fileInput, sc.accommodation_image || '');
							if (grid) setSinglePreview(grid, sc.accommodation_image || '');
							accomPanel.dataset.existingImage = sc.accommodation_image || '';
						}
					}
					const transPanel = Array.from(dayPanel.querySelectorAll('.sub-panel')).find(sp => (sp.querySelector('h4')?.textContent || '').includes(''));
					if (transPanel) {
						const ed = transPanel.querySelector('.jweditor');
						if (ed) ed.innerHTML = sc.transportation_description || '';
					}
					const mealPanel = Array.from(dayPanel.querySelectorAll('.sub-panel')).find(sp => (sp.querySelector('h4')?.textContent || '').includes(''));
					if (mealPanel) {
						const inputs = Array.from(mealPanel.querySelectorAll('input.form-control'));
						if (inputs[0]) inputs[0].value = sc.breakfast || '';
						if (inputs[1]) inputs[1].value = sc.lunch || '';
						if (inputs[2]) inputs[2].value = sc.dinner || '';
					}
				});

				// //()
				const guideMap = {};
				guides.forEach(g => { if (g.guide_type) guideMap[g.guide_type] = g; });
				const setSectionEditor = (title, html) => {
					const h2 = Array.from(document.querySelectorAll('h2.section-title')).find(el => (el.textContent || '').includes(title));
					const panel = h2?.nextElementSibling;
					if (!panel) return;
					const eds = Array.from(panel.querySelectorAll('.jweditor'));
					const ed = eds[eds.length - 1];
					if (ed) ed.innerHTML = html || '';
				};
				setSectionEditor('', guideMap.usage?.guide_description || '');
				setSectionEditor('/', guideMap.cancellation?.guide_description || '');
				setSectionEditor(' ', guideMap.visa?.guide_description || '');

				// / 
				if (pkg.refund_days != null) {
					const h2 = Array.from(document.querySelectorAll('h2.section-title')).find(el => (el.textContent || '').includes('/'));
					const panel = h2?.nextElementSibling;
					const input = panel?.querySelector('input.form-control');
					if (input) input.value = String(pkg.refund_days);
				}

				//    input    →  ( UI )
				// (      backend   )

			} catch (e) {
				console.error('loadEditIfNeeded failed:', e);
				alert(e?.message || '     .');
			}
		})();

		// ============================================
		// Sight Management Integration
		// ============================================

		// Store reference to the button that triggered the modal
		let _currentSightBtn = null;

		function openSightSelectModal(btn) {
			_currentSightBtn = btn;
			modal('sight-select-modal.html', '650px', '600px');
		}

		// Called from modal when multiple sights are selected
		function handleSightsSelected(sights) {
			if (!Array.isArray(sights) || sights.length === 0 || !_currentSightBtn) return;

			// Find the sub-panel containing the button
			const subPanel = _currentSightBtn.closest('.sub-panel');
			if (!subPanel) return;

			// Get existing dfghs blocks
			let existingBlocks = Array.from(subPanel.querySelectorAll('.dfghs'));

			// Remove all existing blocks except the first one (we'll reuse or clear it)
			existingBlocks.slice(1).forEach(block => block.remove());

			// Process each sight
			sights.forEach((sight, index) => {
				let block;

				if (index === 0) {
					// Use the first existing block
					block = subPanel.querySelector('.dfghs');
					if (!block) {
						// Create first block using prototype
						block = createNewDfghsBlock(subPanel);
					}
				} else {
					// Create new block for subsequent sights
					block = createNewDfghsBlock(subPanel);
				}

				if (block) {
					fillSightBlock(block, sight);
				}
			});

			_currentSightBtn = null;
		}

		// Create a new dfghs block
		function createNewDfghsBlock(panel) {
			const proto = window.__jw_dfghs_proto || null;
			const tpl = proto || panel.querySelector('.dfghs');
			if (!tpl) return null;

			const copy = tpl.cloneNode(true);
			copy.removeAttribute('id');
			__resetInputs(copy);
			panel.appendChild(copy);
			__resetEditors(copy);
			__resetSelectWidgets(copy);
			return copy;
		}

		// Fill a dfghs block with sight data
		function fillSightBlock(block, sight) {
			// Fill in the data
			const inputs = Array.from(block.querySelectorAll('input.form-control'));

			// Sight Name (first input - might be inside jw-center div)
			const nameInput = block.querySelector('.grid-item input.form-control');
			if (nameInput) {
				nameInput.value = sight.sightName || '';
				nameInput.disabled = false;
			}

			// Sight Address (second input)
			if (inputs[1]) {
				inputs[1].value = sight.sightAddress || '';
				inputs[1].disabled = false;
			}

			// Sight Description (Quill editor)
			const editorDiv = block.querySelector('.jweditor');
			if (editorDiv) {
				if (sight.sightDescription) {
					editorDiv.innerHTML = sight.sightDescription;
				}
				// Re-initialize Quill if needed
				try {
					const qlEditor = editorDiv.closest('.jw-editor');
					if (qlEditor && !qlEditor.__quill) {
						const toolbar = qlEditor.querySelector('.toolbar');
						if (toolbar) {
							qlEditor.__quill = new Quill(editorDiv, {
								modules: { toolbar: toolbar },
								theme: 'snow'
							});
						}
					}
				} catch (_) { }
			}

			// Sight Image - show preview if exists
			if (sight.sightImage) {
				const uploadItem = block.querySelector('.upload-item');
				if (uploadItem) {
					const imgUrl = '/uploads/sights/' + sight.sightImage;
					uploadItem.classList.add('is-filled');
					uploadItem.innerHTML = `
						<div class="preview-wrap">
							<img src="${imgUrl}" alt="Preview" class="preview">
							<button type="button" class="btn-remove" onclick="removeSightPreview(this)">
								<img src="../image/close.svg" alt="">
							</button>
						</div>
						<label class="inputFile">
							<input type="file" onchange="filePreview(this);" data-existing="${sight.sightImage}">
							<button type="button" class="btn-upload btn-sm"><span>Change</span></button>
						</label>
					`;
					// Store existing image reference
					const fileInput = uploadItem.querySelector('input[type="file"]');
					if (fileInput) {
						fileInput.dataset.existing = sight.sightImage;
					}
				}
			}
		}

		// Legacy single sight handler (for backward compatibility)
		function handleSightSelected(sight) {
			if (!sight) return;
			handleSightsSelected([sight]);
		}

		function removeSightPreview(btn) {
			const uploadItem = btn.closest('.upload-item');
			if (!uploadItem) return;
			uploadItem.classList.remove('is-filled');
			uploadItem.innerHTML = `
				<label class="inputFile">
					<input type="file" onchange="filePreview(this);">
					<button type="button" class="btn-upload"><img src="../image/upload3.svg" alt=""> <span>Image upload</span></button>
				</label>
			`;
		}
	</script>

</body>

</html>
